/*! permutive-javascript-sdk v13.0.0-RC.16 (web) (built 2020-10-14 17:12:17 GMT+0000) */!function(e){function t(t){for(var n,i,a=t[0],s=t[1],o=0,u=[];o<a.length;o++)i=a[o],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);u.length;)u.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var a=window.permutiveWebpack=window.permutiveWebpack||[],s=a.push.bind(a);a.push=t,a=a.slice();for(var o=0;o<a.length;o++)t(a[o]);var c=s;i(i.s=33)}([function(e,t,n){"use strict";n.d(t,"k",(function(){return r})),n.d(t,"j",(function(){return i})),n.d(t,"m",(function(){return a})),n.d(t,"n",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"o",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"i",(function(){return l})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return _})),n.d(t,"g",(function(){return p})),n.d(t,"l",(function(){return h})),n.d(t,"e",(function(){return m})),n.d(t,"h",(function(){return b}));n(5);var r=function(e){return"Some"===e._tag},i=function(e){return"None"===e._tag},a={_tag:"None"},s=function(e){return{_tag:"Some",value:e}};function o(e){return null==e?a:s(e)}function c(e){return function(t){return e(t)?s(t):a}}function u(e){try{return s(e())}catch(e){return a}}function d(e){return"Right"===e._tag?a:s(e.left)}function l(e){return"Left"===e._tag?a:s(e.right)}var f=function(e){return"Left"===e._tag?a:s(e.right)};function _(e,t){return function(n){return i(n)?e():t(n.value)}}var p=function(e){return function(t){return i(t)?e():t.value}};var g=function(e,t){return i(e)?a:s(t(e.value))},h=function(e){return function(t){return g(t,e)}};function m(e){return{equals:function(t,n){return t===n||(i(t)?i(n):!i(n)&&e.equals(t.value,n.value))}}}function b(e){return{equals:m(e).equals,compare:function(t,n){return t===n?0:r(t)?r(n)?e.compare(t.value,n.value):1:-1}}}},function(e,t,n){"use strict";n.d(t,"bb",(function(){return s})),n.d(t,"Vb",(function(){return o})),n.d(t,"fb",(function(){return c})),n.d(t,"db",(function(){return d})),n.d(t,"cb",(function(){return l})),n.d(t,"eb",(function(){return f})),n.d(t,"qb",(function(){return _})),n.d(t,"zb",(function(){return p})),n.d(t,"Eb",(function(){return g})),n.d(t,"W",(function(){return h})),n.d(t,"X",(function(){return m})),n.d(t,"ab",(function(){return b})),n.d(t,"Ib",(function(){return v})),n.d(t,"Jb",(function(){return y})),n.d(t,"kb",(function(){return w})),n.d(t,"lb",(function(){return O})),n.d(t,"mb",(function(){return k})),n.d(t,"pb",(function(){return j})),n.d(t,"C",(function(){return E})),n.d(t,"Mb",(function(){return q})),n.d(t,"gb",(function(){return P})),n.d(t,"nb",(function(){return S})),n.d(t,"Rb",(function(){return M})),n.d(t,"hb",(function(){return T})),n.d(t,"Sb",(function(){return I})),n.d(t,"Ub",(function(){return x})),n.d(t,"Tb",(function(){return C})),n.d(t,"Pb",(function(){return A})),n.d(t,"F",(function(){return L})),n.d(t,"H",(function(){return R})),n.d(t,"G",(function(){return N})),n.d(t,"S",(function(){return U})),n.d(t,"Q",(function(){return B})),n.d(t,"R",(function(){return K})),n.d(t,"T",(function(){return W})),n.d(t,"V",(function(){return z})),n.d(t,"U",(function(){return $})),n.d(t,"ib",(function(){return G})),n.d(t,"fc",(function(){return F})),n.d(t,"D",(function(){return J})),n.d(t,"tb",(function(){return H})),n.d(t,"Fb",(function(){return V})),n.d(t,"Gb",(function(){return Q})),n.d(t,"ob",(function(){return Y})),n.d(t,"Nb",(function(){return X})),n.d(t,"jc",(function(){return Z})),n.d(t,"ic",(function(){return ee})),n.d(t,"ec",(function(){return te})),n.d(t,"Hb",(function(){return ne})),n.d(t,"J",(function(){return re})),n.d(t,"ac",(function(){return ie})),n.d(t,"Ob",(function(){return ae})),n.d(t,"y",(function(){return se})),n.d(t,"Qb",(function(){return oe})),n.d(t,"z",(function(){return ce})),n.d(t,"B",(function(){return ue})),n.d(t,"Zb",(function(){return de})),n.d(t,"jb",(function(){return le})),n.d(t,"E",(function(){return fe})),n.d(t,"ub",(function(){return _e})),n.d(t,"o",(function(){return Be})),n.d(t,"p",(function(){return Ke})),n.d(t,"q",(function(){return We})),n.d(t,"s",(function(){return ze})),n.d(t,"v",(function(){return $e})),n.d(t,"x",(function(){return Ge})),n.d(t,"w",(function(){return Fe})),n.d(t,"I",(function(){return Je})),n.d(t,"rb",(function(){return He})),n.d(t,"sb",(function(){return Ve})),n.d(t,"A",(function(){return Qe})),n.d(t,"Kb",(function(){return Ye})),n.d(t,"M",(function(){return Xe})),n.d(t,"N",(function(){return Ze})),n.d(t,"vb",(function(){return et})),n.d(t,"yb",(function(){return tt})),n.d(t,"wb",(function(){return nt})),n.d(t,"xb",(function(){return rt})),n.d(t,"O",(function(){return it})),n.d(t,"P",(function(){return at})),n.d(t,"L",(function(){return st})),n.d(t,"Y",(function(){return ot})),n.d(t,"Z",(function(){return ct})),n.d(t,"Ab",(function(){return ut})),n.d(t,"Db",(function(){return dt})),n.d(t,"Bb",(function(){return lt})),n.d(t,"Cb",(function(){return ft})),n.d(t,"Wb",(function(){return _t})),n.d(t,"Lb",(function(){return pt})),n.d(t,"Xb",(function(){return gt})),n.d(t,"hc",(function(){return ht})),n.d(t,"gc",(function(){return mt})),n.d(t,"Yb",(function(){return bt})),n.d(t,"i",(function(){return yt})),n.d(t,"j",(function(){return wt})),n.d(t,"c",(function(){return Ot})),n.d(t,"k",(function(){return kt})),n.d(t,"a",(function(){return jt})),n.d(t,"b",(function(){return Et})),n.d(t,"d",(function(){return qt})),n.d(t,"e",(function(){return Pt})),n.d(t,"f",(function(){return St})),n.d(t,"g",(function(){return Mt})),n.d(t,"h",(function(){return Tt})),n.d(t,"l",(function(){return It})),n.d(t,"m",(function(){return xt})),n.d(t,"n",(function(){return Ct})),n.d(t,"cc",(function(){return Dt})),n.d(t,"dc",(function(){return At})),n.d(t,"bc",(function(){return Lt})),n.d(t,"K",(function(){return Rt})),n.d(t,"u",(function(){return Nt})),n.d(t,"t",(function(){return Ut})),n.d(t,"r",(function(){return Bt}));var r=n(5),i=n(0),a=n(8);function s(e){var t=e.length;if(0===t)return Rt;for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}function o(e){for(var t=e.length,n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}function c(e){return{show:function(t){return"["+t.map(e.show).join(", ")+"]"}}}var u=function(e,t){var n=e.length;if(0===n)return t;var r=t.length;if(0===r)return e;for(var i=Array(n+r),a=0;a<n;a++)i[a]=e[a];for(a=0;a<r;a++)i[a+n]=t[a];return i};function d(){return{concat:u,empty:Rt}}function l(e){return{equals:function(t,n){return t===n||t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}}}function f(e){return Object(a.b)((function(t,n){for(var r=t.length,i=n.length,s=Math.min(r,i),o=0;o<s;o++){var c=e.compare(t[o],n[o]);if(0!==c)return c}return a.i.compare(r,i)}))}function _(e,t){for(var n=[],r=0;r<e;r++)n.push(t(r));return n}function p(e,t){return _(t-e+1,(function(t){return e+t}))}function g(e,t){return _(e,(function(){return t}))}function h(e){for(var t=0,n=e.length,r=0;r<n;r++)t+=e[r].length;var i=Array(t),a=0;for(r=0;r<n;r++){for(var s=e[r],o=s.length,c=0;c<o;c++)i[c+a]=s[c];a+=o}return i}function m(e,t){return function(n){return w(n)?e():t(n[0],n.slice(1))}}function b(e,t){return function(n){return w(n)?e():t(n.slice(0,n.length-1),n[n.length-1])}}function v(e,t){return function(n){var r=n.length,i=new Array(r+1);i[0]=e;for(var a=0;a<r;a++)i[a+1]=t(i[a],n[a]);return i}}function y(e,t){return function(n){var r=n.length,i=new Array(r+1);i[r]=e;for(var a=r-1;a>=0;a--)i[a]=t(n[a],i[a+1]);return i}}function w(e){return 0===e.length}function O(e){return e.length>0}function k(e,t){return e<0||e>=t.length}function j(e,t){return void 0===t?function(t){return j(e,t)}:k(e,t)?i.m:Object(i.n)(t[e])}function E(e,t){if(void 0===t)return function(t){return E(e,t)};for(var n=t.length,r=Array(n+1),i=0;i<n;i++)r[i+1]=t[i];return r[0]=e,r}function q(e,t){for(var n=e.length,r=Array(n+1),i=0;i<n;i++)r[i]=e[i];return r[n]=t,r}function P(e){return w(e)?i.m:Object(i.n)(e[0])}function S(e){return j(e.length-1,e)}function M(e){return w(e)?i.m:Object(i.n)(e.slice(1))}function T(e){var t=e.length;return 0===t?i.m:Object(i.n)(e.slice(0,t-1))}function I(e){return function(t){return t.slice(0,e)}}function x(e){return function(t){return 0===e?Rt:t.slice(-e)}}function C(e){return function(t){for(var n=D(t,e),r=Array(n),i=0;i<n;i++)r[i]=t[i];return r}}var D=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function A(e){return function(t){for(var n=D(t,e),r=Array(n),i=0;i<n;i++)r[i]=t[i];var a=t.length,s=Array(a-n);for(i=n;i<a;i++)s[i-n]=t[i];return{init:r,rest:s}}}function L(e){return function(t){return t.slice(e,t.length)}}function R(e){return function(t){return t.slice(0,t.length-e)}}function N(e){return function(t){for(var n=D(t,e),r=t.length,i=Array(r-n),a=n;a<r;a++)i[a-n]=t[a];return i}}function U(e){return function(t){for(var n=t.length,r=0;r<n;r++)if(e(t[r]))return Object(i.n)(r);return i.m}}function B(e){return function(t){for(var n=t.length,r=0;r<n;r++)if(e(t[r]))return Object(i.n)(t[r]);return i.m}}function K(e){return function(t){for(var n=t.length,r=0;r<n;r++){var a=e(t[r]);if(Object(i.k)(a))return a}return i.m}}function W(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return Object(i.n)(t[n]);return i.m}}function z(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(Object(i.k)(r))return r}return i.m}}function $(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return Object(i.n)(n);return i.m}}function G(e,t){return function(n){return e<0||e>n.length?i.m:Object(i.n)(Dt(e,t,n))}}function F(e,t){return function(n){return k(e,n)?i.m:Object(i.n)(At(e,t,n))}}function J(e){return function(t){return k(e,t)?i.m:Object(i.n)(Lt(e,t))}}function H(e,t){return function(n){return k(e,n)?i.m:Object(i.n)(At(e,t(n[e]),n))}}function V(e){return w(e)?e:e.slice().reverse()}function Q(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r];"Right"===i._tag&&t.push(i.right)}return t}function Y(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r];"Left"===i._tag&&t.push(i.left)}return t}var X=function(e){return function(t){return w(t)?t:t.slice().sort(e.compare)}};function Z(e,t,n){for(var r=[],i=Math.min(e.length,t.length),a=0;a<i;a++)r[a]=n(e[a],t[a]);return r}function ee(e,t){return void 0===t?function(t){return ee(t,e)}:Z(e,t,(function(e,t){return[e,t]}))}function te(e){for(var t=[],n=[],r=0;r<e.length;r++)t[r]=e[r][0],n[r]=e[r][1];return[t,n]}function ne(e){return function(t){var n=t.length;return 0===e||n<=1||n===Math.abs(e)?t:e<0?ne(n+e)(t):t.slice(-e).concat(t.slice(0,n-e))}}function re(e){return function(t,n){if(void 0===n){var r=re(e);return function(e){return r(t,e)}}for(var i,a=0,s=n.length;a<s;a++)if(i=n[a],e.equals(i,t))return!0;return!1}}function ie(e){var t=re(e);return function(e){for(var n=[],r=e.length,i=0;i<r;i++){var a=e[i];t(a,n)||n.push(a)}return r===n.length?e:n}}function ae(e){var t=Object(a.d)();return X(e.reduce(t.concat,t.empty))}var se=function(e){return function(t){for(var n=[],r=t;O(r);){var i=e(r),a=i[0],s=i[1];n.push(a),r=s}return n}};function oe(e){return function(t){return[t.slice(0,e),t.slice(e)]}}function ce(e){var t=se(oe(e));return function(n){return 0===n.length?Rt:k(e-1,n)?[n]:t(n)}}function ue(e,t,n){void 0===n&&(n=function(){return!0});var r=function(e,i){return 0===i.length?n.apply(void 0,e)?[t.apply(void 0,e)]:Rt:ve(i[0],(function(t){return r(q(e,t),i.slice(1))}))};return r(Rt,e)}function de(e){var t=re(e);return function(n,r){if(void 0===r){var i=de(e);return function(e){return i(e,n)}}return u(n,r.filter((function(e){return!t(e,n)})))}}function le(e){var t=re(e);return function(n,r){if(void 0===r){var i=le(e);return function(e){return i(e,n)}}return n.filter((function(e){return t(e,r)}))}}function fe(e){var t=re(e);return function(n,r){if(void 0===r){var i=fe(e);return function(e){return i(e,n)}}return n.filter((function(e){return!t(e,r)}))}}var _e=function(e){return[e]},pe=function(){return Rt},ge=function(e,t){return e.map((function(e){return t(e)}))},he=function(e,t){return e.map((function(e,n){return t(n,e)}))},me=function(e,t){return h(ge(e,(function(e){return ge(t,e)})))},be=function(e,t){for(var n=0,r=e.length,i=new Array(r),a=0;a<r;a++){n+=(c=t(a,e[a])).length,i[a]=c}var s=Array(n),o=0;for(a=0;a<r;a++){for(var c,u=(c=i[a]).length,d=0;d<u;d++)s[d+o]=c[d];o+=u}return s},ve=function(e,t){return be(e,(function(e,n){return t(n)}))},ye=function(e,t){return Ce(e,(function(e,n){return t(n)}))},we=function(e,t){return e.filter(t)},Oe=function(e,t){for(var n=[],r=[],i=0;i<e.length;i++){var a=e[i];t(i,a)?r.push(a):n.push(a)}return{left:n,right:r}},ke=function(e,t){return Oe(e,(function(e,n){return t(n)}))},je=function(e,t){return Ee(e,(function(e,n){return t(n)}))},Ee=function(e,t){for(var n=[],r=[],i=0;i<e.length;i++){var a=t(i,e[i]);"Left"===a._tag?n.push(a.left):r.push(a.right)}return{left:n,right:r}},qe=function(e,t){return u(e,t())},Pe=function(e,t,n){return Te(e,t,(function(e,t,r){return n(t,r)}))},Se=function(e){var t=Ie(e);return function(e,n){return t(e,(function(e,t){return n(t)}))}},Me=function(e,t,n){return xe(e,t,(function(e,t,r){return n(t,r)}))},Te=function(e,t,n){for(var r=e.length,i=t,a=0;a<r;a++)i=n(a,i,e[a]);return i},Ie=function(e){return function(t,n){return t.reduce((function(t,r,i){return e.concat(t,n(i,r))}),e.empty)}},xe=function(e,t,n){return e.reduceRight((function(e,t,r){return n(r,t,e)}),t)},Ce=function(e,t){for(var n=[],r=0;r<e.length;r++){var a=t(r,e[r]);Object(i.k)(a)&&n.push(a.value)}return n},De=function(e,t){return e.filter((function(e,n){return t(n,e)}))},Ae=function(e,t){return e.map((function(e,n,r){return t(r.slice(n))}))},Le=function(e){var t=Re(e);return function(e,n){return t(e,(function(e,t){return n(t)}))}},Re=function(e){return function(t,n){return Te(t,e.of(pe()),(function(t,r,i){return e.ap(e.map(r,(function(e){return function(t){return q(e,t)}})),n(t,i))}))}},Ne=function(e){var t=Le(e);return function(n,r){return e.map(t(n,r),Qe)}},Ue=function(e){var t=Le(e);return function(n,r){return e.map(t(n,r),Ye)}},Be=function(e){return function(t){return qe(t,e)}},Ke=function(e){return function(t){return me(t,e)}},We=function(e){return function(t){return me(ge(t,(function(e){return function(){return e}})),e)}},ze=function(e){return function(t){return me(ge(t,(function(){return function(e){return e}})),e)}},$e=function(e){return function(t){return ve(t,e)}},Ge=function(e){return function(t){return be(t,e)}},Fe=function(e){return function(t){return ve(t,(function(t){return ge(e(t),(function(){return t}))}))}},Je=function(e){return Ae(e,r.e)},He=function(e){return function(t){return ge(t,e)}},Ve=function(e){return function(t){return he(t,e)}},Qe=function(e){return ye(e,r.e)},Ye=function(e){for(var t=[],n=[],r=0,i=e;r<i.length;r++){var a=i[r];"Left"===a._tag?t.push(a.left):n.push(a.right)}return{left:t,right:n}},Xe=function(e){return function(t){return we(t,e)}},Ze=function(e){return function(t){return ye(t,e)}},et=function(e){return function(t){return ke(t,e)}},tt=function(e){return function(t){return Oe(t,e)}},nt=function(e){return function(t){return je(t,e)}},rt=function(e){return function(t){return Ee(t,e)}},it=function(e){return function(t){return Ce(t,e)}},at=function(e){return function(t){return De(t,e)}},st=function(e){return function(t){return Ae(t,e)}},ot=function(e){var t=Se(e);return function(e){return function(n){return t(n,e)}}},ct=function(e){var t=Ie(e);return function(e){return function(n){return t(n,e)}}},ut=function(e,t){return function(n){return Pe(n,e,t)}},dt=function(e,t){return function(n){return Te(n,e,t)}},lt=function(e,t){return function(n){return Me(n,e,t)}},ft=function(e,t){return function(n){return xe(n,e,t)}},_t=function(e){var t=Le(e);return function(e){return function(n){return t(n,e)}}},pt=function(e){return function(t){return Pe(t,e.of(pe()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return q(e,t)}})),n)}))}},gt=function(e){var t=Re(e);return function(e){return function(n){return t(n,e)}}},ht=function(e){var t=Ne(e);return function(e){return function(n){return t(n,e)}}},mt=function(e){var t=Ue(e);return function(e){return function(n){return t(n,e)}}},bt=function(e,t){for(var n=[],r=e;;){var a=t(r);if(!Object(i.k)(a))break;var s=a.value,o=s[0],c=s[1];n.push(o),r=c}return n},vt="ReadonlyArray",yt={URI:vt,map:ge},wt={URI:vt,map:ge,mapWithIndex:he},Ot={URI:vt,map:ge,ap:me,of:_e},kt={URI:vt,map:ge,ap:me,of:_e,chain:ve},jt={URI:vt,map:ge,alt:qe},Et={URI:vt,map:ge,ap:me,of:_e,alt:qe,zero:pe},qt={URI:vt,map:ge,extend:Ae},Pt={URI:vt,map:ge,compact:Qe,separate:Ye,filter:we,filterMap:ye,partition:ke,partitionMap:je},St={URI:vt,map:ge,mapWithIndex:he,compact:Qe,separate:Ye,filter:we,filterMap:ye,partition:ke,partitionMap:je,partitionMapWithIndex:Ee,partitionWithIndex:Oe,filterMapWithIndex:Ce,filterWithIndex:De},Mt={URI:vt,reduce:Pe,foldMap:Se,reduceRight:Me},Tt={URI:vt,reduce:Pe,foldMap:Se,reduceRight:Me,reduceWithIndex:Te,foldMapWithIndex:Ie,reduceRightWithIndex:xe},It={URI:vt,map:ge,reduce:Pe,foldMap:Se,reduceRight:Me,traverse:Le,sequence:pt},xt={URI:vt,map:ge,mapWithIndex:he,reduce:Pe,foldMap:Se,reduceRight:Me,reduceWithIndex:Te,foldMapWithIndex:Ie,reduceRightWithIndex:xe,traverse:Le,sequence:pt,traverseWithIndex:Re},Ct={URI:vt,map:ge,compact:Qe,separate:Ye,filter:we,filterMap:ye,partition:ke,partitionMap:je,reduce:Pe,foldMap:Se,reduceRight:Me,traverse:Le,sequence:pt,wither:Ne,wilt:Ue};function Dt(e,t,n){var r=n.slice();return r.splice(e,0,t),r}function At(e,t,n){if(n[e]===t)return n;var r=n.slice();return r[e]=t,r}function Lt(e,t){var n=t.slice();return n.splice(e,1),n}var Rt=[],Nt=function(e){return He(Object(r.a)(e))},Ut=function(e,t){return $e((function(n){return Object(r.f)(t(n),He((function(t){return Object(r.b)(n,e,t)})))}))},Bt=function(e,t){return Object(r.d)(He((function(t){return function(n){return Object(r.b)(t,e,n)}})),Ke(t))}},function(e,t,n){"use strict";n.d(t,"j",(function(){return r})),n.d(t,"m",(function(){return i})),n.d(t,"k",(function(){return a})),n.d(t,"i",(function(){return s})),n.d(t,"l",(function(){return o})),n.d(t,"h",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"q",(function(){return f})),n.d(t,"s",(function(){return _})),n.d(t,"c",(function(){return p})),n.d(t,"r",(function(){return g})),n.d(t,"g",(function(){return h})),n.d(t,"n",(function(){return m})),n.d(t,"p",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"b",(function(){return w}));const r=()=>({kind:"null",value:null}),i=e=>({kind:"string",value:e}),a=e=>({kind:"number",value:e}),s=e=>({kind:"array",value:e}),o=e=>({kind:"object",value:e}),c=e=>e,u=()=>({kind:"bottom"}),d=e=>({kind:"inner",a:e}),l=e=>({kind:"top",error:e}),f=e=>({kind:"unbounded",group:e}),_=(e,t)=>({kind:"windowed",key:t,group:e}),p=(e,t,n)=>({kind:"countLimit",n:n,limit:t,group:e}),g=(e,t,n)=>({kind:"uniqueLimit",n:n,limit:t,group:e}),h=e=>({kind:"numberGroup",group:e}),m=e=>({kind:"stringGroup",group:e}),b=e=>({kind:"tuple",tuple:e}),v=e=>({state:e}),y=(e,t)=>({commands:e,payload:t}),w=e=>e},function(e,t,n){"use strict";n.d(t,"m",(function(){return r})),n.d(t,"n",(function(){return i})),n.d(t,"o",(function(){return a})),n.d(t,"r",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"t",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"j",(function(){return d})),n.d(t,"s",(function(){return l})),n.d(t,"p",(function(){return j})),n.d(t,"c",(function(){return E})),n.d(t,"q",(function(){return q})),n.d(t,"b",(function(){return P})),n.d(t,"a",(function(){return S})),n.d(t,"d",(function(){return I})),n.d(t,"k",(function(){return D})),n.d(t,"i",(function(){return A})),n.d(t,"l",(function(){return L})),n.d(t,"h",(function(){return R})),n.d(t,"e",(function(){return N}));n(5);var r=function(e){return"Left"===e._tag},i=function(e){return"Right"===e._tag},a=function(e){return{_tag:"Left",left:e}},s=function(e){return{_tag:"Right",right:e}};function o(e){return function(t){return null==t?a(e):s(t)}}function c(e,t){try{return s(e())}catch(e){return a(t(e))}}function u(e,t){return function(n){return r(n)?e(n.left):t(n.right)}}var d=function(e){return function(t){return r(t)?e(t.left):t.right}};function l(e){return r(e)?s(e.left):a(e.right)}var f=function(e,t){return r(e)?e:s(t(e.right))},_=function(e,t){return r(e)?e:r(t)?t:s(e.right(t.right))},p=function(e,t){return r(e)?e:t(e.right)},g=function(e,t,n){return r(e)?t:n(t,e.right)},h=function(e){return function(t,n){return r(t)?e.empty:n(t.right)}},m=function(e,t,n){return r(e)?t:n(e.right,t)},b=function(e){return function(t,n){return r(t)?e.of(a(t.left)):e.map(n(t.right),s)}},v=function(e,t,n){return r(e)?a(t(e.left)):s(n(e.right))},y=function(e,t){return r(e)?a(t(e.left)):e},w=function(e,t){return r(e)?t():e},O=function(e,t){return r(e)?e:s(t(e))},k=function(e,t){return function(e,t){for(var n=t(e);"Left"===n._tag;)n=t(n.left);return n.right}(t(e),(function(e){return r(e)?s(a(e.left)):r(e.right)?a(t(e.right.left)):s(s(e.right.right))}))},j=function(e){return function(t){return f(t,e)}},E=function(e,t){return function(n){return v(n,e,t)}},q=function(e){return function(t){return y(t,e)}},P=function(e){return function(t){return _(t,e)}},S=P,M=s,T=function(e){return function(t){return p(t,e)}},I=T,x=function(e){return function(t){return r(t)?e.of(a(t.left)):e.map(t.right,s)}},C="Either";function D(e){return{concat:function(t,n){return r(n)?t:r(t)?n:s(e.concat(t.right,n.right))}}}function A(e){return{concat:function(t,n){return r(t)?t:r(n)?n:s(e.concat(t.right,n.right))}}}function L(e){var t=function(e){var t=a(e.empty);return{URI:C,_E:void 0,map:f,compact:function(e){return r(e)?e:"None"===e.right._tag?t:s(e.right.value)},separate:function(e){return r(e)?{left:e,right:e}:r(e.right)?{left:s(e.right.left),right:t}:{left:t,right:s(e.right.right)}},filter:function(e,n){return r(e)||n(e.right)?e:t},filterMap:function(e,n){if(r(e))return e;var i=n(e.right);return"None"===i._tag?t:s(i.value)},partition:function(e,n){return r(e)?{left:e,right:e}:n(e.right)?{left:t,right:s(e.right)}:{left:s(e.right),right:t}},partitionMap:function(e,n){if(r(e))return{left:e,right:e};var i=n(e.right);return r(i)?{left:s(i.left),right:t}:{left:t,right:s(i.right)}}}}(e);return{URI:C,_E:void 0,map:f,compact:t.compact,separate:t.separate,filter:t.filter,filterMap:t.filterMap,partition:t.partition,partitionMap:t.partitionMap,traverse:b,sequence:x,reduce:g,foldMap:h,reduceRight:m,wither:function(e){var n=b(e);return function(r,i){return e.map(n(r,i),t.compact)}},wilt:function(e){var n=b(e);return function(r,i){return e.map(n(r,i),t.separate)}}}}function R(e){return{URI:C,_E:void 0,map:f,ap:function(t,n){return r(t)?r(n)?a(e.concat(t.left,n.left)):t:r(n)?n:s(t.right(n.right))},of:M}}var N={URI:C,map:f,of:s,ap:_,chain:p,reduce:g,foldMap:h,reduceRight:m,traverse:b,sequence:x,bimap:v,mapLeft:y,alt:w,extend:O,chainRec:k,throwError:a}},function(e,t,n){"use strict";n.d(t,"j",(function(){return o})),n.d(t,"n",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return f})),n.d(t,"e",(function(){return _})),n.d(t,"c",(function(){return p})),n.d(t,"k",(function(){return g})),n.d(t,"m",(function(){return h})),n.d(t,"o",(function(){return m})),n.d(t,"i",(function(){return b})),n.d(t,"l",(function(){return v})),n.d(t,"d",(function(){return y})),n.d(t,"g",(function(){return w}));var r=n(6),i=n(0),a=n(11),s=n(7);function o(...e){return e.reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}function c(e){const t={};for(const n in e)t[e[n]]=n;return t}function u(e,...t){return t.reduce((e,t)=>e?e[t]:void 0,e)}function d(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function l(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),reject:t,resolve:e}}function f(e,t,n=!1,a=20){let s=0;const o=c=>new Promise(u=>Promise.resolve(t()).then(t=>t?Promise.resolve(e()).then(e=>u(Object(i.n)(e))):Object(r.a)(s++,e=>e<a?setTimeout(()=>u(o(c*(n?2:1))),c):u(i.m))));return o(50)}function _(...e){return t=>e.reduce((e,t)=>Promise.resolve(e).then(t),t)}function p(e){const t={equals:(t,n)=>t[0]===n[0]&&e.equals(t[1],n[1])},n=Object(s.i)(t);return Object(a.a)(e=>Object.entries(e))(n)}function g(e){if("string"==typeof e){const t=+e;if(!isNaN(t))return t}return e}function h(e,t){const n=t=>{if(!r&&t)return r=!0,e()};let r=!1;["blur","visibilitychange"].forEach(e=>{window.addEventListener(e,()=>n(document.hidden&&function(e){return/Mobi|Android/i.test(e)}(t)))}),["beforeunload","pagehide"].forEach(e=>{window.addEventListener(e,()=>n(!0))})}function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^(window.crypto||window.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function b(e,t){return Object.keys(e).reduce((n,r)=>{const a=t(r,e[r]);return Object.assign(Object.assign({},n),Object(i.k)(a)?{[r]:a.value}:{})},{})}function v(...e){return e.reduce((e,[t,n])=>Object.assign(Object.assign({},e),{[t]:n}),{})}function y(e,t){return b(e,(e,n)=>t(e)?Object(i.n)(n):i.m)}function w(e){return/^((?!chrome|android).)*safari/i.test(e)}},function(e,t,n){"use strict";function r(e){return e}n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"g",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u}));var i=function(){};function a(e,t,n,r,i,a,s,o,c){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return a(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return s(a(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return o(s(a(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return c(o(s(a(i(r(n(t(e.apply(this,arguments)))))))))}}}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function o(e,t,n,r,i,a,s,o,c,u){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return a(i(r(n(t(e)))));case 7:return s(a(i(r(n(t(e))))));case 8:return o(s(a(i(r(n(t(e)))))));case 9:return c(o(s(a(i(r(n(t(e))))))));case 10:return u(c(o(s(a(i(r(n(t(e)))))))))}}var c=function(e,t,n){var r;return Object.assign({},e,((r={})[t]=n,r))},u=function(e){return function(t){var n;return(n={})[e]=t,n}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(5),i=r.f},function(e,t,n){"use strict";n.d(t,"i",(function(){return i})),n.d(t,"j",(function(){return a})),n.d(t,"h",(function(){return s})),n.d(t,"o",(function(){return o})),n.d(t,"n",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"g",(function(){return l})),n.d(t,"l",(function(){return f})),n.d(t,"m",(function(){return _})),n.d(t,"r",(function(){return p})),n.d(t,"f",(function(){return g})),n.d(t,"q",(function(){return h})),n.d(t,"k",(function(){return m})),n.d(t,"c",(function(){return b})),n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return y})),n.d(t,"p",(function(){return w}));var r=n(1),i=(r.fb,r.db,r.cb),a=r.eb,s=(r.qb,r.zb,r.Eb,r.W),o=(r.X,r.ab,r.Ib,r.Jb,r.kb,r.lb,r.mb,r.pb,r.C,r.Mb,r.gb,r.nb,r.Rb,r.hb,r.Sb);r.Ub;function c(e){return r.Pb(e)}var u=r.F,d=(r.H,r.G);r.S;function l(e){return r.Q(e)}r.R;r.V,r.U,r.Vb,r.ib,r.fc,r.D,r.tb;var f=r.Fb,_=(r.Gb,r.ob,r.Nb),p=r.jc,g=(r.ic,r.ec,r.Hb,r.J),h=r.ac;r.Ob,r.y,r.Qb,r.z;r.Zb;var m=r.jb,b=r.E,v=(r.ub,r.k.map,r.k.ap,r.k.chain,r.j.mapWithIndex,r.e.filter,r.e.filterMap,r.e.partition,r.e.partitionMap,r.f.filterWithIndex,r.f.filterMapWithIndex,r.f.partitionWithIndex,r.f.partitionMapWithIndex,r.g.reduce,r.g.foldMap,r.g.reduceRight,r.l.traverse,r.b.alt,r.h.reduceWithIndex,r.h.foldMapWithIndex,r.h.reduceRightWithIndex,r.m.traverseWithIndex,r.d.extend,r.n.wither,r.n.wilt,r.rb,r.p,r.q,r.s,r.v),y=(r.x,r.w,r.sb,r.A),w=(r.Kb,r.M,r.N,r.vb,r.yb,r.wb,r.xb,r.o,r.O,r.P,r.L,r.I,r.Y,r.Z,r.Ab,r.Db,r.Bb,r.Cb,r.Wb);r.Lb,r.Xb,r.hc,r.gc,r.Yb,r.b.zero,r.cc,r.dc,r.bc,r.u,r.t,r.r},function(e,t,n){"use strict";n.d(t,"j",(function(){return s})),n.d(t,"i",(function(){return o})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return _})),n.d(t,"d",(function(){return p})),n.d(t,"a",(function(){return h}));var r=n(19);function i(e,t){return e<t?-1:e>t?1:0}function a(e,t){return e===t}var s={equals:a,compare:i},o={equals:a,compare:i};function c(e){return function(t,n){return-1===e.compare(t,n)}}function u(e){return function(t,n){return 1===e.compare(t,n)}}function d(e){return function(t,n){return-1!==e.compare(t,n)}}function l(e){return function(t,n){return 1===e.compare(t,n)?n:t}}function f(e){return function(t,n){return-1===e.compare(t,n)?n:t}}function _(e){var t=function(t,n){return t===n?0:e(t,n)};return{equals:function(e,n){return 0===t(e,n)},compare:t}}function p(){return{concat:{concat:function(e,t){return _((function(n,i){return r.b.concat(e.compare(n,i),t.compare(n,i))}))}}.concat,empty:_((function(){return 0}))}}var g=function(e,t){return _((function(n,r){return e.compare(t(n),t(r))}))},h=function(e){return function(t){return g(t,e)}}},function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"d",(function(){return l})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return p}));var r=n(3);n(0);var i=n(5),a=n(10),s=Object(i.d)(r.o,a.h),o=Object(i.d)(r.r,a.h),c=(r.r,r.o,a.e,function(e){return r.m(e)?s(e.left):o(e.right)}),u=function(e){return function(t){return"None"===t._tag?s(e()):o(t.value)}};function d(e,t){return function(){return e().then(r.r,(function(e){return r.o(t(e))}))}}r.f,a.d;var l=function(e){return function(t){return Object(i.f)(t,a.d(r.f(e,a.h)))}};r.s;var f=function(e){return a.g(r.p(e))},_=(r.c,a.g,function(e){return function(t){return Object(i.f)(t,a.d(r.f(s,e)))}}),p=_;i.e},function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"g",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"d",(function(){return l})),n.d(t,"f",(function(){return _})),n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return g}));var r=n(5),i=function(e){return function(){return Promise.resolve(e())}};var a=function(e,t){return function(){return e().then(t)}},s=function(e,t){return function(){return Promise.all([e(),t()]).then((function(e){return(0,e[0])(e[1])}))}},o=function(e,t){return function(){return e().then((function(e){return t(e)()}))}},c=function(e){return function(t){return a(t,e)}},u=function(e){return function(t){return s(t,e)}},d=function(e){return function(){return Promise.resolve(e)}},l=function(e){return function(t){return o(t,e)}},f=(r.e,"Task");function _(e){return{concat:function(t,n){return function(){return t().then((function(t){return n().then((function(n){return e.concat(t,n)}))}))}}}}var p={URI:f,map:a,ap:s,of:d},g={URI:f,map:a,of:d,ap:s,chain:o}},function(e,t,n){"use strict";function r(e){return{equals:function(t,n){return t===n||e(t,n)}}}n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"e",(function(){return d}));var i=function(e){return function(t){return a(t,e)}},a=function(e,t){return r((function(n,r){return e.equals(t(n),t(r))}))},s={equals:function(e,t){return e===t}};var o=s,c=s,u=s;function d(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return o}));const r=e=>Object.assign({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{}},c(e)),i=e=>Object.assign({id:e.id||null,name:e.name,time:(u(e.time)?e.time:new Date).toISOString(),properties:e.properties||{}},c(e)),a=(e,t)=>Object.assign({id:e.id,time:new Date(e.time),name:t.name,properties:t.properties},c(t)),s=e=>void 0!==e.request_id,o=e=>void 0!==e.properties,c=e=>Object.assign(Object.assign({},e.session_id?{session_id:e.session_id}:{}),e.view_id?{view_id:e.view_id}:{}),u=e=>isFinite(e)&&e instanceof Date},function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d}));var r=n(4),i=n(0);const a=(e,t)=>e in t,s=e=>Object.entries(e).filter(([e,t])=>{var n;return!0===(null===(n=t.result)||void 0===n?void 0:n.result)}).map(([e,t])=>parseInt(e,10)),o=e=>e.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:!0}),{}),c=e=>Object(r.i)(e,(e,t)=>t.state?Object(i.n)({[t.checksum]:t.state}):i.m),u=(e,t,n)=>e.filter(e=>{var r,i,a,s;return(null===(i=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.client)||void 0===i?void 0:i.type)===t&&(null===(s=null===(a=null==e?void 0:e.properties)||void 0===a?void 0:a.client)||void 0===s?void 0:s.domain)===n}),d=(e,t=100)=>{const n={SegmentEntry:1,SegmentExit:1,ThirdPartySegments:1,PageviewEngagement:1,SlotClicked:1,SlotRendered:1,SlotViewable:1,Reaction:1,PrebidBid:1,PrebidBids:1,rtaBid:1};return e.filter(e=>!n[e.name]).slice(-1*t)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return O}));var r,i=n(3),a=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(){function e(e,t,n,r){this.name=e,this.is=t,this.validate=n,this.encode=r,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,n){var r=this;return void 0===n&&(n="pipe("+this.name+", "+t.name+")"),new e(n,t.is,(function(e,n){var a=r.validate(e,n);return Object(i.m)(a)?a:t.validate(a.right,n)}),this.encode===o&&t.encode===o?o:function(e){return r.encode(t.encode(e))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(e){return this.validate(e,[{key:"",type:this,actual:e}])},e}(),o=function(e){return e},c=i.o,u=function(e,t,n){return c([{value:e,context:t,message:n}])},d=i.r,l=(new(function(e){function t(){var t=e.call(this,"null",(function(e){return null===e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="NullType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"undefined",(function(e){return void 0===e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="UndefinedType",t}return a(t,e),t}(s))),f=(new(function(e){function t(){var t=e.call(this,"void",l.is,l.validate,o)||this;return t._tag="VoidType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"unknown",(function(e){return!0}),d,o)||this;return t._tag="UnknownType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"string",(function(e){return"string"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="StringType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"number",(function(e){return"number"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="NumberType",t}return a(t,e),t}(s))),_=(new(function(e){function t(){var t=e.call(this,"bigint",(function(e){return"bigint"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="BigIntType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"boolean",(function(e){return"boolean"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="BooleanType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"UnknownArray",Array.isArray,(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="AnyArrayType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"UnknownRecord",(function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Window]"===t}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="AnyDictionaryType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"Function",(function(e){return"function"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="FunctionType",t}return a(t,e),t}(s)),function(e){function t(t,n,r,i,a,s){var o=e.call(this,t,n,r,i)||this;return o.type=a,o.predicate=s,o._tag="RefinementType",o}return a(t,e),t}(s)),p=(h(f,(function(e){return Number.isInteger(e)}),"Int"),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.value=a,s._tag="LiteralType",s}a(t,e)}(s),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.keys=a,s._tag="KeyofType",s}a(t,e)}(s),Object.prototype.hasOwnProperty,function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.runDefinition=a,s._tag="RecursiveType",s}return a(t,e),t}(s));Object.defineProperty(p.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.type=a,s._tag="ArrayType",s}a(t,e)})(s),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.props=a,s._tag="InterfaceType",s}a(t,e)}(s),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.props=a,s._tag="PartialType",s}a(t,e)}(s),function(e){function t(t,n,r,i,a,s){var o=e.call(this,t,n,r,i)||this;return o.domain=a,o.codomain=s,o._tag="DictionaryType",o}a(t,e)}(s);var g=function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.types=a,s._tag="UnionType",s}return a(t,e),t}(s);!function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.types=a,s._tag="IntersectionType",s}a(t,e)}(s);!function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.types=a,s._tag="TupleType",s}a(t,e)}(s);(function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.type=a,s._tag="ReadonlyType",s}a(t,e)})(s),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.type=a,s._tag="ReadonlyArrayType",s}a(t,e)}(s),function(e){function t(t,n,r,i,a,s){var o=e.call(this,t,n,r,i,a)||this;return o.tag=s,o}a(t,e)}(g),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.type=a,s._tag="ExactType",s}a(t,e)}(s),new(function(e){function t(){var t=e.call(this,"never",(function(e){return!1}),(function(e,t){return u(e,t)}),(function(){throw new Error("cannot encode never")}))||this;return t._tag="NeverType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"any",(function(e){return!0}),d,o)||this;return t._tag="AnyType",t}return a(t,e),t}(s)),new(function(e){function t(){var t=e.call(this,"object",(function(e){return null!==e&&"object"==typeof e}),(function(e,n){return t.is(e)?d(e):u(e,n)}),o)||this;return t._tag="ObjectType",t}return a(t,e),t}(s));function h(e,t,n){var r;return void 0===n&&(n="("+e.name+" | "+(((r=t).displayName||r.name||"<function"+r.length+">")+")")),new _(n,(function(n){return e.is(n)&&t(n)}),(function(n,r){var a=e.validate(n,r);if(Object(i.m)(a))return a;var s=a.right;return t(s)?d(s):u(s,r)}),e.encode,e,t)}h(f,Number.isInteger,"Integer"),function(e){function t(t,n,r,i,a){var s=e.call(this,t,n,r,i)||this;return s.props=a,s._tag="StrictType",s}a(t,e)}(s);var m=n(2),b=n(7),v=n(6),y=n(5);function w(e){switch(e.kind){case"null":return k.encode(e);case"string":return j.encode(e);case"number":return E.encode(e);case"array":return q.encode(e);case"object":return P.encode(e)}}function O(e){return null===e?k.decode(e):"number"==typeof e?E.decode(e):"string"==typeof e?j.decode(e):Array.isArray(e)?q.decode(e):P.decode(e)}const k=new s("simpleNullCodec",e=>{const t=e;return"null"===t.kind&&null===t.value},(e,t)=>null===e?d(Object(m.j)()):u(e,t),e=>e.value),j=new s("simpleStringCodec",e=>{const t=e;return"string"===t.kind&&"string"==typeof t.value},(e,t)=>"string"==typeof e?d(Object(m.m)(e)):u(e,t),e=>e.value),E=new s("simpleNumberCodec",e=>{const t=e;return"number"===t.kind&&"number"==typeof t.value},(e,t)=>"number"==typeof e?d(Object(m.k)(e)):u(e,t),e=>e.value),q=new s("simpleArrayCodec",e=>{const t=e;return"array"===t.kind&&Array.isArray(t.value)},(e,t)=>{if(Array.isArray(e)){const t=Object(b.p)(i.e)(O)(e);return Object(i.p)(m.i)(t)}return u(e,t)},e=>e.value.map(w)),P=new s("simpleObjectCodec",e=>"object"===e.kind,(e,t)=>{if(e&&e.constructor===Object){const t=Object(b.p)(i.e)(([e,t])=>Object(v.a)(O(t),Object(i.p)(t=>Object(y.g)(e,t))))(Object.entries(e));return Object(i.p)(e=>Object(m.l)(new Map([...e])))(t)}return u(e,t)},e=>{const t=[...e.value.entries()];return Object.assign({},...Array.from(t,([e,t])=>({[e]:w(t)})))});new s("simpleJsonCodec",e=>k.is(e)||E.is(e)||j.is(e)||q.is(e)||P.is(e),O,w)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n(0),i=n(7),a=n(6),s=n(5),o=n(11);class c{constructor(e,t,n){this._internals=e,this.permutive=t,this.network=n,this.providers={},this.identities=this._internals.state.getPermutiveData("identities")||{},this.aliases=this._internals.state.getPermutiveData("aliases")||{}}prepareThirdPartyIdentities(){const e=this._internals.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),t=[Promise.resolve().then(n.bind(null,45))];return Promise.all(t).then(e=>Promise.all(e.map(e=>e.make(this._internals,this.network,this.permutive)))).then(e=>Object(a.a)(Object(i.b)(e),e=>Promise.all(e.map(e=>this.shouldAskForNewIdentity(e)?this.retrieveIdentity(e):Promise.resolve(Object(s.g)(e,this.getCachedIdentity(e.tag))))))).then(e=>e.map(([e,t])=>(this.providers[e.tag]=e,this.setIdentityAndAliasIfPresent(e.tag,t,e.ttlInSeconds)))).then(()=>this._internals.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",e))}getIdentities(e=!1){const t=t=>this.identities[t].value&&(!e||this.providers[t].usedForThirdPartyData);return Object.keys(this.identities).reduce((e,n)=>Object.assign(Object.assign({},e),t(n)?{[n]:this.identities[n].value}:{}),{})}getAliasesFromIdentifyArg(e){if("string"!=typeof e&&"object"!=typeof e||null===e||""===e)throw new Error("Identify must be passed a non-empty string or list of aliases, value passed was '"+e+"'");return"string"==typeof e?[{id:e,tag:"default"}]:e}aliasMapToPrioritizedList(e){const t={default:0,appnexus:1},n=e=>Object(r.j)(this._internals.identities.getCachedIdentity(e))?0:e in t?t[e]+1:1;return Object.keys(e).map(t=>({id:e[t],tag:t,priority:n(t)}))}shouldAskForNewIdentity(e){const t=Object(r.c)(this.identities[e.tag]);return Object(r.a)(()=>!0,t=>this.isIdentityExpired(e.tag))(t)}getCachedIdentity(e){return this.identities[e]?Object(r.c)(this.identities[e].value):r.m}setIdentityAndAliasIfPresent(e,t,n=86400){return Object(r.a)(()=>{this.identities[e]={expiry:Date.now()+Math.floor(1e3*n)},this._internals.state.setPermutiveData("identities",this.identities)},t=>{this.identities[e]={value:t,expiry:Date.now()+Math.floor(1e3*n)},this.setAlias(t,e),this._internals.state.setPermutiveData("identities",this.identities)})(t)}setAlias(e,t){this.aliases[t]=e,this._internals.state.setPermutiveData("aliases",this.aliases)}retrieveIdentity(e){return e.getId().then(t=>"skipped"===t.type?Object(s.g)(e,r.m):Object(a.a)(t.result,t=>this._internals.metrics.track({name:Object(r.k)(t)?"sdk_third_party_identity_present_count":"sdk_third_party_identity_missing_count",value:1,labels:{identity_tag:e.tag}}),n=>Object(s.g)(e,t.result)))}isIdentityExpired(e){return Date.now()>=this.identities[e].expiry}}const u=(e,t,n,r)=>{const a={"e43c8a90-d17b-4790-bfda-81b069b3b8c2":(e,t,n)=>["thestudentroom.co.uk"].some(e=>n.indexOf(e)>-1)&&Object(i.k)(o.d)(t,["tsr-"]).length>0,"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":(e,t)=>{const n=["(null)"];return n.indexOf(e)>-1||!!d[e]||Object(i.k)(o.d)(t,n).length>0}}[e];return!!a&&a(r,t,n)},d={}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));class r{}class i{constructor(){this.replacementMap={}}register(e){this.replacementMap=Object.assign(Object.assign({},this.replacementMap),e.replacementMap)}enrich(e){const t=[{},!0];for(let n=0;n<Object.keys(e[0]).length;n++){const r=Object.keys(e[0])[n],i=e[0][r];switch(!0){case"string"==typeof i&&"$"===i[0]:const[e,n]=this.isPropertyReplaceable(i);t[0][r]=e?n:i,t[1]=!!e&&t[1];break;case null!==i&&"object"==typeof i&&i.constructor===Object:const a=this.enrich([i,t[1]]);t[0][r]=a[0],t[1]=t[1]&&a[1];break;default:t[0][r]=i}}return t}isPropertyReplaceable(e){const t=this.replacementMap[e];return[this.replacementMap.hasOwnProperty(e)&&t!==e,t]}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return H})),n.d(t,"a",(function(){return V}));var r=n(2),i=n(8);const a=(e,t)=>{switch(e.kind){case"bottom":return Object(r.a)();case"inner":return Object(r.e)(t(e.a));case"top":return Object(r.o)(e.error)}},s=e=>Object(i.b)((t,n)=>{if("bottom"===t.kind&&"bottom"===n.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===n.kind)return 1;if("top"===t.kind&&"top"===n.kind)return i.j.compare(t.error,n.error);if("top"===t.kind)return 1;if("top"===n.kind)return-1;if("inner"===t.kind&&"inner"===n.kind)return e.compare(t.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});var o=n(0),c=(n(5),n(1));var u=c.C;c.Mb;function d(e){return c.lb(e)?Object(o.n)(e):o.m}c.fb;c.Fb;var l=c.cb;c.ub;c.jc,c.ic,c.ec,c.i.map,c.j.mapWithIndex,c.c.ap,c.k.chain,c.d.extend,c.g.reduce,c.g.foldMap,c.g.reduceRight,c.l.traverse,c.a.alt,c.h.reduceWithIndex,c.h.foldMapWithIndex,c.h.reduceRightWithIndex,c.m.traverseWithIndex,c.o,c.p,c.q,c.s,c.v,c.w,c.I,c.L,c.W,c.rb,c.sb,c.Ab,c.Db,c.Bb,c.Cb,c.Wb,c.Lb,c.Xb;var f=u,_=function(e){return d(c.bb(e))},p=l;var g=n(7),h=n(3),m=n(19);function b(e,t){return Object(g.b)(e.map(t))}function v(e,t,n,r){const a=(e,t)=>{if(0===e.length)return Object(g.b)(t.map(e=>Object(o.n)({1:e[1],2:n(o.m,Object(o.n)(e[2]))})));if(0===t.length)return Object(g.b)(e.map(e=>Object(o.n)({1:e[1],2:n(Object(o.n)(e[2]),o.m)})));if(e.length>0&&t.length>0&&Object(i.f)(r)(e[0][1],t[0][1])){const[r,...i]=e,s=r[1],c=r[2];return f({1:s,2:n(Object(o.n)(c),o.m)},a(i,t))}if(e.length>0&&t.length>0&&Object(i.e)(r)(e[0][1],t[0][1])){const[r,...i]=t,s=r[1],c=r[2];return f({1:s,2:n(o.m,Object(o.n)(c))},a(e,i))}if(e.length>0&&t.length>0){const[r,...i]=e,[s,...c]=t,u=r[1],d=r[2],l=s[2];return f({1:u,2:n(Object(o.n)(d),Object(o.n)(l))},a(i,c))}throw new Error("Non exhaustive match in mapOption2")},s=Object(i.a)(e=>e[1])(r),c=(e=>{const t=b(e,e=>Object(o.k)(e[2])?Object(o.n)({1:e[1],2:e[2].value}):o.m);return 0===t.length?o.m:Object(o.n)(t)})(a(Object(g.m)(s)([...e].map(e=>({1:e[0],2:e[1]}))),Object(g.m)(s)([...t].map(e=>({1:e[0],2:e[1]})))));return Object(o.l)(e=>new Map(e.map(e=>[e[1],e[2]])))(c)}function y(e,t,n,r){const a=Object(i.a)(e=>e[0])(r),s=Object(g.m)(a)([...t]).reduceRight((e,t)=>{if(Object(h.m)(e)){const r=n(t[1],e.left);return Object(o.k)(r)?Object(h.o)(r.value):Object(h.r)(t[0])}return e},Object(h.o)(e));return Object(o.b)(s)}function w(e,t){return new Map([...e].map(t))}function O(e,t){return new Map([...e].filter(t))}var k=n(11),j=n(6);function E(e){return Object(o.l)(I)(function(e){switch(e.state.kind){case"top":return Object(o.n)(Object(r.m)(e.state.error));case"bottom":return o.m;case"inner":return function(e){return function(e){switch(e.kind){case"numberGroup":case"stringGroup":return q(e.group);case"tuple":return e.tuple.length>0}}(e.payload)?Object(o.n)(Object(r.i)(function(e,t){const n=Object(o.l)(e=>f(e,t))(e);return Object(o.g)(()=>t)(n)}(Object(o.l)(e=>Object(r.m)(function(e){const t=e=>{switch(e){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return e.map(e=>1===e[2]?t(e[1]):t(e[1])+JSON.stringify(e[2])).join("")}(e)))(e.commands),function(e){const t=e=>{switch(e.kind){case"bottom":return Object(r.j)();case"top":return Object(r.m)(e.error);case"inner":return Object(r.k)(e.a)}};switch(e.kind){case"tuple":return e.tuple.map(t);case"stringGroup":return n=e.group,b([P,S,e=>Object(j.a)(e,T,r.l,o.n)],e=>e(n));case"numberGroup":return(e=>b([P,M,e=>Object(j.a)(e,T,e=>w(e,([e,t])=>[JSON.stringify(e),t]),r.l,o.n)],t=>t(e)))(e.group)}var n}(e.payload)))):o.m}(e.state.a)}}(e))}function q(e){switch(e.kind){case"unbounded":return e.group.size>0;case"windowed":return e.group.size>0||Object(o.k)(e.key);case"countLimit":case"uniqueLimit":return e.group.size>0||Object(o.k)(e.limit)}}function P(e){switch(e.kind){case"unbounded":return o.m;case"windowed":return Object(o.n)(Object(r.m)("w"));case"countLimit":return Object(o.n)(Object(r.m)(1===e.n?"x":"x"+e.n));case"uniqueLimit":return Object(o.n)(Object(r.m)(1===e.n?"u":"u"+e.n))}}function S(e){switch(e.kind){case"unbounded":return o.m;case"windowed":return Object(o.n)(Object(r.m)(Object(o.k)(e.key)?e.key.value:""));case"countLimit":case"uniqueLimit":return Object(o.n)(Object(r.m)(Object(o.k)(e.limit)?e.limit.value:""))}}function M(e){switch(e.kind){case"unbounded":return o.m;case"windowed":return Object(o.k)(e.key)?Object(o.n)(Object(r.k)(e.key.value)):Object(o.n)(Object(r.j)());case"countLimit":case"uniqueLimit":return Object(o.k)(e.limit)?Object(o.n)(Object(r.k)(e.limit.value)):Object(o.n)(Object(r.j)())}}function T(e){switch(e.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return e.group}}function I(e){switch(e.kind){case"array":return 0===e.value.length?Object(r.j)():1===e.value.length?I(e.value[0]):Object(r.i)(e.value.map(I));case"object":return Object(j.a)(O(e.value,([e,t])=>"null"!==t.kind),e=>w(e,e=>[e[0],I(e[1])]),r.l);default:return e}}function x(e){const t=e=>{if(0===e.length)return Object(r.a)();const t=(e=>{if(4!==e.length)return o.m;const[t,n,r,i]=e;if("string"===t.kind&&"string"===n.kind&&"object"===i.kind){const e=Object(o.d)(e=>C(e[1].value)&&D(e[2].value))({1:t,2:n});return Object(o.l)(e=>({prim:e[1].value,grp:e[2].value,cutoff:r,m:i.value}))(e)}return o.m})(e);if(Object(o.k)(t)){const{prim:e,grp:n,cutoff:i,m:a}=t.value,s=A(i,a,L(n));return"string"==typeof s?Object(r.o)(s):Object(r.e)(Object(r.f)(R(e),s))}const n=(e=>{if(3!==e.length)return o.m;const[t,n,r]=e;if("string"===t.kind&&"object"===r.kind){const e=Object(o.d)(e=>D(e.value))(t);return Object(o.l)(e=>({grp:e.value,cutoff:n,m:r.value}))(e)}return o.m})(e);if(Object(o.k)(n)){const{grp:e,cutoff:t,m:i}=n.value,a=A(t,i,L(e));return"string"==typeof a?Object(r.o)(a):Object(r.e)(Object(r.f)(o.m,a))}const i=(e=>{if(2!==e.length)return o.m;const[t,n]=e;if("string"===t.kind&&"object"===n.kind){const e=Object(o.d)(e=>C(e.value))(t);return Object(o.l)(e=>({prim:e.value,m:n.value}))(e)}return o.m})(e);if(Object(o.k)(i)){const{prim:e,m:t}=i.value;return Object(r.e)(Object(r.f)(R(e),Object(r.n)(Object(r.q)(t))))}const a=(e=>{if(1!==e.length)return o.m;const[t]=e;return"object"===t.kind?Object(o.n)({m:t.value}):o.m})(e);if(Object(o.k)(a)){const{m:e}=a.value;return Object(r.e)(Object(r.f)(o.m,Object(r.n)(Object(r.q)(e))))}const s=(e=>{if(e.length<1)return o.m;const[t,...n]=e;if("string"===t.kind){const e=Object(o.d)(e=>C(e.value))(t);return Object(o.l)(e=>({prim:e.value,rest:n}))(e)}return o.m})(e);if(Object(o.k)(s)){const{prim:e,rest:t}=s.value;return Object(r.e)(Object(r.f)(R(e),N(t)))}return Object(r.e)(Object(r.f)(o.m,N(e)))},n=e=>{switch(e.kind){case"array":return Object(g.a)(n)(e.value);default:return[e]}};switch(e.kind){case"null":return Object(r.d)(Object(r.a)());default:return Object(r.d)(t(n(e)))}}function C(e){const t=e.split("");switch(!0){case 0===t.length:return!1;default:{const[e,...n]=t;return-1!=="pmvn".indexOf(e)&&n.every(e=>-1!=="pmvn0123456789".indexOf(e))}}}function D(e){const t=e.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[e,...n]=t;return-1!=="ux".indexOf(e)&&-1===n.map(e=>!isNaN(parseInt(e))).indexOf(!1)}}}function A(e,t,n){switch(e.kind){case"string":return Object(r.n)(n({1:Object(o.n)(e.value),2:t}));case"number":case"null":return Object(r.g)(n({1:"null"===e.kind?o.m:Object(o.n)(e.value),2:O(w(t,([e,t])=>[Number(e),t]),e=>!isNaN(e[0]))}));default:return"{bad cutoff}"}}function L(e){const t=e=>t=>Object(r.r)(t[2],t[1],e),n=e=>t=>Object(r.c)(t[2],t[1],e),i=e.split("");switch(!0){case"w"===i[0]&&void 0===i[1]:return e=>Object(r.s)(e[2],e[1]);case"u"===i[0]&&void 0===i[1]:return t(1);case"u"===i[0]&&void 0!==i[1]:return t(parseInt(i.slice(1).join("")));case"x"===i[0]&&void 0===i[1]:return n(1);case"x"===i[0]&&void 0!==i[1]:return n(parseInt(i.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function R(e){return Object(o.l)(r.h)(_(function e(t,n){const r=n(t);return Object(o.g)(()=>[])(Object(o.l)(t=>[t[1]].concat(e(t[2],n)))(r))}(e,e=>{const t=e.split("");if(0===t.length)return o.m;const[n,...r]=t,i=(e=>{switch(e){case"p":return Object(o.n)("add");case"m":return Object(o.n)("mul");case"v":return Object(o.n)("max");case"n":return Object(o.n)("min");default:return o.m}})(n);return Object(o.l)(e=>{const{init:t,rest:n}=Object(g.n)(e=>{return"number"==typeof(t=parseInt(e))&&isFinite(t)&&Math.floor(t)===t;var t})(r);return{1:{1:e,2:0===t.length?1:parseInt(t.join(""))},2:n.join("")}})(i)})))}function N(e){return Object(r.p)(e.map(U))}function U(e){switch(e.kind){case"number":return Object(r.e)(e.value);case"string":return Object(r.o)(e.value);case"null":return Object(r.a)();case"object":return Object(r.o)("{object}");case"array":return Object(r.o)("{array}")}}const B=Object(r.b)({strategy:(e,t,n)=>r=>{if(Object(o.j)(n))return t;if("delta"===e&&Object(o.j)(t))return o.m;if(Object(o.j)(t))return n;if(Object(o.k)(t)&&Object(o.k)(n))return r(t.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(e,t,n,a,o,c)=>{const u=Object(g.j)(s(c));if("append"===e&&"add"===t)return Object(g.r)(n,a,J(o.plus));if("append"===e&&"mul"===t)return Object(g.r)(n,a,J(o.times));if("append"===e&&"max"===t)return Object(i.g)(u)(n,a);if("join"===e&&"add"===t)return Object(g.r)(n,a,J(Object(i.g)(c)));if("join"===e&&"mul"===t)return Object(g.r)(n,a,J(Object(i.g)(c)));if("join"===e&&"max"===t)return Object(i.g)(u)(n,a);if("min"===t)return B.operation(e,"max",n,a,o,function(e){return Object(i.b)((t,n)=>Object(m.a)(e.compare(t,n)))}(c));if("delta"===e&&"max"===t)return Object(i.e)(u)(n,a)?n:a.map(r.a);if("delta"===e)return Object(g.r)(n,a,(e,t)=>Object(i.e)(s(c))(e,t)?e:Object(r.a)());throw new Error("Non exhaustive match in combineCommand.operation")}}),K={plus:(e,t)=>e+t,times:(e,t)=>e*t};function W(e,t,n,a){if("unbounded"===e.kind&&"unbounded"===t.kind){const i=e.group,s=t.group;return Object(o.g)(r.a)(Object(o.l)(e=>Object(r.e)(Object(r.q)(e)))(v(i,s,n,a)))}if("windowed"===e.kind&&"windowed"===t.kind){const s=e.key,c=e.group,u=t.key,d=t.group,l=Object(i.g)(Object(o.h)(a))(s,u);return Object(o.g)(r.a)(Object(o.l)(e=>Object(r.e)(Object(r.s)(e,l)))(v(c,d,n,a)))}if("countLimit"===e.kind&&"countLimit"===t.kind){const s=e.n,c=t.n;if(s===c){const c=e.limit,u=e.group,d=t.limit,l=t.group,f=Object(i.g)(Object(o.h)(a))(c,d);return Object(o.g)(r.a)(Object(o.l)(e=>Object(r.e)(Object(r.c)(e,f,s)))(v(u,l,n,a)))}return Object(r.o)("Non matching counts")}if("uniqueLimit"===e.kind&&"uniqueLimit"===t.kind){const s=e.n,c=t.n;if(s===c){const c=e.limit,u=e.group,d=t.limit,l=t.group,f=Object(i.g)(Object(o.h)(a))(c,d);return Object(o.g)(r.a)(Object(o.l)(e=>Object(r.e)(Object(r.r)(e,f,s)))(v(u,l,n,a)))}return Object(r.o)("Non matching counts")}return Object(r.o)("Non matching group types")}function z(e,t,n){return Object(o.g)(r.j)(function e(t,n){const s=n=>(r,i)=>B.strategy(t,r,i)(e(t,n)),c=(e,n,c)=>{if("stringGroup"===n.kind&&"stringGroup"===c.kind){const t=W(n.group,c.group,s(e),i.j);return a(t,e=>Object(r.n)(G(e,i.j)))}if("numberGroup"===n.kind&&"numberGroup"===c.kind){const t=W(n.group,c.group,s(e),i.i);return a(t,e=>Object(r.g)(G(e,i.i)))}if("tuple"===n.kind&&"tuple"===c.kind){const a=Object(o.k)(e)?e.value:[];return Object(r.e)(Object(r.p)(function(e,t,n,i,a,s){const o=(e,t)=>({1:Object(g.o)(e)(t).concat([...Array(Math.max(0,e-t.length))].map(r.a)),2:Object(g.d)(e)(t)}),c=(t,n,r)=>{if(0===t.length)return B.operation(e,"max",n,r,a,s);if(0===n.length)return r;if(0===r.length)return n;if(t.length>0){const[i,...u]=t,d=o(i[2],n),l=d[1],f=d[2],_=o(i[2],r),p=_[1],g=_[2];return B.operation(e,i[1],l,p,a,s).concat(c(u,f,g))}throw new Error("Non exhaustive match in recurse")};return Object(g.l)(Object(g.e)(e=>"bottom"===e.kind)(Object(g.l)(c(t,n,i))))}(t,a,n.tuple,c.tuple,K,i.i)))}throw new Error(`Non matching payload. Got ${n.kind} and ${c.kind}`)},u=(e,t)=>{if(Object(o.e)(p(Object(k.e)({1:k.d,2:k.c}))).equals(e.commands,t.commands)){const i=Object(o.j)(e.commands)?n:e.commands,s=c(i,e.payload,t.payload);return a(s,t=>Object(r.f)(e.commands,t))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(e)} and ${JSON.stringify(t)}`)};return(e,t)=>E(Object(r.d)(F(u,x(e).state,x(t).state)))}(e,o.m)(t,n))}function $(e,t,n){const r=Object(o.l)(t=>O(e,([e,r])=>Object(i.c)(n)(e,t)))(t);return Object(o.g)(()=>e)(r)}function G(e,t){switch(e.kind){case"unbounded":return e;case"windowed":return Object(o.j)(e.key)?e:Object(r.s)($(e.group,e.key,t),e.key);case"countLimit":{const n=e.limit,a=e.n,s=e.group,c=y(a,s,(e,t)=>t<=1?o.m:Object(o.n)(t-1),t),u=Object(i.g)(Object(o.h)(t))(n,c);return Object(r.c)($(s,u,t),u,a)}case"uniqueLimit":{const n=e.limit,a=e.n,s=e.group,c=(e,t)=>{switch(e.kind){case"object":{const n=[...e.value.keys(),...t.keys()],r=new Set(n);return r.size>=a?o.m:Object(o.n)(r)}default:return o.m}},u=y(new Set,s,c,t),d=Object(i.g)(Object(o.h)(t))(n,u);return Object(r.r)($(s,d,t),d,a)}}}function F(e,t,n){if("inner"===t.kind&&"inner"===n.kind)return e(t.a,n.a);if("bottom"===t.kind)return n;if("bottom"===n.kind)return t;if("top"===t.kind&&"top"===n.kind)return Object(r.o)(Object(i.g)(i.j)(t.error,n.error));if("top"===t.kind)return t;if("top"===n.kind)return n;throw new Error("Non exhaustive match in extend")}function J(e){return(t,n)=>F((t,n)=>Object(r.e)(e(t,n)),t,n)}function H(e,t){return z("join",e,t)}function V(e,t){return z("delta",e,t)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));var r=n(4);class i{track(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}class a{constructor(e,t,n){this.sdkInitTimestamp=e,this._internals=t,this.permutive=n,this.sendFrequencyInSeconds=5,this.pendingMetrics=[],this.pendingTimers={},this.permutive.ready(()=>{window.setInterval(this.processPending.bind(this),1e3*this.sendFrequencyInSeconds),Object(r.m)(()=>{this.processPending.bind(this)},navigator.userAgent)}),this.track({name:"sdk_initialisation_start_time_seconds",value:e/1e3,labels:{}})}track(e){this.pendingMetrics.push(e)}trackTimeSinceInit(e,t){const n=performance.now();this.track({name:e,value:(n-this.sdkInitTimestamp)/1e3,labels:t})}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=performance.now();this.track({name:e,value:(r-n.startTime)/1e3,labels:n.labels}),delete this.pendingTimers[t]}}processPending(){this.pendingMetrics.length>0&&(this._internals.api.metrics({context:{environment:"web",events_count:this._internals.state.eventsCache.all().length,segments_count:this._internals.queryManager.userSegments.length},items:this.pendingMetrics}),this.pendingMetrics=[])}generateRandomKey(e){return`${e}-${[...Array(24)].map(()=>Math.random().toString(36)[2]).join("")}`}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r={concat:function(e,t){return 0!==e?e:t},empty:0};function i(e){switch(e){case-1:return 1;case 1:return-1;default:return 0}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return c}));var r=n(4);class i{constructor(e,t){this.userId=e,this.aliases=t,this.resource="userTPD",this.query=()=>{const e=this.aliases.map(({id:e,tag:t,priority:n})=>`{id: "${e}", tag: "${t}", priority: ${n}}`).join(",");return`\n      userTPD: user(user_id: "${this.userId}") {\n        identity(aliases: [${e}]) {\n          tpd {\n            name\n            segments\n          }\n        }\n      }\n    `}}}var a=n(11),s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const o={permutive:"1",eyeota:"2",skimlinks:"4",comscore:"5",eyeota_bombora:"6",eyeota_aimmatic:"7",eyeota_alc:"8",eyeota_amberdata:"9",eyeota_caci:"10",eyeota_corelogic:"11",eyeota_dlg:"12",eyeota_dataxpand:"13",eyeota_dunbradstreet:"14",eyeota_experian:"15",eyeota_gbgtransactis:"16",eyeota_gfk:"17",eyeota_rdaresearch:"18",eyeota_kantarmedia:"19",eyeota_mastercard:"20",eyeota_meritdirect:"21",eyeota_netsprint:"22",eyeota_nri:"23",eyeota_onaudience:"24",eyeota_pacificdatapartners:"25",eyeota_plungedigital:"26",eyeota_roymorgan:"27",eyeota_schober:"28",eyeota_sharethis:"30",eyeota_skimlinks:"31",eyeota_specialists:"32",eyeota_statsocial:"33",eyeota_stirista:"34",eyeota_yougov:"36"};class c{constructor(e,t,n){this._internals=e,this.permutive=t,this.network=n,this._internals.log("Enabling tpd reporting"),this._internals.messages.on("permutive:segments:updated",()=>{this.reportUsage()});const r=this._internals.state.getPermutiveData("third-party-data");this.userSegments=this.isValidState(r)?r:{},this.lastCheckedSession=this._internals.state.getPermutiveData("third-party-data-session-id")||""}segments(){if(this.segmentsPromise)return this.segmentsPromise;const e=this._internals.sessionManager.getSessionId();if(this.lastCheckedSession===e)return Promise.resolve(this.userSegments);const t=Object(r.b)();this.lastCheckedSession=e;const n=this._internals.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{}),s=Object.assign(Object.assign({},this._internals.identities.getIdentities(!0)),this._internals.identities.aliases);if(Object.keys(s).length>0){const e=new i(this._internals.state.userId||Object(r.o)(),this._internals.identities.aliasMapToPrioritizedList(s));this._internals.graphql.register(e).then(e=>{const n=this.graphQLTPDResponseToSegmentMap(e);this.updateCache(n),t.resolve(n)}).catch(e=>{this.network.error("Third Party Data segments retrieval failed with reason: "+e,this._internals.state.userId),t.resolve({})})}else t.resolve({});const o=this._internals.promises.getPromisesByCategory("tpd"),c=Promise.all(o.map(e=>e.promise)).then(e=>t.promise).then(e=>this.userSegments);return c.then(t=>{this._internals.state.setPermutiveData("third-party-data-session-id",e),this._internals.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",n);const i=this._internals.state.getPermutiveData("third-party-data");i&&Object(r.c)(Object(r.c)(a.b)).equals(i,t)||(this._internals.state.setPermutiveData("third-party-data",this.userSegments),Object.entries(t||{}).forEach(([e,t])=>{i&&Object(r.c)(a.b).equals(i[e],t)||this.fireSegments(e,Object.keys(t))}))}),this.segmentsPromise=c,this.segmentsPromise}addSegments(e,t){this.updateCache({[e]:this.listToSegmentMap(t)})}getActivationMetadata(){const e=this.tpdUsage(this._internals.queryManager.stateMap.value),t={};for(const n in e)if(e.hasOwnProperty(n)){const r=[],i=Object.assign({},e[n]);Object.keys(i).forEach(e=>{i[e].forEach(t=>{r.push([n,o[e],t].join("-"))})}),t[n]=r}return t}updateCache(e){this.userSegments=Object(r.j)(this.userSegments,e)}fireSegments(e,t){this.permutive.track("ThirdPartySegments",{data_provider:e,segments:t},{isAnalyticsOnly:!0})}reportUsage(){const e=this.tpdUsage(this._internals.queryManager.stateMap.value),t=Object(r.f)(JSON.stringify(e));if(this._internals.state.getPermutiveData("third-party-data-usage")!==t&&Object.keys(e).length>0){this._internals.state.setPermutiveData("third-party-data-usage",t);const n={user_id:this._internals.state.userId,time:new Date,tpd_segments:e};this._internals.api.tpdUsage(n)}}graphQLTPDResponseToSegmentMap(e){return e.identity.tpd.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:this.listToSegmentMap(t.segments)}),{})}listToSegmentMap(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}isValidState(e){return void 0===(null==e?void 0:e.expiry_time)}tpdUsage(e){const t={},n=Object.keys(e),r=n.length;for(let i=0;i<r;i++){const r=n[i],a=e[r],{activations:o}=a;s(a,["activations"]);Object.keys(o).length>0&&(t[r]=o)}return t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.config=e,this.clientErrorsSent=0}getEndpointUrl(e,t){return`${this.config.apiProtocol}://${this.config.apiHost}/${t||this.config.apiVersion}${e}`}req(e,t){const n=-1===e.url.indexOf("?")?"?":"&",r=`${e.url}${n}k=${this.config.apiKey}`,i=e.method||"GET",a=e.data?JSON.stringify(e.data):"",s=e.contentType?e.contentType:"application/json";if(t&&navigator.sendBeacon){if(navigator.sendBeacon(r,a))return e.success&&e.success(a),Promise.resolve();{const t="Failed to queue beacon";return e.error&&e.error(t),Promise.reject(t)}}return this.ajax({type:i,url:r,contentType:s,dataType:e.dataType?e.dataType:"json",data:a,timeout:this.config.requestTimeout,xhrFields:e.xhrFields}).then(t=>(e.success&&e.success(t),t),t=>{throw e.error&&e.error(t),new Error(t)})}ajax(e){return new Promise((t,n)=>{const r={},i=e.dataType?e.dataType:"json",a=new XMLHttpRequest;var s,o;if(e.contentType&&(s="Content-Type",o=e.contentType,r[s.toLowerCase()]=[s,o]),"binary"===e.dataType&&(a.responseType="arraybuffer"),a.onload=function(){const e=a.getResponseHeader("content-type");if(this.status>=400){const e="text"===this.responseType||""===this.responseType?this.responseText:"Couldn't access response text";n(`Failed ajax request. Status code was ${this.status}. ${e}`)}else if("application/octet-stream"===e){const e=this.responseText?JSON.parse(window.atob(this.responseText)):null;t(e)}else if("json"===i){const e=this.responseText?JSON.parse(this.responseText):null;t(e)}else t("text"===i?this.responseText:this.response)},a.onerror=()=>{this.error("Failed AJAX request"),n(new TypeError("Network request failed"))},a.ontimeout=()=>{this.error("AJAX request timed out"),n(new TypeError("Network request timed out"))},a.open(e.type?e.type:"GET",e.url,!0),e.timeout&&(a.timeout=e.timeout),e.xhrFields)for(const t in e.xhrFields)a[t]=e.xhrFields[t];Object.keys(r).forEach(e=>{const t=r[e];a.setRequestHeader(t[0],t[1])}),a.send(e.data?e.data:null)})}error(e,t){if(this.config.sendClientErrors){if(this.clientErrorsSent>3)return;this.clientErrorsSent+=1;const n={user_id:t||"",domain:window.location.hostname?window.location.hostname:"",url:window.location.href?window.location.href:"",referrer:document.referrer?document.referrer:"",user_agent:navigator.userAgent?navigator.userAgent:"",error_message:"",stack_trace:"",additional_details:""};e instanceof Error?(void 0!==e.message&&(n.error_message=e.message.toString()),void 0!==e.stack&&(n.stack_trace=e.stack.toString())):n.additional_details=e.toString(),this.req({url:this.getEndpointUrl("/internal/errors"),method:"POST",data:n,contentType:"text/plain",dataType:"text"},!1)}else window.console&&(window.console.error?window.console.error("[Permutive]",e):window.console.log&&window.console.log("[Permutive]",e))}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(15);class i{constructor(e,t){this.userId=e,this.aliases=t,this.resource="userIdentify",this.query=()=>{const e=this.aliases.map(({id:e,tag:t,priority:n})=>`{id: "${e}", tag: "${t}", priority: ${n}}`).join(",");return Object(r.b)("2a28082a-de31-45fd-a00c-548117e422f7",this.aliases.map(e=>e.id),window.location.hostname,this.userId)?"":`\n      userIdentify: user(user_id: "${this.userId}") {\n        identity(aliases: [${e}]) {\n          identify {\n            id\n          }\n        }\n      }\n    `}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(4);const i={default:{environment:"default",apiHost:"api.permutive.com",apiKey:"",cdnBaseUrl:"cdn.permutive.com",apiVersion:"v2.0",apiProtocol:"https",loggingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+function(e){const t=e.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=e.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=e.match(/localhost/);if((null==n?void 0:n.length)>0){const t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]}return(null==t?void 0:t.length)>0?t[0]:(null==r?void 0:r.length)>0?"localhost":""}(window.location.hostname),cookieName:"permutive-id",cookieExpiry:function(){const e=new Date;return e.setFullYear(e.getFullYear()+3),e.toUTCString()}(),permutiveDataKey:"permutive-data",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:50,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"2a28082a-de31-45fd-a00c-548117e422f7.partner.permutive.app",consentRequired:!1},production:{},development:{apiProtocol:"http",loggingEnabled:!0,sendClientErrors:!1}};const a=e=>Object(r.j)(i.default,i[e.environment]||{},e)},function(e,t,n){"use strict";var r=window.URL||window.webkitURL;e.exports=function(e,t,n,i){try{try{var a;try{a=new window.Blob([e])}catch(t){(a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),a=a.getBlob()}var s=r.createObjectURL(a),o=new window[t](s,n);return r.revokeObjectURL(s),o}catch(r){return new window[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!i)throw Error("Inline worker is not supported");return new window[t](i,n)}}},function(e,t,n){"use strict";var r=0;function i(e,t){var n=t.data;if(Array.isArray(n)&&!(n.length<2)){var r=n[0],i=n[1],a=n[2],s=e._callbacks[r];s&&(delete e._callbacks[r],s(i,a))}}function a(e){var t=this;t._worker=e,t._callbacks={},e.addEventListener("message",(function(e){i(t,e)}))}a.prototype.postMessage=function(e){var t=this,n=r++,a=[n,e];return new Promise((function(e,r){if(t._callbacks[n]=function(t,n){if(t)return r(new Error(t.message));e(n)},void 0!==t._worker.controller){var s=new MessageChannel;s.port1.onmessage=function(e){i(t,e)},t._worker.controller.postMessage(a,[s.port2])}else t._worker.postMessage(a)}))},e.exports=a},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(3),i=n(6),a=n(17),s=n(14),o=n(2),c=n(4),u=n(13),d=n(5);class l{constructor(e){this._internals=e,this.fetchedUnseenState=!1,this.stateOffset=this._internals.state.getPermutiveData("state_offset")||0,this.lastSentStateMap=Object(u.f)(this._internals.state.getPermutiveData("internal_query_states")||{})}sync(e,t=this._internals.queryManager.stateMap.value,n=this.stateOffset,c=!this.fetchedUnseenState){const d=Object(i.a)(Object(u.f)(t),s.a,Object(r.j)(e=>Object(o.l)(new Map))),l=Object(i.a)(Object(s.a)(this.lastSentStateMap),Object(r.j)(e=>Object(o.l)(new Map))),f=Object(i.a)(Object(a.a)(d,l),e=>Object(s.b)(e))||{};return c||Object.keys(f).length>0?(()=>this._internals.api.state(f,n,e,c).then(e=>this.isStateResponse(e)?this.handleStateResponse(e):{},e=>(this._internals.network.error(e,this._internals.state.userId),{})).then(e=>(this.fetchedUnseenState=!0,this.lastSentStateMap=Object(u.f)(this._internals.queryManager.stateMap.value),e)))():Promise.resolve({})}resetSync(){return Promise.all([this.sync(!1,{},0,!0),this._internals.thirdParty.segments(),this._internals.models.getModels()]).then(([e,t,n])=>this._internals.queryManager.bootstrap([]).then(e=>this._internals.queryManager.updateEnvironment({segments:Object(c.j)({"1p":this._internals.queryManager.userSegmentsMap},t),lookalikeModels:n})))}reset(){this.lastSentStateMap={}}handleStateResponse(e){const t=Object(r.t)(()=>JSON.parse(e.state),e=>this._internals.network.error("Failed to parse State API response, got "+e,this._internals.state.userId)),n=e=>e?this._internals.queryManager.updateExternalState(e):Object(d.c)();return Object(r.n)(t)?Object(i.a)(e.state_offset,e=>this.stateOffset=e,e=>this._internals.state.setPermutiveData("state_offset",e),e=>n(t.right),e=>t.right):{}}isStateResponse(e){return!!e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.userId=e,this.resource="outOfSdkUserEvents",this.query=()=>`\n    outOfSdkUserEvents: user(user_id: "${this.userId}") {\n      out_of_sdk_events {\n          id\n          name\n          time\n          session_id\n          view_id\n          properties\n        }\n      }\n    `}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(5);function i(e,t,n){return function(r){for(var a=Array(n.length+1),s=0;s<n.length;s++)a[s]=n[s];return a[n.length]=r,0===t?e.apply(null,a):i(e,t-1,a)}}var a={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function s(e){return a.hasOwnProperty(e)||(a[e]=i(r.g,e-1,[])),a[e]}function o(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=s(r),a=e.map(t[0],i),o=1;o<r;o++)a=e.ap(a,t[o]);return a}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));class r{constructor(e,t,n,r,i,a,s){this.permutive=e,this._internals=t,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=a,this.workspaceLevelConfig=s}activateEveryTime(){return"EveryTime"===this.triggerType}activateOnEntry(){return"OnEntry"===this.triggerType}activateOnExit(){return"OnExit"===this.triggerType}trackImpression(e){const t={reaction_id:this.id,type:"impression"};this.permutive.track("Reaction",t,e),this._internals.log("impression: ",t)}trackConversion(e){const t={reaction_id:this.id,type:"conversion"};this.permutive.track("Reaction",t,e),this._internals.log("conversion: ",t)}}class i{constructor(e,t,n){this._internals=e,this.permutive=t,this.context=n,this.addons={facebook_pixel_v2:{workspaces:[{activations:[{id:"4c63a91c-6c14-442c-9dd7-b03968a25a36",trigger_type:"EveryTime",config:{},segment_code:13286,workspaceLevelConfig:{}},{id:"52fc2fc0-9bb1-42d1-b9d6-87f631365a28",trigger_type:"EveryTime",config:{},segment_code:16669,workspaceLevelConfig:{}},{id:"30a43639-f086-4a52-ac8a-1e4ab076af6f",trigger_type:"EveryTime",config:{},segment_code:12928,workspaceLevelConfig:{}},{id:"a234db9a-e02c-40f6-bfb6-ffcb6d3f3130",trigger_type:"EveryTime",config:{},segment_code:12999,workspaceLevelConfig:{}},{id:"7cde3d14-c6cf-4e83-9c76-8183c1cb4345",trigger_type:"EveryTime",config:{},segment_code:35792,workspaceLevelConfig:{}},{id:"14b631ed-0f59-410f-90e1-9f15b6ccbf30",trigger_type:"EveryTime",config:{},segment_code:23092,workspaceLevelConfig:{}}]}],auto_init:!0,activationConfigs:[{id:"4c63a91c-6c14-442c-9dd7-b03968a25a36",trigger_type:"EveryTime",config:{},segment_code:13286,workspaceLevelConfig:{}},{id:"52fc2fc0-9bb1-42d1-b9d6-87f631365a28",trigger_type:"EveryTime",config:{},segment_code:16669,workspaceLevelConfig:{}},{id:"30a43639-f086-4a52-ac8a-1e4ab076af6f",trigger_type:"EveryTime",config:{},segment_code:12928,workspaceLevelConfig:{}},{id:"a234db9a-e02c-40f6-bfb6-ffcb6d3f3130",trigger_type:"EveryTime",config:{},segment_code:12999,workspaceLevelConfig:{}},{id:"7cde3d14-c6cf-4e83-9c76-8183c1cb4345",trigger_type:"EveryTime",config:{},segment_code:35792,workspaceLevelConfig:{}},{id:"14b631ed-0f59-410f-90e1-9f15b6ccbf30",trigger_type:"EveryTime",config:{},segment_code:23092,workspaceLevelConfig:{}}]},overlays:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},dbm:{workspaces:[{activations:[],entity_id:339948,product_type:"INVITE_PARTNER"}],auto_init:!0,entity_id:339948,product_type:"INVITE_PARTNER",activationConfigs:[]},piano:{workspaces:[{activations:[]}],auto_init:!1,activationConfigs:[]},scriptrunner:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},dfp:{workspaces:[{activations:[],networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0,activationConfigs:[]},twitter_pixel:{workspaces:[{activations:[{id:"55edaab9-a22f-4ae9-bb45-6d35533800ab",trigger_type:"OnEntry",config:{audience_tag_id:"o29pb"},segment_code:12928,workspaceLevelConfig:{}},{id:"6cf37f6b-779d-47ef-86ef-5d31975f9cfe",trigger_type:"OnEntry",config:{audience_tag_id:"o29zs"},segment_code:14759,workspaceLevelConfig:{}},{id:"f089242c-05f2-4175-9e48-4764b7df82ab",trigger_type:"OnEntry",config:{audience_tag_id:"o29zr"},segment_code:14759,workspaceLevelConfig:{}},{id:"cad0e394-ebb3-45bc-8d81-00db7390d038",trigger_type:"OnEntry",config:{audience_tag_id:"o28y6"},segment_code:17100,workspaceLevelConfig:{}},{id:"284c231e-7c5c-443e-8d07-ebb386248cd0",trigger_type:"OnEntry",config:{audience_tag_id:"o29pi"},segment_code:14751,workspaceLevelConfig:{}},{id:"5a52c84f-bfd0-4dbd-8cf5-78ccc6338822",trigger_type:"OnEntry",config:{audience_tag_id:"o28ya"},segment_code:14751,workspaceLevelConfig:{}},{id:"dfeb2f8f-b55f-4c2f-af62-5c5268e1a2ae",trigger_type:"OnEntry",config:{audience_tag_id:"o28y8"},segment_code:17099,workspaceLevelConfig:{}},{id:"93d41c83-7ba0-4cfd-9ca0-a0166c4961c9",trigger_type:"OnEntry",config:{audience_tag_id:"o29ph"},segment_code:17099,workspaceLevelConfig:{}},{id:"4614e0d5-7e58-4633-bba3-866924b9cfcf",trigger_type:"OnEntry",config:{audience_tag_id:"o29pg"},segment_code:17100,workspaceLevelConfig:{}},{id:"50263876-3b4c-44c9-af4c-af7bb814ade9",trigger_type:"OnEntry",config:{audience_tag_id:"o28y2"},segment_code:15180,workspaceLevelConfig:{}},{id:"655f6f30-0bb5-4a86-b941-3aa934f30d52",trigger_type:"OnEntry",config:{audience_tag_id:"o28y4"},segment_code:15182,workspaceLevelConfig:{}},{id:"0dc6285e-454f-4d8c-9fa0-4fa7f480f4c8",trigger_type:"OnEntry",config:{audience_tag_id:"o29pf"},segment_code:15182,workspaceLevelConfig:{}},{id:"aaffeee9-92cb-4f4c-86b4-2cc6d98718cc",trigger_type:"OnEntry",config:{audience_tag_id:"o28xw"},segment_code:14749,workspaceLevelConfig:{}},{id:"00c76582-c308-450c-b53b-7398fcd2802c",trigger_type:"OnEntry",config:{audience_tag_id:"o29pe"},segment_code:15180,workspaceLevelConfig:{}},{id:"d62db0f5-bda8-46fa-97e0-3b4d9ada22f3",trigger_type:"OnEntry",config:{audience_tag_id:"o28xx"},segment_code:14750,workspaceLevelConfig:{}},{id:"643dfcff-1318-482c-83ea-cf5d7dc4353d",trigger_type:"OnEntry",config:{audience_tag_id:"o29pd"},segment_code:14749,workspaceLevelConfig:{}},{id:"3bf4113c-046c-405b-a2f0-c2a03dce6956",trigger_type:"OnEntry",config:{audience_tag_id:"o28xs"},segment_code:12928,workspaceLevelConfig:{}},{id:"c90c7c37-a269-4c09-aeb4-3140f5389a2e",trigger_type:"OnEntry",config:{audience_tag_id:"o29pc"},segment_code:14750,workspaceLevelConfig:{}},{id:"382fdff5-10ce-4b9a-951e-d7b8be01c7a7",trigger_type:"OnEntry",config:{audience_tag_id:"o3y2h"},segment_code:14751,workspaceLevelConfig:{}},{id:"2cceeb35-1e7e-4255-9511-1caf1a37c799",trigger_type:"OnEntry",config:{audience_tag_id:"o3xr1"},segment_code:14751,workspaceLevelConfig:{}}]}],auto_init:!0,activationConfigs:[{id:"55edaab9-a22f-4ae9-bb45-6d35533800ab",trigger_type:"OnEntry",config:{audience_tag_id:"o29pb"},segment_code:12928,workspaceLevelConfig:{}},{id:"6cf37f6b-779d-47ef-86ef-5d31975f9cfe",trigger_type:"OnEntry",config:{audience_tag_id:"o29zs"},segment_code:14759,workspaceLevelConfig:{}},{id:"f089242c-05f2-4175-9e48-4764b7df82ab",trigger_type:"OnEntry",config:{audience_tag_id:"o29zr"},segment_code:14759,workspaceLevelConfig:{}},{id:"cad0e394-ebb3-45bc-8d81-00db7390d038",trigger_type:"OnEntry",config:{audience_tag_id:"o28y6"},segment_code:17100,workspaceLevelConfig:{}},{id:"284c231e-7c5c-443e-8d07-ebb386248cd0",trigger_type:"OnEntry",config:{audience_tag_id:"o29pi"},segment_code:14751,workspaceLevelConfig:{}},{id:"5a52c84f-bfd0-4dbd-8cf5-78ccc6338822",trigger_type:"OnEntry",config:{audience_tag_id:"o28ya"},segment_code:14751,workspaceLevelConfig:{}},{id:"dfeb2f8f-b55f-4c2f-af62-5c5268e1a2ae",trigger_type:"OnEntry",config:{audience_tag_id:"o28y8"},segment_code:17099,workspaceLevelConfig:{}},{id:"93d41c83-7ba0-4cfd-9ca0-a0166c4961c9",trigger_type:"OnEntry",config:{audience_tag_id:"o29ph"},segment_code:17099,workspaceLevelConfig:{}},{id:"4614e0d5-7e58-4633-bba3-866924b9cfcf",trigger_type:"OnEntry",config:{audience_tag_id:"o29pg"},segment_code:17100,workspaceLevelConfig:{}},{id:"50263876-3b4c-44c9-af4c-af7bb814ade9",trigger_type:"OnEntry",config:{audience_tag_id:"o28y2"},segment_code:15180,workspaceLevelConfig:{}},{id:"655f6f30-0bb5-4a86-b941-3aa934f30d52",trigger_type:"OnEntry",config:{audience_tag_id:"o28y4"},segment_code:15182,workspaceLevelConfig:{}},{id:"0dc6285e-454f-4d8c-9fa0-4fa7f480f4c8",trigger_type:"OnEntry",config:{audience_tag_id:"o29pf"},segment_code:15182,workspaceLevelConfig:{}},{id:"aaffeee9-92cb-4f4c-86b4-2cc6d98718cc",trigger_type:"OnEntry",config:{audience_tag_id:"o28xw"},segment_code:14749,workspaceLevelConfig:{}},{id:"00c76582-c308-450c-b53b-7398fcd2802c",trigger_type:"OnEntry",config:{audience_tag_id:"o29pe"},segment_code:15180,workspaceLevelConfig:{}},{id:"d62db0f5-bda8-46fa-97e0-3b4d9ada22f3",trigger_type:"OnEntry",config:{audience_tag_id:"o28xx"},segment_code:14750,workspaceLevelConfig:{}},{id:"643dfcff-1318-482c-83ea-cf5d7dc4353d",trigger_type:"OnEntry",config:{audience_tag_id:"o29pd"},segment_code:14749,workspaceLevelConfig:{}},{id:"3bf4113c-046c-405b-a2f0-c2a03dce6956",trigger_type:"OnEntry",config:{audience_tag_id:"o28xs"},segment_code:12928,workspaceLevelConfig:{}},{id:"c90c7c37-a269-4c09-aeb4-3140f5389a2e",trigger_type:"OnEntry",config:{audience_tag_id:"o29pc"},segment_code:14750,workspaceLevelConfig:{}},{id:"382fdff5-10ce-4b9a-951e-d7b8be01c7a7",trigger_type:"OnEntry",config:{audience_tag_id:"o3y2h"},segment_code:14751,workspaceLevelConfig:{}},{id:"2cceeb35-1e7e-4255-9511-1caf1a37c799",trigger_type:"OnEntry",config:{audience_tag_id:"o3xr1"},segment_code:14751,workspaceLevelConfig:{}}]},web:{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}},this.optimisedActivationsConfig={dfp:{dfp:[14790,14793,32616,14722,14760,15196,14723,14726,14736,15095,14728,15093,15182,15113,15114,14737,15189,14738,14751,15038,15180,15195,15112,15e3,13286,12999,36063,12928,14746,14747,14749,14750,14759,19963,20426,21278,16932,25856,28084,28083,28081,28079,28071,31968,28061,28060,28055,28059,28054,28053,28052,28035,28058,28057,28056,28030,28026,28025,28023,28021,28018,28017,28078,31970,28077,31969,28073,28076,21011,21008,18119,17100,17099,16957,30007,30008,30009,30011,30013,30015,30017,30019,30021,30031,30032,32990,32993,32994,32999,33e3,14253,33735,38976,48930,47552,52427],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:47},appnexus:{},appnexus_adserver:[],nativo:[]}}getSpecializedActivations(e){return this.optimisedActivationsConfig[e]}getActivations(e){return(this.addons[e]?this.addons[e].activationConfigs:[]).filter(e=>this.areContextCriteriaSatisfied(e)).map(e=>new r(this.permutive,this._internals,e.id,e.segment_code,e.trigger_type,e.config,e.workspaceLevelConfig))}areContextCriteriaSatisfied(e){const t=e.context_criteria,n=e=>{const t=this.context[e.key];switch(e.comparison){case"EQUALS":return t===e.value;case"NOT_EQUALS":return t!==e.value;case"CONTAINS":return"string"==typeof t&&t.indexOf(e.value)>=0;case"NOT_CONTAINS":return"string"==typeof t&&t.indexOf(e.value)<0}};return!t||("AND"===(r=t).operator?r.criteria.every(n):r.criteria.some(n));var r}}var a=n(12),s=n(3),o=n(0),c=n(9),u=n(6);class d{constructor(e){this._internals=e}put(e,t){return Object(u.a)(this._internals.getNamespacedStorageKey(String(t)),t=>window.localStorage.setItem(t,JSON.stringify(e)),e=>Promise.resolve(t))}get(e){return Object(u.a)(this._internals.getNamespacedStorageKey(String(e)),e=>JSON.parse(window.localStorage.getItem(e)),e=>Promise.resolve(e))}delete(e){return Object(u.a)(this._internals.getNamespacedStorageKey(String(e)),e=>Promise.resolve(window.localStorage.removeItem(e)))}deleteStore(){return Promise.resolve()}migrateIfRequired(){return Promise.resolve()}}let l,f;const _=new WeakMap,p=new WeakMap,g=new WeakMap,h=new WeakMap,m=new WeakMap;let b={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return p.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return w(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(O(this),t),w(_.get(this))}:function(...t){return w(e.apply(O(this),t))}:function(t,...n){const r=e.call(O(this),t,...n);return g.set(r,t.sort?t.sort():[t]),w(r)}}function y(e){return"function"==typeof e?v(e):(e instanceof IDBTransaction&&function(e){if(p.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)});p.set(e,t)}(e),t=e,(l||(l=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,b):e);var t}function w(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",a)},i=()=>{t(w(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&_.set(t,e)}).catch(()=>{}),m.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=y(e);return t!==e&&(h.set(e,t),m.set(t,e)),t}const O=e=>m.get(e);function k(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(e,t),o=w(s);return r&&s.addEventListener("upgradeneeded",e=>{r(w(s.result),e.oldVersion,e.newVersion,w(s.transaction))}),n&&s.addEventListener("blocked",()=>n()),o.then(e=>{a&&e.addEventListener("close",()=>a()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}const j=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],q=new Map;function P(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(q.get(t))return q.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const a=async function(e,...t){const a=this.transaction(e,i?"readwrite":"readonly");let s=a.store;r&&(s=s.index(t.shift()));const o=await s[n](...t);return i&&await a.done,o};return q.set(t,a),a}b=(e=>({...e,get:(t,n,r)=>P(t,n)||e.get(t,n,r),has:(t,n)=>!!P(t,n)||e.has(t,n)}))(b);var S=n(7),M=n(4);class T{constructor(e,t,n,r,i,a){this._internals=e,this.cryptoAlg=t,this.idb=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=a,this.MAX_CONSECUTIVE_PUTS=30,this.puts=1,this.cryptoKey=this.getOrGenerateKey()}static initialise(e,t,n,r,i,a,o){const u=["development"===e.config.environment?window.isSecureContext:"https:"===window.location.protocol,!(Object(M.g)(navigator.userAgent)&&["f036e56c-2514-4246-bf83-1659326fe3f8"].indexOf("2a28082a-de31-45fd-a00c-548117e422f7")>-1)].every(e=>!0===e)?Object(s.t)(()=>k(n,o,{upgrade:e=>{e.createObjectStore(r),e.createObjectStore(i)}}),e=>String(e)):Object(s.o)("Connection not attempted. Default to localStorage");return Object(s.f)(e=>Object(c.e)(e),n=>Object(c.h)(()=>n.then(n=>new T(e,t,n,r,i,a)),e=>String(e)))(u)}put(e,t){return this.cryptoKey.then(n=>Object(u.a)(JSON.stringify(e),e=>new Promise((r,i)=>{this.cryptoAlg.encrypt(n,e).then(e=>Object(u.a)(this._internals.getNamespacedStorageKey(String(t)),n=>this.resetIfRequired(this.puts++).then(i=>this.idb.put(this.mainObjectStore,e,n).then(e=>r(t)))),e=>i(e))})))}get(e){return this.cryptoKey.then(t=>Object(u.a)(this._internals.getNamespacedStorageKey(String(e)),e=>this.idb.get(this.mainObjectStore,e).then(e=>e?this.cryptoAlg.decrypt(t,e):null).then(JSON.parse)))}delete(e){return Object(u.a)(this._internals.getNamespacedStorageKey(String(e)),e=>this.idb.delete(this.mainObjectStore,e))}migrateIfRequired(){const e=Object(u.a)(this._internals.getExternalData(D),e=>e?Object(c.g)(JSON.parse(e)):Object(c.e)(null)),t=Object(c.h)(()=>this.idb.get("events","permutive-events-cache"),e=>{});return Promise.all([e(),t()]).then(e=>e.filter(s.n).map(e=>e.right).filter(e=>e)).then(S.h).then(e=>Object(u.a)(e,e=>e.forEach(e=>this._internals.state.eventsCache.add(Object(a.a)(e),{persistOnDisk:!1})),e=>this._internals.removeExternalData(D))).then(e=>-1!==[...this.idb.objectStoreNames].indexOf("events")?this.idb.delete("events","permutive-events-cache"):Promise.resolve())}deleteStore(){return Promise.resolve(this.idb.close()).then(e=>function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),w(n).then(()=>{})}(this.idb.name))}getOrGenerateKey(){return Object(u.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),e=>this.idb.get(this.keyObjectStore,e).then(e=>e||this.storeGivenOrGeneratedKey()))}storeGivenOrGeneratedKey(e){return(e||this.cryptoAlg.generateKey(!1)).then(e=>Object(u.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),t=>this.idb.put(this.keyObjectStore,e,t),t=>e),e=>Promise.reject(e))}resetIfRequired(e){const t=this.idb.name,n=this.idb.version;return Object(M.g)(navigator.userAgent)&&e%this.MAX_CONSECUTIVE_PUTS==0?this.deleteStore().then(e=>k(t,n,{upgrade:e=>{e.createObjectStore(this.mainObjectStore),e.createObjectStore(this.keyObjectStore)}})).then(e=>{this.idb=e,this.storeGivenOrGeneratedKey(this.cryptoKey)}):Promise.resolve()}}class I{constructor(e,t,n,r,i,a,o){this._internals=e,this.cryptoAlg=t,this.dbName=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=a,this.version=o,this.db=T.initialise(this._internals,this.cryptoAlg,this.dbName,this.mainObjectStore,this.keyObjectStore,this.keyObjectKey,this.version)().then(Object(s.j)(e=>new d(this._internals)))}put(e,t){return Object(c.h)(()=>this.db.then(n=>n.put(e,t)),e=>String(e))}get(e){return Object(c.h)(()=>this.db.then(t=>t.get(e)).then(o.c),e=>String(e))}delete(e){return Object(c.h)(()=>this.db.then(t=>t.delete(e)),e=>String(e))}deleteStore(){return Object(c.h)(()=>this.db.then(e=>e.deleteStore()),e=>String(e))}migrateIfRequired(){return Object(c.h)(()=>this.db.then(e=>e.migrateIfRequired()),e=>String(e))}}class x{constructor(){this.crypto=window.crypto||window.msCrypto,this.ALG_NAME="AES-GCM"}generateKey(e=!1){return this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},e,["encrypt","decrypt"])}encrypt(e,t){const[n,r]=this._encrypt(e,this.str2bytes(t));return n.then(e=>{const t=new Uint8Array(16+e.byteLength);return t.set(r,0),t.set(new Uint8Array(Uint32Array.of(e.byteLength).buffer),12),t.set(new Uint8Array(e),16),t.buffer})}decrypt(e,t){const n=new Uint8Array(t,0,12),r=new Uint32Array(t,12,1)[0],i=t.slice(16,16+r);return this._decrypt(e,n,i).then(this.bytes2str)}_encrypt(e,t){const n=this.crypto.getRandomValues(new Uint8Array(12));return[this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:n},e,t),n]}_decrypt(e,t,n){return this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:t},e,n)}str2bytes(e){return(new TextEncoder).encode(e).buffer}bytes2str(e){return(new TextDecoder).decode(e)}}var C=n(5);const D="permutive-events-cache";class A{constructor(e,t){this.state=e,this._internals=t,this.EVENTS_CACHE_OBJECT_STORE="events",this.CRYPTO_KEY_OBJECT_STORE="keys",this.CRYPTO_KEY_OBJECT_KEY="events",this.eventPutQueue=Promise.resolve(),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore=new I(this._internals,new x,"2a28082a-de31-45fd-a00c-548117e422f7",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY,2)}all(){return this.eventsCache}add(e,t){const{persistOnDisk:n}=t;return Object(u.a)(this.eventsCache.push(e),e=>n?this.flush():Object(C.c)(),t=>e)}loadFromDisk(){const e=[];return this.eventStore.migrateIfRequired()().then(Object(s.f)(t=>(this._internals.network.error("Failed to migrate events cache. Got "+JSON.stringify(t)),this.reset().then(t=>e)),()=>{const t=this._internals.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{});return this.eventStore.get(D)().then(n=>{this._internals.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",t);const r=Object(o.a)(()=>Promise.resolve(e),e=>Object(u.a)(this.eventCacheSizeInBytes=2*JSON.stringify(e).length,t=>{this._internals.metrics.track({name:"sdk_events_cache_byte_total",value:this.eventCacheSizeInBytes,labels:{}}),this._internals.metrics.track({name:"sdk_events_cache_size_total",value:e.length,labels:{}})},t=>e.map(e=>this.deserializeAndAdd(e,{persistOnDisk:!1})),e=>Promise.resolve(e)));return Object(s.f)(t=>(this._internals.network.error("Error fetching data from store. Got "+t),this.reset().then(t=>e)),r)(n)})}))}processUnseenEvents(e){this._internals.log("Got out-of-SDK events from the API",e);const t=Object(u.a)(e,e=>e.map(e=>this.deserializeAndAdd(e,{persistOnDisk:!1}))),n=t.length>0?this.flush.bind(this):C.c;return Object(u.a)(n(),e=>t)}reset(){return this._internals.log("Resetting Events Cache"),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore.deleteStore()().then(()=>(this.eventStore=new I(this._internals,new x,"2a28082a-de31-45fd-a00c-548117e422f7",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY,2),this.flush()))}flush(){let e=JSON.stringify(this.eventsCache),t=1;for(;e.length>this._internals.config.eventsCacheLimitBytes/2;)this.eventsCache.splice(0,t),t*=2,e=JSON.stringify(this.eventsCache);this._internals.log("Writing cache (#e)",this.eventsCache.length),this.eventCacheSizeInBytes=2*e.length,this.eventPutQueue=this.eventPutQueue.then(e=>this.eventStore.put(this.eventsCache.map(a.e),D)().then(C.c))}deserializeAndAdd(e,t){const{persistOnDisk:n}=t;return Object(u.a)(e,a.a,e=>this.add(e,{persistOnDisk:n}))}getStateSizeInBytes(){return this.eventCacheSizeInBytes}}class L{constructor(e){this._internals=e,this.queue=[],this.nextNotify=null,e.messages.on("permutive:taskQueue:update",()=>{this.execute()})}add(e){this.queue.push(e),this.notify()}notify(){const e=()=>{this._internals.messages.emit("permutive:taskQueue:update")},t=(new Date).getTime();null===this.nextNotify||this.nextNotify<t-50?(this.nextNotify=t,e()):this.nextNotify<=t&&(this.nextNotify=t+50,window.setTimeout(e,50))}execute(){if(0===this.queue.length)return;let e=!1,t=!1,n=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(i.complete)n+=1;else if(i.started)t=!0,e=e||i.blocks();else{if(i.waits()&&t)break;e||(t=!0,e=e||i.blocks(),i.execute(()=>{this.notify()}))}}this.queue.splice(0,n)}size(){return this.queue.length}}class R{constructor(e,t,n){this._internals=e,this.permutive=t,this.context=n,this.taskQueue=new L(this._internals);const r=this._internals.getNamespacedStorageKey(e.config.permutiveDataKey),a=localStorage.getItem(r);this.permutiveDataByteSize=null===a?0:2*a.length,this.permutiveData=null===a?{}:JSON.parse(a);const s=Object(o.c)(this._internals.getCookie(this._internals.config.cookieName)),c=Object(o.c)(this._internals.getExternalData(this._internals.config.cookieName)),u=Object(o.g)(()=>Object(o.g)(M.o)(c))(s);this.setUserId(u),this.viewId=Object(M.o)(),this.context.view_id=this.viewId,this.eventSourceId=this.getPermutiveData("event-source-id")||this.generateAndStoreEventSourceId(),this.eventsCache=new A(this,this._internals),this.activationManager=new i(this._internals,this.permutive,this.context)}setUserId(e){this._internals.setCookie(this._internals.config.cookieName,e,!0),this._internals.setExternalData(this._internals.config.cookieName,e),this.userId=e}getPermutiveData(e){return this.permutiveData[e]}setPermutiveData(e,t){this.permutiveData[e]=t;const n=this._internals.getNamespacedStorageKey(this._internals.config.permutiveDataKey),r=JSON.stringify(this.permutiveData);this.permutiveDataByteSize=2*r.length,this._internals.makeSafe(()=>{localStorage.setItem(n,r)})()}getClient(){let e="";return e=document.title?document.title:"",{type:"web",user_agent:navigator.userAgent||"",url:window.location.href||"",domain:window.location.hostname||"",title:e,referrer:document.referrer||""}}getStateSizeInBytes(){return this.permutiveDataByteSize+this.eventsCache.getStateSizeInBytes()}reset(){return this._internals.log("Resetting State"),Promise.resolve(Object(u.a)(this._internals.deleteCookie(this._internals.config.cookieName),e=>this._internals.removeExternalData(this._internals.config.cookieName),e=>this._internals.queryManager.reset(),e=>this.permutiveData={},e=>this.permutiveDataByteSize=0,e=>localStorage.removeItem(this._internals.config.permutiveDataKey)))}generateAndStoreEventSourceId(){const e=Object(M.o)();return this.setPermutiveData("event-source-id",e),e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(4);class i{constructor(e,t){this._internals=e,(t=t||{}).timeout_seconds=t.timeout_seconds||1800,t.session_data_key=t.session_data_key||"permutive-session",this.options=t,this.session_id=null,this.initialize()}getSessionId(){return this.session_id}newSession(e){return{session_id:Object(r.o)(),last_updated:e}}initialize(){const e=new Date,t=this._internals.getCookie(this.options.session_data_key);let n=this.decodeSessionData(t);if(null===n)n=this.newSession(e);else{const t=this.options.timeout_seconds;e>new Date(n.last_updated.getTime()+1e3*t)?n=this.newSession(e):n.last_updated=e}this.persistSessionData(n),this.session_id=n.session_id}decodeSessionData(e){let t=null;try{t=JSON.parse(e)}catch(e){return null}return null!==t&&"object"==typeof t&&t.hasOwnProperty("session_id")&&t.hasOwnProperty("last_updated")&&(t.last_updated=new Date(t.last_updated),!isNaN(t.last_updated.getTime()))?t:null}persistSessionData(e){e.last_updated=e.last_updated.toISOString(),this._internals.setCookie(this.options.session_data_key,JSON.stringify(e))}}const a={success:e=>{},error:(e,t)=>{}};class s{constructor(e){this._internals=e}graphql(e,t=a){return this._internals.network.req({url:`${this._internals.config.apiProtocol}://${this._internals.config.apiHost}/graphql`,method:"POST",success:t.success,error:t.error,data:{query:e},contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}identify(e,t=a){const n=this._internals.identities.aliasMapToPrioritizedList(this._internals.identities.aliases);return this._internals.network.req({url:this._internals.network.getEndpointUrl("/identify"),method:"POST",data:{user_id:this._internals.state.userId,aliases:n.concat(e.map(e=>Object.assign(Object.assign({},e),{priority:0})))},success:t.success,error:t.error,contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}metrics(e,t=a){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/internal/metrics"),method:"POST",data:e,contentType:"text/plain",dataType:"text",success:t.success,error:t.error},!1)}track(e,t,n){return this._internals.network.req({url:[""+this._internals.network.getEndpointUrl((Array.isArray(e)?"/batch":"")+"/events"),"?enrich="+!!t.includeResponseBody,"&sdkp="+!n].join(""),method:"POST",data:e,success:t.success,error:t.error,contentType:"text/plain"},n)}tpdUsage(e,t=a){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/tpd/usage"),method:"POST",data:e,success:t.success,error:t.error,contentType:"text/plain"},!1)}reset(){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/reset"),method:"POST",xhrFields:{withCredentials:!0},contentType:"text/plain"},!1)}segmentSync(e,t){return this._internals.network.ajax({url:`https://${this._internals.config.segmentSyncApiHost}/sync/${e}`,type:"POST",data:"value="+encodeURIComponent(t),contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:!0}})}models(e){const t="binary"===e?"bin":"json";return this._internals.network.ajax({url:`https://${this._internals.config.cdnBaseUrl}/models/2a28082a-de31-45fd-a00c-548117e422f7-models.${t}`,dataType:e})}state(e,t,n,r,i=!1){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl(""+(i?"/state/legacy":"/state"),"v1.0")}?fetch_unseen=${r}`,method:"POST",data:{group_id:this._internals.state.userId,event_source_id:this._internals.state.eventSourceId,state:JSON.stringify(e),last_seen_offset:t},contentType:"text/plain"},n)}migrateOutOfSDKEvents(e,t,n=a){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl("/out-of-sdk-events/delete")}?user_id=${e}`,method:"POST",data:t,success:n.success,error:n.error,contentType:"text/plain"},!1)}inferDemographicSegments(e,t=a){return this._internals.network.req({url:""+this._internals.network.getEndpointUrl("/demographic/infer"),method:"POST",contentType:"text/plain",data:e,success:t.success,error:t.error},!1)}}class o{constructor(){this.promises={}}addPromise(e,t,n,r){e in this.promises||(this.promises[e]={}),this.promises[e][t]=r,window.setTimeout(()=>{this.resolvePromise(e,t)},n)}createPromise(e,t,n){this.addPromise(e,t,n,Object(r.b)())}getPromise(e,t){return Object(r.h)(this.promises,e,t)}resolvePromise(e,t){const n=this.getPromise(e,t);return void 0!==n?(n.resolve(),n):void 0}getPromisesByCategory(e){const t=Object(r.h)(this.promises,e)||{};return Object.keys(t).map(e=>t[e])}}var c=n(16);class u{constructor(e){this._internals=e,this.queries={},this.promises={}}register(e){const t=Object(r.b)();return this.queries[e.resource]=e.query(),this.promises[e.resource]=t,t.promise}run(){if(0===Object.keys(this.queries).length)return Promise.resolve();const e=Object(r.b)();return this._internals.api.graphql(this.toQueryString(this.queries),{success:t=>{Object.keys(this.promises).forEach(e=>{const n=t.data[e];n?this.promises[e].resolve(n):this.promises[e].reject("Could not find a graphql response for resource "+e)}),e.resolve()},error:t=>{console.error(t),Object.keys(this.promises).forEach(e=>this.promises[e].reject()),e.reject()}}),e.promise}toQueryString(e){return`{ ${Object.keys(e).map(t=>e[t]).join(" ")} }`}}class d{constructor(){this.events=[],this.listeners=[]}newEvent(e,t){this.events.push([e,t]),this.listeners.forEach(n=>{this.handle(e,t,n)})}addListener(e){this.listeners.push(e);const t={replay:()=>(this.replay(e),t),remove:()=>(this.remove(e),t)};return t}handle(e,t,n){const r="string"==typeof n.name&&e.name===n.name,i=n.name.test&&n.name.test(e.name),a=r||i;if(a)try{n.callback(e,t)}catch(e){window.console&&window.console.error&&window.console.error("callback error: ",e)}a&&n.once&&this.remove(n)}replay(e){let t=-1!==this.listeners.indexOf(e);for(let n=0;n<this.events.length&&t;n++)this.handle(this.events[n][0],this.events[n][1],e),t=-1!==this.listeners.indexOf(e)}remove(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}}function l(e){var t={},n=[];(e=e||this).on=function(n,r,i){return(t[n]=t[n]||[]).push([r,i]),e},e.off=function(r,i){r||(t={});for(var a=t[r]||n,s=a.length=i?a.length:0;s--;)i==a[s][0]&&a.splice(s,1);return e},e.once=function(t,r){var i=n.slice.call(arguments,2),a=function(){r(i),e.off(t,a)};return e.on(t,a),e},e.emit=function(r){for(var i,a=t[r]||n,s=a.length>0?a.slice(0,a.length):a,o=0;i=s[o++];)i[0].apply(i[1],n.slice.call(arguments,1));return e}}var f=n(12);class _{constructor(e){this._internals=e,this.timeoutDuration=500,this.maxWaitTime=5e3,this.requests=[],setInterval(()=>{this.requests.length>0&&this.flush()},this.maxWaitTime),Object(r.m)(()=>{this.requests.length>0&&this.flush(!0)},navigator.userAgent)}add(e,t,n){this.resetTimeout(),this.requests.push([e,t,n])}flush(e=!1){const t=[...this.requests];e||this.trackMetrics(t),this._internals.stateSync.sync(e),this._internals.api.track(t.map(e=>e[0]),{},e).then(e=>this.isBatchResponse(e)?this.handleBatchResponse(e,t):null,e=>this._internals.network.error(e)).catch(e=>this._internals.network.error(e)),this.requests=[]}handleBatchResponse(e,t){e.map(e=>e.body).forEach((e,n)=>{const r=t.map(e=>e[0])[n],i=t[n][1],a=t[n][2];Object(f.c)(e)?this.handleTrackError(e,r,i.error):this.handleTrackResponse(e,r,i.success,a)})}handleTrackResponse(e,t,n,r){const i=Object(f.b)(e,t);n(i),"never"!==r&&(this._internals.state.eventsCache.add(i,{persistOnDisk:!0}),this._internals.eventHandler.newEvent(Object(f.e)(i),null))}handleTrackError(e,t,n){const r={name:t.name,session_id:t.session_id,view_id:t.view_id,properties:t.properties,id:null,time:(new Date).toISOString()};n(e.error.message),this._internals.eventHandler.newEvent(r,e),console.error(e)}setTimeout(e){return window.setTimeout(()=>this.flush(),e)}resetTimeout(){clearTimeout(this.timeout),this.timeout=this.setTimeout(this.timeoutDuration)}trackMetrics(e){this._internals.metrics.track({name:"sdk_events_batch_size_total",value:e.length,labels:{}}),this._internals.metrics.track({name:"sdk_events_batch_size_bytes",value:2*JSON.stringify(e.map(e=>e[0])).length,labels:{}})}isBatchResponse(e){return!!e}}class p{constructor(e,t,r=[],a={},f=new d,p=new o,g=new l,h=new c.a){this.config=e,this.network=t,this.blockers=r,this.addons=a,this.eventHandler=f,this.promises=p,this.messages=g,this.enrichers=h,this.isReady=!1,this.isRealtime=!1,this.listenForBlockers=!0,this.sessionManager=new i(this),this.eventsBatch=new _(this),this.api=new s(this),this.graphql=new u(this),Promise.resolve().then(n.bind(null,46)).then(e=>this.models=new e.PermutiveModels(this))}makeSafe(e){return(...t)=>{try{return e(...t)}catch(e){this.network.error(e,this.state.userId)}}}utcNow(){const e=new Date;return new Date(e.toUTCString())}log(...e){this.config.loggingEnabled&&window.console&&window.console.log&&(e.splice(0,0,"[Permutive]"),console.log(...e))}setAsReady(){this.isReady=!0,this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{sdk_version:"v13.0.0-RC.16"}),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}})),this.messages.emit("permutive:ready")}setAsRealtime(){this.isRealtime=!0,this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{})}addBlocker(e){this.blockers.push(e),this.log("<blockers> added blocker "+e),this.messages.on(e,()=>{if(this.listenForBlockers){const t=this.blockers.indexOf(e);t>=0&&(this.blockers.splice(t,1),this.log("<blockers> removed blocker "+e)),0===this.blockers.length&&(this.listenForBlockers=!1,this.messages.emit("permutive:blockers:empty"),this.log("<blockers> complete"))}})}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}setCookie(e,t,n=!1){if(!(t&&e&&this.config.cookieExpiry&&this.config.cookieDomain))return!1;const r=this.getNamespacedStorageKey(e);document.cookie=[encodeURIComponent(r),"=",encodeURIComponent(t),"; expires=",this.config.cookieExpiry,"; domain=",this.config.cookieDomain,"; path=/",n?"; samesite=none; secure":""].join("")}getCookie(e,t=!1){const n=t?e:this.getNamespacedStorageKey(e),r=new RegExp(encodeURIComponent(n)+"=([^;]+)").exec(document.cookie);return null!==r?decodeURIComponent(r[1]):null}deleteCookie(e){if(!e||!this.config.cookieDomain)return!1;const t=this.getNamespacedStorageKey(e);return document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+this.config.cookieDomain+"; path=/",!0}getExternalData(e){const t=this.getNamespacedStorageKey(e);return localStorage.getItem(t)}setExternalData(e,t){const n=this.getNamespacedStorageKey(e);this.makeSafe(()=>{localStorage.setItem(n,t)})()}removeExternalData(e){const t=this.getNamespacedStorageKey(e);localStorage.removeItem(t)}arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(4),i=n(15);class a{constructor(e,t={}){this.wait_prev=t.wait_prev||!1,this.block_next=t.block_next||!1,this.description=t.description||"",this.started=!1,this.complete=!1,this.task=e}waits(){return this.wait_prev}blocks(){return this.block_next}execute(e){this.started=!0,this.task(()=>{this.complete=!0,e()})}}var s=n(12),o=n(6),c=n(0);const u=(e,t)=>new Promise(n=>{e(t,2,e=>{n(e)})}),d={tradedesk:21,ddp:755,appnexus:32,pubmatic:76,lotame:95};var l=n(5);class f{constructor(e,t,n){this._internals=e,this.network=t,this.context=n,this.initialisedAddons=[]}identify(e){this._internals.log("<call> identify",e);const t=this._internals.identities.getAliasesFromIdentifyArg(e),n=Object(r.b)(),s=t.map(e=>e.id).concat(Object.entries(this._internals.identities.aliases).map(e=>e[1]));if("string"==typeof e&&Object(i.b)("2a28082a-de31-45fd-a00c-548117e422f7",s,window.location.hostname,this._internals.state.userId))return n.resolve(),n.promise;return this._internals.state.taskQueue.add(new a(e=>{this._internals.log("<task> identify ",t);const r=this._internals.state.userId;this._internals.api.identify(t).then(i=>i.user_id===r?Object(o.a)(this._internals.log("<done> identify ",t),t=>e(),e=>n.resolve()):this._internals.state.reset().then(e=>Object(o.a)(this._internals.state.setUserId(i.user_id),e=>this._internals.state.eventsCache.reset(),e=>this._internals.stateSync.resetSync())).then(r=>{this._internals.log("<done> identify",t),e(),n.resolve()})).then(e=>t.forEach(e=>this._internals.identities.setAlias(e.id,e.tag)))},{wait_prev:!0,block_next:!0})),n.promise}on(e,t){return this._internals.eventHandler.addListener({name:e,callback:t,once:!1})}once(e,t){return this._internals.eventHandler.addListener({name:e,callback:t,once:!0})}track(...e){const[t,n,i]=[e[0],e[1]||{},e[2]||{}];this._internals.log("<call> track",t);const o=Object(r.b)();if(!this._internals.api)return this.network.error("The API hasn't been loaded."),o.reject(),o.promise;const c=!!i.isAnalyticsOnly,u=this._internals.sessionManager.getSessionId(),d=this._internals.state.viewId,l={success:i.success||(e=>{}),error:i.error||((e,t)=>{})};return this._internals.state.taskQueue.add(new a(e=>{this._internals.log("<task> track",t);const a=c?null:this._internals.metrics.startTimer("sdk_events_api_roundtrip_seconds",{}),f=c?null:this._internals.metrics.startTimer("sdk_events_overall_processing_seconds",{}),[_,p]=this._internals.enrichers.enrich([n,!0]);this._internals.metrics.track({name:p?"sdk_event_enrichment_success_count":"sdk_event_enrichment_fail_count",value:1,labels:{}});const g=Object.assign(Object.assign({},_),{client:this._internals.state.getClient()}),h=function(e,t){return e.isMemoryOnly?"memoryOnly":e.useBeacon?"deferred":e.isAnalyticsOnly?"never":t?"immediate":"onResponse"}(i,p),m={user_id:this._internals.state.userId,name:t,segments:this._internals.queryManager.userSegments,properties:g,session_id:u,view_id:d},b={name:t,properties:g,session_id:u,view_id:d,time:new Date},v=e=>{const t=this._internals.metrics.startTimer("sdk_events_querylanguage_seconds",{});return this._internals.queryManager.process([e]).then(()=>{this._internals.metrics.stopTimer("sdk_events_querylanguage_seconds",t),this._internals.metrics.stopTimer("sdk_events_overall_processing_seconds",f)})},y=e=>(this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",a),Object(s.c)(e)?w(e):O(e)),w=e=>{this._internals.log("Tracking failed with reason",e);const t={name:m.name,session_id:m.session_id,view_id:m.view_id,properties:m.properties,id:null,time:new Date};return Promise.resolve({event:t,error:e})},O=e=>{const t=Object(s.d)(e)?Object(s.a)(Object.assign(Object.assign({},e),{session_id:m.session_id,view_id:m.view_id})):Object(s.b)(e,m);return Promise.resolve({event:t,error:null})},k=e=>Promise.resolve(e.error?l.error(e.error.error.message):l.success(e.event)),j=e=>(e.error||this._internals.state.eventsCache.add(e.event,{persistOnDisk:!0}),Promise.resolve(e)),E=e=>(this._internals.eventHandler.newEvent(Object(s.e)(e.event),e.error),Promise.resolve(e.event));let q;switch(h){case"immediate":q=Object(r.e)(([e,t])=>Promise.all([v(e),this._internals.eventsBatch.add(t,l,h),Promise.resolve(e)]),([e,t,n])=>Promise.resolve(n));break;case"memoryOnly":q=([e,t])=>v(e).then(t=>e);break;case"onResponse":q=Object(r.e)(([e,t])=>this._internals.api.track(t,{includeResponseBody:!0},!1),e=>y(e),e=>Promise.all([k(e),j(e),v(e.event),E(e)]),([e,t,n,r])=>Promise.resolve(r));break;case"deferred":q=Object(r.e)(([e,t])=>Promise.all([this._internals.api.track(t,{includeResponseBody:!p},!0),Promise.resolve(e)]),([e,t])=>E({event:t,error:null}));break;case"never":q=([e,t])=>(this._internals.eventsBatch.add(t,l,h),Promise.resolve(e))}q([b,m]).then(t=>(o.resolve(t),this._internals.log("<done> track",t.name),e(),Promise.resolve(t))).catch(e=>{this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",a),l.error(e),this.network.error(e,this._internals.state.userId)})})),o.promise}trigger(e,t,n){const i=Object(r.b)();this._internals.log("<call> trigger",e),this._internals.triggerListeners=this._internals.triggerListeners||[];return this._internals.state.taskQueue.add(new a(t=>{this._internals.log("<task> trigger",e);const r=this._internals.messages.on("permutive:query:changed",(function(t){t.queryCode===e&&(n(t.result),i.resolve(t.result))}));this._internals.triggerListeners.push(r),this._internals.log("<done> trigger",e),t()})),i.promise}query(){return Promise.resolve({result:!1})}segment(e,t){const n=Object(r.b)();this._internals.log("<call> segment",e);return this._internals.state.taskQueue.add(new a(r=>{this._internals.log("<task> segment",e);const i=this._internals.queryManager.stateMap.value[e];i&&(t(i.result.result),n.resolve()),this._internals.log("<done> segment",e),r()})),n.promise}segments(e,t="all"){const n=Object(r.b)();this._internals.log("<call> segments");return this._internals.state.taskQueue.add(new a(r=>{this._internals.log("<task> segments ("+t+")");const i=i=>{e(i),n.resolve(i),this._internals.log("<done> segments ("+t+")"),r()};"dfp"===t?this._internals.messages.once("permutive:dfp:ready",()=>{i(this._internals.addons.dfp.liveSegments)}):i(this._internals.queryManager.userSegments)})),n.promise}reset(){return Promise.all([this._internals.api.reset(),this._internals.state.reset(),this._internals.stateSync.reset(),this._internals.queryManager.bootstrap([])]).then(([e])=>{this._internals.state.setUserId(e.id),this._internals.state.eventsCache.reset(),this._internals.messages.emit("permutive:reset")})}addon(e,t){if(-1===this.initialisedAddons.indexOf(e)){this.initialisedAddons.push(e);const r=Object.assign(Object.assign({},t),{_internals:this._internals,permutive:this,network:this.network,context:this.context});switch(e){case"web":Promise.resolve().then(n.bind(null,42)).then(e=>this._internals.addons.web=new e.WebAddon(r));break;case"publishers":0;break;case"overlays":Promise.resolve().then(n.bind(null,38)).then(e=>this._internals.addons.overlays=new e.OverlaysAddon(r));break;case"scriptrunner":Promise.resolve().then(n.bind(null,40)).then(e=>this._internals.addons.scriptrunner=new e.ScriptRunnerAddon(r));break;case"dfp":Promise.resolve().then(n.bind(null,36)).then(e=>this._internals.addons.dfp=new e.DFPAddon(r));break;case"smart":case"nativo":case"freewheel":case"facebook_pixel":0;break;case"facebook_pixel_v2":Promise.resolve().then(n.bind(null,37)).then(e=>this._internals.addons.facebook_pixel_v2=new e.FacebookPixelV2Addon(r));break;case"eyeota_pixel":case"rubicon":case"rubicon_ssp":case"aol":case"tracking_pixel":0;break;case"twitter_pixel":Promise.resolve().then(n.bind(null,41)).then(e=>this._internals.addons.twitter_pixel=new e.TwitterAddon(r));break;case"pinterest_pixel":case"local_storage":case"appnexus_adserver":case"prebid":case"tradedesk":0;break;case"ddp":case"dbm":Promise.resolve().then(n.bind(null,35)).then(e=>this.addonIfTCFConsent({Addon:e.DDPAddon,key:"ddp"},r));break;case"appnexus":case"pubmatic":case"lotame":0}}else"web"===e&&!0!==t.auto_init&&this._internals.addons.web.reset(t)}addonIfTCFConsent(e,t){const n=()=>{switch(e.key){case"tradedesk":this._internals.addons.tradedesk=new e.Addon(t);break;case"ddp":this._internals.addons.ddp=new e.Addon(t);break;case"appnexus":this._internals.addons.appnexus=new e.Addon(t);break;case"pubmatic":this._internals.addons.pubmatic=new e.Addon(t);break;case"lotame":this._internals.addons.lotame=new e.Addon(t)}},i=t=>t[d[e.key]]?n():Object(l.c)();return(e=>{const t=e.__tcfapi,n={type:"aborted"},i=["tcloaded","useractioncomplete"];return t?Object(r.a)(()=>u(t,"getTCData"),()=>u(t,"getTCData").then(e=>"loaded"===(null==e?void 0:e.cmpStatus)&&i.includes(null==e?void 0:e.eventStatus))).then(Object(c.a)(()=>n,e=>({type:"loaded",data:e}))):Promise.resolve({type:"missing"})})(window).then(e=>{switch(e.type){case"missing":return n();case"aborted":return Object(l.c)();case"loaded":return Object(o.a)((t=e.data).gdprApplies?Object(c.n)(t.vendor.consents):c.m,Object(c.a)(n,i))}var t})}ready(e,t="initialised"){const n=Object(r.b)(),i=()=>{e(),n.resolve()};switch(t){case"initialised":this._internals.isReady?i():this._internals.messages.on("permutive:ready",i);break;case"realtime":this._internals.isRealtime?i():this._internals.messages.once("permutive:ready",i)}return n.promise}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(4),i=n(24),a=n.n(i),s=function(){return a()('/*! permutive-javascript-sdk v13.0.0-RC.16 (web) (built 2020-10-14 17:12:06 GMT+0000) */!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";e.exports=function(e){function t(e,t,n,r){function i(t){"function"!=typeof self.postMessage?e.ports[0].postMessage(t):self.postMessage(t)}n?("undefined"!=typeof console&&"error"in console&&console.error("Worker caught an error:",n),i([t,{message:n.message}])):i([t,null,r])}self.addEventListener("message",(function(n){var r=n.data;if(Array.isArray(r)&&2===r.length){var i=r[0],a=r[1];"function"!=typeof e?t(n,i,new Error("Please pass a function into register().")):function(e,n,r,i){var a,o=function(e,t){try{return{res:e(t)}}catch(e){return{err:e}}}(n,i);o.err?t(e,r,o.err):!(a=o.res)||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then?t(e,r,null,o.res):o.res.then((function(n){t(e,r,null,n)}),(function(n){t(e,r,n)}))}(n,e,i,a)}}))}},function(e,t,n){"use strict";function r(e){return e}n.r(t),n.d(t,"effects",(function(){return on})),n.d(t,"bootstrap",(function(){return cn})),n.d(t,"updateEnvironment",(function(){return un})),n.d(t,"process",(function(){return sn})),n.d(t,"processOne",(function(){return ln})),n.d(t,"migrate",(function(){return pn})),n.d(t,"setSegmentActivationWithStateMap",(function(){return dn}));function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function a(e,t,n,r,i,a,o,c,u,s){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return a(i(r(n(t(e)))));case 7:return o(a(i(r(n(t(e))))));case 8:return c(o(a(i(r(n(t(e)))))));case 9:return u(c(o(a(i(r(n(t(e))))))));case 10:return s(u(c(o(a(i(r(n(t(e)))))))))}}var o=function(e){return"Left"===e._tag},c=function(e){return{_tag:"Left",left:e}},u=function(e){return{_tag:"Right",right:e}};function s(e,t){try{return u(e())}catch(e){return c(t(e))}}var l=function(e){return function(t){return o(t)?e(t.left):t.right}};var p=function(e,t){return o(e)?e:u(t(e.right))},d=function(e,t){return o(e)?e:o(t)?t:u(e.right(t.right))},f=function(e,t){return o(e)?e:t(e.right)},g=function(e,t,n){return o(e)?t:n(t,e.right)},m=function(e){return function(t,n){return o(t)?e.empty:n(t.right)}},y=function(e,t,n){return o(e)?t:n(e.right,t)},v=function(e){return function(t,n){return o(t)?e.of(c(t.left)):e.map(n(t.right),u)}},w=function(e,t,n){return o(e)?c(t(e.left)):u(n(e.right))},q=function(e,t){return o(e)?c(t(e.left)):e},h=function(e,t){return o(e)?t():e},b=function(e,t){return o(e)?e:u(t(e))},_=function(e,t){return function(e,t){for(var n=t(e);"Left"===n._tag;)n=t(n.left);return n.right}(t(e),(function(e){return o(e)?u(c(e.left)):o(e.right)?c(t(e.right.left)):u(u(e.right.right))}))},k=function(e){return function(t){return p(t,e)}},x=u,P=function(e){return function(t){return o(t)?e.of(c(t.left)):e.map(t.right,u)}},j=c,O="Either";var A={URI:O,map:p,of:x,ap:d,chain:f,reduce:g,foldMap:m,reduceRight:y,traverse:v,sequence:P,bimap:w,mapLeft:q,alt:h,extend:b,chainRec:_,throwError:j};var z,S=(z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),T=function(){function e(e,t,n,r){this.name=e,this.is=t,this.validate=n,this.encode=r,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,n){var r=this;return void 0===n&&(n="pipe("+this.name+", "+t.name+")"),new e(n,t.is,(function(e,n){var i=r.validate(e,n);return o(i)?i:t.validate(i.right,n)}),this.encode===M&&t.encode===M?M:function(e){return r.encode(t.encode(e))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(e){return this.validate(e,[{key:"",type:this,actual:e}])},e}(),M=function(e){return e},N=c,I=function(e,t,n){return N([{value:e,context:t,message:n}])},C=u,L=(new(function(e){function t(){var t=e.call(this,"null",(function(e){return null===e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="NullType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"undefined",(function(e){return void 0===e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="UndefinedType",t}return S(t,e),t}(T))),E=(new(function(e){function t(){var t=e.call(this,"void",L.is,L.validate,M)||this;return t._tag="VoidType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"unknown",(function(e){return!0}),C,M)||this;return t._tag="UnknownType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"string",(function(e){return"string"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="StringType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"number",(function(e){return"number"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="NumberType",t}return S(t,e),t}(T))),G=(new(function(e){function t(){var t=e.call(this,"bigint",(function(e){return"bigint"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="BigIntType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"boolean",(function(e){return"boolean"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="BooleanType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"UnknownArray",Array.isArray,(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="AnyArrayType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"UnknownRecord",(function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Window]"===t}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="AnyDictionaryType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"Function",(function(e){return"function"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="FunctionType",t}return S(t,e),t}(T)),function(e){function t(t,n,r,i,a,o){var c=e.call(this,t,n,r,i)||this;return c.type=a,c.predicate=o,c._tag="RefinementType",c}return S(t,e),t}(T)),R=(D(E,(function(e){return Number.isInteger(e)}),"Int"),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.value=a,o._tag="LiteralType",o}S(t,e)}(T),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.keys=a,o._tag="KeyofType",o}S(t,e)}(T),Object.prototype.hasOwnProperty,function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.runDefinition=a,o._tag="RecursiveType",o}return S(t,e),t}(T));Object.defineProperty(R.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.type=a,o._tag="ArrayType",o}S(t,e)})(T),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.props=a,o._tag="InterfaceType",o}S(t,e)}(T),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.props=a,o._tag="PartialType",o}S(t,e)}(T),function(e){function t(t,n,r,i,a,o){var c=e.call(this,t,n,r,i)||this;return c.domain=a,c.codomain=o,c._tag="DictionaryType",c}S(t,e)}(T);var V=function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.types=a,o._tag="UnionType",o}return S(t,e),t}(T);!function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.types=a,o._tag="IntersectionType",o}S(t,e)}(T);!function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.types=a,o._tag="TupleType",o}S(t,e)}(T);(function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.type=a,o._tag="ReadonlyType",o}S(t,e)})(T),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.type=a,o._tag="ReadonlyArrayType",o}S(t,e)}(T),function(e){function t(t,n,r,i,a,o){var c=e.call(this,t,n,r,i,a)||this;return c.tag=o,c}S(t,e)}(V),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.type=a,o._tag="ExactType",o}S(t,e)}(T),new(function(e){function t(){var t=e.call(this,"never",(function(e){return!1}),(function(e,t){return I(e,t)}),(function(){throw new Error("cannot encode never")}))||this;return t._tag="NeverType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"any",(function(e){return!0}),C,M)||this;return t._tag="AnyType",t}return S(t,e),t}(T)),new(function(e){function t(){var t=e.call(this,"object",(function(e){return null!==e&&"object"==typeof e}),(function(e,n){return t.is(e)?C(e):I(e,n)}),M)||this;return t._tag="ObjectType",t}return S(t,e),t}(T));function D(e,t,n){var r;return void 0===n&&(n="("+e.name+" | "+(((r=t).displayName||r.name||"<function"+r.length+">")+")")),new G(n,(function(n){return e.is(n)&&t(n)}),(function(n,r){var i=e.validate(n,r);if(o(i))return i;var a=i.right;return t(a)?C(a):I(a,r)}),e.encode,e,t)}D(E,Number.isInteger,"Integer"),function(e){function t(t,n,r,i,a){var o=e.call(this,t,n,r,i)||this;return o.props=a,o._tag="StrictType",o}S(t,e)}(T);const F=()=>({kind:"null",value:null}),U=e=>({kind:"string",value:e}),$=e=>({kind:"number",value:e}),J=e=>({kind:"array",value:e}),Y=e=>({kind:"object",value:e}),B=e=>e,W=()=>({kind:"bottom"}),H=e=>({kind:"inner",a:e}),K=e=>({kind:"top",error:e}),Q=e=>({kind:"unbounded",group:e}),X=(e,t)=>({kind:"windowed",key:t,group:e}),Z=(e,t,n)=>({kind:"countLimit",n:n,limit:t,group:e}),ee=(e,t,n)=>({kind:"uniqueLimit",n:n,limit:t,group:e}),te=e=>({kind:"numberGroup",group:e}),ne=e=>({kind:"stringGroup",group:e}),re=e=>({kind:"tuple",tuple:e}),ie=e=>({state:e}),ae=(e,t)=>({commands:e,payload:t});var oe=function(e){return"Some"===e._tag},ce=function(e){return"None"===e._tag},ue={_tag:"None"},se=function(e){return{_tag:"Some",value:e}};function le(e){return function(t){return e(t)?se(t):ue}}var pe=function(e){return function(t){return ce(t)?e():t.value}};var de=function(e,t){return ce(e)?ue:se(t(e.value))},fe=function(e){return function(t){return de(t,e)}};function ge(e){return{equals:function(t,n){return t===n||(ce(t)?ce(n):!ce(n)&&e.equals(t.value,n.value))}}}function me(e){return{equals:ge(e).equals,compare:function(t,n){return t===n?0:oe(t)?oe(n)?e.compare(t.value,n.value):1:-1}}}function ye(e,t){return e<t?-1:e>t?1:0}function ve(e,t){return e===t}var we={equals:ve,compare:ye},qe={equals:ve,compare:ye};function he(e){return function(t,n){return-1===e.compare(t,n)}}function be(e){return function(t,n){return 1===e.compare(t,n)}}function _e(e){return function(t,n){return-1===e.compare(t,n)?n:t}}function ke(e){var t=function(t,n){return t===n?0:e(t,n)};return{equals:function(e,n){return 0===t(e,n)},compare:t}}var xe=function(e,t){return ke((function(n,r){return e.compare(t(n),t(r))}))},Pe=function(e){return function(t){return xe(t,e)}};var je=function(e,t){var n=e.length;if(0===n)return t;var r=t.length;if(0===r)return e;for(var i=Array(n+r),a=0;a<n;a++)i[a]=e[a];for(a=0;a<r;a++)i[a+n]=t[a];return i};function Oe(e){return{equals:function(t,n){return t===n||t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}}}function Ae(e){return 0===e.length}function ze(e){return e.length>0}function Se(e,t){if(void 0===t)return function(t){return Se(e,t)};for(var n=t.length,r=Array(n+1),i=0;i<n;i++)r[i+1]=t[i];return r[0]=e,r}function Te(e,t){for(var n=e.length,r=Array(n+1),i=0;i<n;i++)r[i]=e[i];return r[n]=t,r}var Me=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function Ne(e){return Ae(e)?e:e.slice().reverse()}var Ie=function(e){return function(t){return Ae(t)?t:t.slice().sort(e.compare)}};function Ce(e,t,n){for(var r=[],i=Math.min(e.length,t.length),a=0;a<i;a++)r[a]=n(e[a],t[a]);return r}function Le(e){return function(t,n){if(void 0===n){var r=Le(e);return function(e){return r(t,e)}}for(var i,a=0,o=n.length;a<o;a++)if(i=n[a],e.equals(i,t))return!0;return!1}}var Ee=function(){return We},Ge=function(e,t){for(var n=0,r=e.length,i=new Array(r),a=0;a<r;a++){n+=(u=t(a,e[a])).length,i[a]=u}var o=Array(n),c=0;for(a=0;a<r;a++){for(var u,s=(u=i[a]).length,l=0;l<s;l++)o[l+c]=u[l];c+=s}return o},Re=function(e,t){return Ge(e,(function(e,n){return t(n)}))},Ve=function(e,t){return Fe(e,(function(e,n){return t(n)}))},De=function(e,t,n){for(var r=e.length,i=t,a=0;a<r;a++)i=n(a,i,e[a]);return i},Fe=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=t(r,e[r]);oe(i)&&n.push(i.value)}return n},Ue=function(e){var t=$e(e);return function(e,n){return t(e,(function(e,t){return n(t)}))}},$e=function(e){return function(t,n){return De(t,e.of(Ee()),(function(t,r,i){return e.ap(e.map(r,(function(e){return function(t){return Te(e,t)}})),n(t,i))}))}},Je=function(e){return function(t){return Re(t,e)}},Ye=function(e){return Ve(e,r)},Be=function(e){var t=Ue(e);return function(e){return function(n){return t(n,e)}}};var We=[],He=function(e){return ke((function(t,n){for(var r=t.length,i=n.length,a=Math.min(r,i),o=0;o<a;o++){var c=e.compare(t[o],n[o]);if(0!==c)return c}return qe.compare(r,i)}))},Ke=function(e){return function(t){return t.slice(0,e)}};function Qe(e){return function(e){return function(t){for(var n=Me(t,e),r=Array(n),i=0;i<n;i++)r[i]=t[i];var a=t.length,o=Array(a-n);for(i=n;i<a;i++)o[i-n]=t[i];return{init:r,rest:o}}}(e)}var Xe=function(e){return function(t){return t.slice(e,t.length)}},Ze=function(e){return function(t){for(var n=Me(t,e),r=t.length,i=Array(r-n),a=n;a<r;a++)i[a-n]=t[a];return i}};var et=Ne,tt=Ie,nt=Ce;var rt=function e(t){var n=Le(t);return function(r,i){if(void 0===i){var a=e(t);return function(e){return a(e,r)}}return je(r,i.filter((function(e){return!n(e,r)})))}},it=Je,at=Ye,ot=Be,ct=a;function ut(e){switch(e.kind){case"null":return lt.encode(e);case"string":return pt.encode(e);case"number":return dt.encode(e);case"array":return ft.encode(e);case"object":return gt.encode(e)}}function st(e){return null===e?lt.decode(e):"number"==typeof e?dt.decode(e):"string"==typeof e?pt.decode(e):Array.isArray(e)?ft.decode(e):gt.decode(e)}const lt=new T("simpleNullCodec",e=>{const t=e;return"null"===t.kind&&null===t.value},(e,t)=>null===e?C({kind:"null",value:null}):I(e,t),e=>e.value),pt=new T("simpleStringCodec",e=>{const t=e;return"string"===t.kind&&"string"==typeof t.value},(e,t)=>"string"==typeof e?C(U(e)):I(e,t),e=>e.value),dt=new T("simpleNumberCodec",e=>{const t=e;return"number"===t.kind&&"number"==typeof t.value},(e,t)=>"number"==typeof e?C($(e)):I(e,t),e=>e.value),ft=new T("simpleArrayCodec",e=>{const t=e;return"array"===t.kind&&Array.isArray(t.value)},(e,t)=>{if(Array.isArray(e)){const t=ot(A)(st)(e);return k(J)(t)}return I(e,t)},e=>e.value.map(ut)),gt=new T("simpleObjectCodec",e=>"object"===e.kind,(e,t)=>{if(e&&e.constructor===Object){const t=ot(A)(([e,t])=>ct(st(t),k(t=>i(e,t))))(Object.entries(e));return k(e=>Y(new Map([...e])))(t)}return I(e,t)},e=>{const t=[...e.value.entries()];return Object.assign({},...Array.from(t,([e,t])=>({[e]:ut(t)})))});new T("simpleJsonCodec",e=>lt.is(e)||dt.is(e)||pt.is(e)||ft.is(e)||gt.is(e),st,ut);var mt=n(0),yt=n.n(mt);const vt=(e,t)=>{switch(e.kind){case"bottom":return{kind:"bottom"};case"inner":return H(t(e.a));case"top":return K(e.error)}},wt=e=>ke((t,n)=>{if("bottom"===t.kind&&"bottom"===n.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===n.kind)return 1;if("top"===t.kind&&"top"===n.kind)return we.compare(t.error,n.error);if("top"===t.kind)return 1;if("top"===n.kind)return-1;if("inner"===t.kind&&"inner"===n.kind)return e.compare(t.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});function qt(e){return ze(e)?se(e):ue}var ht=Se,bt=function(e){return qt(function(e){var t=e.length;if(0===t)return We;for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}(e))},_t=Oe;function kt(e,t){return at(e.map(t))}function xt(e,t,n,r){const i=(e,t)=>{if(0===e.length)return at(t.map(e=>se({1:e[1],2:n(ue,se(e[2]))})));if(0===t.length)return at(e.map(e=>se({1:e[1],2:n(se(e[2]),ue)})));if(e.length>0&&t.length>0&&he(r)(e[0][1],t[0][1])){const[r,...a]=e,o=r[1],c=r[2];return ht({1:o,2:n(se(c),ue)},i(a,t))}if(e.length>0&&t.length>0&&be(r)(e[0][1],t[0][1])){const[r,...a]=t,o=r[1],c=r[2];return ht({1:o,2:n(ue,se(c))},i(e,a))}if(e.length>0&&t.length>0){const[r,...a]=e,[o,...c]=t,u=r[1],s=r[2],l=o[2];return ht({1:u,2:n(se(s),se(l))},i(a,c))}throw new Error("Non exhaustive match in mapOption2")},a=Pe(e=>e[1])(r),o=(e=>{const t=kt(e,e=>oe(e[2])?se({1:e[1],2:e[2].value}):ue);return 0===t.length?ue:se(t)})(i(tt(a)([...e].map(e=>({1:e[0],2:e[1]}))),tt(a)([...t].map(e=>({1:e[0],2:e[1]})))));return fe(e=>new Map(e.map(e=>[e[1],e[2]])))(o)}function Pt(e,t,n,r){const i=Pe(e=>e[0])(r),a=tt(i)([...t]).reduceRight((e,t)=>{if(o(e)){const r=n(t[1],e.left);return oe(r)?c(r.value):u(t[0])}return e},c(e));return"Left"===(s=a)._tag?ue:se(s.right);var s}function jt(e,t){return new Map([...e].map(t))}function Ot(e,t){return new Map([...e].filter(t))}function At(e){return{equals:function(t,n){return t===n||e(t,n)}}}var zt={equals:function(e,t){return e===t}};var St=zt,Tt=zt;function Mt(e){return fe(Gt)(function(e){switch(e.state.kind){case"top":return se(U(e.state.error));case"bottom":return ue;case"inner":return function(e){return function(e){switch(e.kind){case"numberGroup":case"stringGroup":return Nt(e.group);case"tuple":return e.tuple.length>0}}(e.payload)?se(J(function(e,t){const n=fe(e=>ht(e,t))(e);return pe(()=>t)(n)}(fe(e=>U(function(e){const t=e=>{switch(e){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return e.map(e=>1===e[2]?t(e[1]):t(e[1])+JSON.stringify(e[2])).join("")}(e)))(e.commands),function(e){const t=e=>{switch(e.kind){case"bottom":return{kind:"null",value:null};case"top":return U(e.error);case"inner":return $(e.a)}};switch(e.kind){case"tuple":return e.tuple.map(t);case"stringGroup":return n=e.group,kt([It,Ct,e=>ct(e,Et,Y,se)],e=>e(n));case"numberGroup":return(e=>kt([It,Lt,e=>ct(e,Et,e=>jt(e,([e,t])=>[JSON.stringify(e),t]),Y,se)],t=>t(e)))(e.group)}var n}(e.payload)))):ue}(e.state.a)}}(e))}function Nt(e){switch(e.kind){case"unbounded":return e.group.size>0;case"windowed":return e.group.size>0||oe(e.key);case"countLimit":case"uniqueLimit":return e.group.size>0||oe(e.limit)}}function It(e){switch(e.kind){case"unbounded":return ue;case"windowed":return se(U("w"));case"countLimit":return se(U(1===e.n?"x":"x"+e.n));case"uniqueLimit":return se(U(1===e.n?"u":"u"+e.n))}}function Ct(e){switch(e.kind){case"unbounded":return ue;case"windowed":return se(U(oe(e.key)?e.key.value:""));case"countLimit":case"uniqueLimit":return se(U(oe(e.limit)?e.limit.value:""))}}function Lt(e){switch(e.kind){case"unbounded":return ue;case"windowed":return oe(e.key)?se($(e.key.value)):se({kind:"null",value:null});case"countLimit":case"uniqueLimit":return oe(e.limit)?se($(e.limit.value)):se({kind:"null",value:null})}}function Et(e){switch(e.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return e.group}}function Gt(e){switch(e.kind){case"array":return 0===e.value.length?{kind:"null",value:null}:1===e.value.length?Gt(e.value[0]):J(e.value.map(Gt));case"object":return ct(Ot(e.value,([e,t])=>"null"!==t.kind),e=>jt(e,e=>[e[0],Gt(e[1])]),Y);default:return e}}function Rt(e){const t=e=>{if(0===e.length)return{kind:"bottom"};const t=(e=>{if(4!==e.length)return ue;const[t,n,r,i]=e;if("string"===t.kind&&"string"===n.kind&&"object"===i.kind){const e=le(e=>Vt(e[1].value)&&Dt(e[2].value))({1:t,2:n});return fe(e=>({prim:e[1].value,grp:e[2].value,cutoff:r,m:i.value}))(e)}return ue})(e);if(oe(t)){const{prim:e,grp:n,cutoff:r,m:i}=t.value,a=Ft(r,i,Ut(n));return"string"==typeof a?K(a):H(ae($t(e),a))}const n=(e=>{if(3!==e.length)return ue;const[t,n,r]=e;if("string"===t.kind&&"object"===r.kind){const e=le(e=>Dt(e.value))(t);return fe(e=>({grp:e.value,cutoff:n,m:r.value}))(e)}return ue})(e);if(oe(n)){const{grp:e,cutoff:t,m:r}=n.value,i=Ft(t,r,Ut(e));return"string"==typeof i?K(i):H(ae(ue,i))}const r=(e=>{if(2!==e.length)return ue;const[t,n]=e;if("string"===t.kind&&"object"===n.kind){const e=le(e=>Vt(e.value))(t);return fe(e=>({prim:e.value,m:n.value}))(e)}return ue})(e);if(oe(r)){const{prim:e,m:t}=r.value;return H(ae($t(e),ne(Q(t))))}const i=(e=>{if(1!==e.length)return ue;const[t]=e;return"object"===t.kind?se({m:t.value}):ue})(e);if(oe(i)){const{m:e}=i.value;return H(ae(ue,ne(Q(e))))}const a=(e=>{if(e.length<1)return ue;const[t,...n]=e;if("string"===t.kind){const e=le(e=>Vt(e.value))(t);return fe(e=>({prim:e.value,rest:n}))(e)}return ue})(e);if(oe(a)){const{prim:e,rest:t}=a.value;return H(ae($t(e),Jt(t)))}return H(ae(ue,Jt(e)))},n=e=>{switch(e.kind){case"array":return it(n)(e.value);default:return[e]}};switch(e.kind){case"null":return ie({kind:"bottom"});default:return ie(t(n(e)))}}function Vt(e){const t=e.split("");switch(!0){case 0===t.length:return!1;default:{const[e,...n]=t;return-1!=="pmvn".indexOf(e)&&n.every(e=>-1!=="pmvn0123456789".indexOf(e))}}}function Dt(e){const t=e.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[e,...n]=t;return-1!=="ux".indexOf(e)&&-1===n.map(e=>!isNaN(parseInt(e))).indexOf(!1)}}}function Ft(e,t,n){switch(e.kind){case"string":return ne(n({1:se(e.value),2:t}));case"number":case"null":return te(n({1:"null"===e.kind?ue:se(e.value),2:Ot(jt(t,([e,t])=>[Number(e),t]),e=>!isNaN(e[0]))}));default:return"{bad cutoff}"}}function Ut(e){const t=e=>t=>ee(t[2],t[1],e),n=e=>t=>Z(t[2],t[1],e),r=e.split("");switch(!0){case"w"===r[0]&&void 0===r[1]:return e=>X(e[2],e[1]);case"u"===r[0]&&void 0===r[1]:return t(1);case"u"===r[0]&&void 0!==r[1]:return t(parseInt(r.slice(1).join("")));case"x"===r[0]&&void 0===r[1]:return n(1);case"x"===r[0]&&void 0!==r[1]:return n(parseInt(r.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function $t(e){return fe(B)(bt(function e(t,n){const r=n(t);return pe(()=>[])(fe(t=>[t[1]].concat(e(t[2],n)))(r))}(e,e=>{const t=e.split("");if(0===t.length)return ue;const[n,...r]=t,i=(e=>{switch(e){case"p":return se("add");case"m":return se("mul");case"v":return se("max");case"n":return se("min");default:return ue}})(n);return fe(e=>{const{init:t,rest:n}=Qe(e=>{return"number"==typeof(t=parseInt(e))&&isFinite(t)&&Math.floor(t)===t;var t})(r);return{1:{1:e,2:0===t.length?1:parseInt(t.join(""))},2:n.join("")}})(i)})))}function Jt(e){return re(e.map(Yt))}function Yt(e){switch(e.kind){case"number":return H(e.value);case"string":return K(e.value);case"null":return{kind:"bottom"};case"object":return K("{object}");case"array":return K("{array}")}}const Bt={strategy:(e,t,n)=>r=>{if(ce(n))return t;if("delta"===e&&ce(t))return ue;if(ce(t))return n;if(oe(t)&&oe(n))return r(t.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(e,t,n,r,i,a)=>{const o=He(wt(a));if("append"===e&&"add"===t)return nt(n,r,en(i.plus));if("append"===e&&"mul"===t)return nt(n,r,en(i.times));if("append"===e&&"max"===t)return _e(o)(n,r);if("join"===e&&"add"===t)return nt(n,r,en(_e(a)));if("join"===e&&"mul"===t)return nt(n,r,en(_e(a)));if("join"===e&&"max"===t)return _e(o)(n,r);if("min"===t)return Bt.operation(e,"max",n,r,i,function(e){return ke((t,n)=>function(e){switch(e){case-1:return 1;case 1:return-1;default:return 0}}(e.compare(t,n)))}(a));if("delta"===e&&"max"===t)return be(o)(n,r)?n:r.map(W);if("delta"===e)return nt(n,r,(e,t)=>be(wt(a))(e,t)?e:{kind:"bottom"});throw new Error("Non exhaustive match in combineCommand.operation")}},Wt={plus:(e,t)=>e+t,times:(e,t)=>e*t};function Ht(e,t,n,r){if("unbounded"===e.kind&&"unbounded"===t.kind){const i=e.group,a=t.group;return pe(W)(fe(e=>H(Q(e)))(xt(i,a,n,r)))}if("windowed"===e.kind&&"windowed"===t.kind){const i=e.key,a=e.group,o=t.key,c=t.group,u=_e(me(r))(i,o);return pe(W)(fe(e=>H(X(e,u)))(xt(a,c,n,r)))}if("countLimit"===e.kind&&"countLimit"===t.kind){const i=e.n,a=t.n;if(i===a){const a=e.limit,o=e.group,c=t.limit,u=t.group,s=_e(me(r))(a,c);return pe(W)(fe(e=>H(Z(e,s,i)))(xt(o,u,n,r)))}return K("Non matching counts")}if("uniqueLimit"===e.kind&&"uniqueLimit"===t.kind){const i=e.n,a=t.n;if(i===a){const a=e.limit,o=e.group,c=t.limit,u=t.group,s=_e(me(r))(a,c);return pe(W)(fe(e=>H(ee(e,s,i)))(xt(o,u,n,r)))}return K("Non matching counts")}return K("Non matching group types")}function Kt(e,t,n){return pe(F)(function e(t,n){const r=n=>(r,i)=>Bt.strategy(t,r,i)(e(t,n)),i=(e,n,i)=>{if("stringGroup"===n.kind&&"stringGroup"===i.kind){const t=Ht(n.group,i.group,r(e),we);return vt(t,e=>ne(Xt(e,we)))}if("numberGroup"===n.kind&&"numberGroup"===i.kind){const t=Ht(n.group,i.group,r(e),qe);return vt(t,e=>te(Xt(e,qe)))}if("tuple"===n.kind&&"tuple"===i.kind){const r=oe(e)?e.value:[];return H(re(function(e,t,n,r,i,a){const o=(e,t)=>({1:Ke(e)(t).concat([...Array(Math.max(0,e-t.length))].map(W)),2:Xe(e)(t)}),c=(t,n,r)=>{if(0===t.length)return Bt.operation(e,"max",n,r,i,a);if(0===n.length)return r;if(0===r.length)return n;if(t.length>0){const[u,...s]=t,l=o(u[2],n),p=l[1],d=l[2],f=o(u[2],r),g=f[1],m=f[2];return Bt.operation(e,u[1],p,g,i,a).concat(c(s,d,m))}throw new Error("Non exhaustive match in recurse")};return et(Ze(e=>"bottom"===e.kind)(et(c(t,n,r))))}(t,r,n.tuple,i.tuple,Wt,qe)))}throw new Error(`Non matching payload. Got ${n.kind} and ${i.kind}`)},a=(e,t)=>{var r;if(ge(_t((r={1:St,2:Tt},At((function(e,t){for(var n in r)if(!r[n].equals(e[n],t[n]))return!1;return!0}))))).equals(e.commands,t.commands)){const r=ce(e.commands)?n:e.commands,a=i(r,e.payload,t.payload);return vt(a,t=>ae(e.commands,t))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(e)} and ${JSON.stringify(t)}`)};return(e,t)=>Mt(ie(Zt(a,Rt(e).state,Rt(t).state)))}(e,ue)(t,n))}function Qt(e,t,n){const r=fe(t=>Ot(e,([e,r])=>{return(i=n,function(e,t){return-1!==i.compare(e,t)})(e,t);var i}))(t);return pe(()=>e)(r)}function Xt(e,t){switch(e.kind){case"unbounded":return e;case"windowed":return ce(e.key)?e:X(Qt(e.group,e.key,t),e.key);case"countLimit":{const n=e.limit,r=e.n,i=e.group,a=Pt(r,i,(e,t)=>t<=1?ue:se(t-1),t),o=_e(me(t))(n,a);return Z(Qt(i,o,t),o,r)}case"uniqueLimit":{const n=e.limit,r=e.n,i=e.group,a=(e,t)=>{switch(e.kind){case"object":{const n=[...e.value.keys(),...t.keys()],i=new Set(n);return i.size>=r?ue:se(i)}default:return ue}},o=Pt(new Set,i,a,t),c=_e(me(t))(n,o);return ee(Qt(i,c,t),c,r)}}}function Zt(e,t,n){if("inner"===t.kind&&"inner"===n.kind)return e(t.a,n.a);if("bottom"===t.kind)return n;if("bottom"===n.kind)return t;if("top"===t.kind&&"top"===n.kind)return K(_e(we)(t.error,n.error));if("top"===t.kind)return t;if("top"===n.kind)return n;throw new Error("Non exhaustive match in extend")}function en(e){return(t,n)=>Zt((t,n)=>H(e(t,n)),t,n)}function tn(e,t){return Kt("append",e,t)}function nn(e,t){return Object.keys(e).reduce((n,r)=>{const i=t(r,e[r]);return Object.assign(Object.assign({},n),oe(i)?{[r]:i.value}:{})},{})}const rn={12928:(an=(()=>{function e(e){switch(e.length){case 0:return null;case 1:return e[0];default:return e}}function t(e,t,n=a){let r=t.reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e);return null===r?null:n(r)}function n(e,t){var n=t.slice();return n.unshift(e),n}let r=(e,r,i=a)=>t(e,n("properties",r),i);function i(e){const t=Object.keys(e);for(var n=t.length,r=new Array(n);n--;)r[n]=[t[n],e[t[n]]];return r}let a=e=>e,o=e=>!0,c=(e,t)=>n=>e(n)&&t(n),u=(e,t)=>n=>e(n)||t(n),s=e=>t=>!e(t),l=(e,t)=>n=>n>=e&&n<=t,p=e=>new Date(e).getTime(),d=e=>t(e,["time"],p),f=(e,n)=>t(n,e,p),g=(e,n,r,i,a,o)=>c=>{const u=t(c,e,e=>e.filter(i).map(e=>t(e,n)).reduce(a,o));return r(null===u?o:u)},m=e=>t=>"string"==typeof e&&"string"==typeof t&&t.toLowerCase().indexOf(e.toLowerCase())>-1,y=e=>t=>null!=t&&"object"==typeof t&&t.indexOf(e)>=0;function v(e,n,r,i,a){const o=t(e.getSegments(),[n,r])||!1;return a&&(i||o)&&e.setSegmentActivation(n,r,a),o}function w(e,n,r){return t(e.getSegments(),[n,r])||!1}let q=(e,n,r=18e5)=>i=>({a:{m:(e,t)=>[t[0],i.a.m(null!=e[0]&&e[0][0]===t[0][0]?e[1]:i.a.z,t[1])],z:[[],i.a.z]},p:(r,a)=>[[e(r)],t(a,n)===e(r)?i.p(r,a):i.a.z],r:(t,n)=>i.r(t,n[0]!=[]&&n[0][0]===e(t)?n[1]:i.a.z),d:i.d.sq||{l:(a,o)=>{let c=t(a,n),u=e(o);if(c!==u)return null;let s=i.d.l(a,o);if(!(Array.isArray(s)&&s.length>1))return null;let[l,...p]=s,f=+(d(a)||o.getCurrentTime()),g=Math.floor(f/r),m={};return m[g]={},m[g][u]=1===p.length?p[0]:p,[l,"u",null,m]},i:(t,n)=>{if(!Array.isArray(t)||"object"!=typeof t[3])return[[],i.a.z];let r=e(n),a=t[3];return[[r],Object.keys(a).map(e=>a[e][r]).filter(e=>e).map(e=>i.d.i([t[0]].concat(e))).reduce(i.a.m,i.a.z)]}}}),h=q(e=>e.getCurrentSession(),["session_id"],18e5),b=q(e=>e.getCurrentView(),["view_id"],3e5);function _(e,n,r,i=1){return{a:{m:(e,t)=>e.concat(t).slice(-r),z:[]},p:(r,i)=>t(i,["name"])===n?[e.p(r,i)]:[],r:(t,n)=>e.r(t,n.reduce((t,n)=>e.a.m(t,n),e.a.z)),d:e.d.ftn||{l:(n,a)=>{const o=e.d.l(n,a),c=t(n,["time"],p)*i;return o&&[o[0],"x"+r,null,{[c]:2==o.length?o[1]:o.slice(1)}]},i:(t,n)=>t?Object.keys(t[3]||{}).sort().reverse().map(e=>Array.isArray(e)?[t[0],...t[3][e]]:[t[0],t[3][e]]).map(t=>e.d.i(t,n)):[]}}}let k=(e,t)=>null===e?null==t?null:{b:t}:null==t?{a:e}:{a:e,b:t},x=(e,t)=>e&&t?e(t):null,P=(e,t,n)=>n&&n.result&&Array.isArray(n.result)?k(x(e.d&&e.d.m,{result:n.result[0]}),x(t.d&&t.d.m,{result:n.result[1]})):null;return{q:function(e){const t=(t,n)=>({result:e.r(t,n)});return{initial:t=>({result:e.a.z}),update:(t,n,r)=>({result:e.a.m(n.result,e.p(t,r))}),result:(e,n)=>t(e,n.result),lift:(t,n)=>e.d.l(t,n),interpret:(n,r)=>t(r,e.d.i(n,r)),migrate:t=>t&&e.d.m?e.d.m(t):null,m:e.a.m,z:e.a.z,p:e.p,r:e.r,i:e.d.i}},a:e=>e.reduce(c),acq:function(e,t){return{p:(n,r)=>[e.p(n,r),t.p(n,r)],r:(n,r)=>e.r(n,r[0])&&t.r(n,r[1]),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:{l:(n,r)=>k(e.d.l(n,r),t.d.l(n,r)),i:(n,r)=>n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z],m:n=>P(e,t,n)}}},af_i:(e,n,r=o)=>i=>t(i,e,e=>e.filter(r).map(n).reduce((e,t)=>e&&t,!0))&&!0,af_l:(e,n,r=o)=>i=>{const a=t(i,e,e=>e.filter(r).length);return n(null===a?0:a)},af_m:(e,n,r,i=o)=>a=>{const o=t(a,e,e=>e.filter(i));return null===o||0===o.length?r(0):r(o.map(e=>t(e,n)).reduce((e,t)=>e+t,0)/o.length)},af_n:(e,t,n,r=o)=>g(e,t,n,r,(e,t)=>Math.min(e,t),Number.POSITIVE_INFINITY),af_p:(e,t,n,r=o)=>g(e,t,n,r,(e,t)=>e*t,1),af_s:(e,t,n,r=o)=>g(e,t,n,r,(e,t)=>e+t,0),af_u:(e,n,r=o)=>i=>t(i,e,e=>e.filter(r).map(n).reduce((e,t)=>e||t,!1))||!1,af_x:(e,t,n,r=o)=>g(e,t,n,r,(e,t)=>Math.max(e,t),Number.NEGATIVE_INFINITY),as:(e,r,i)=>a=>i.reduce((i,o)=>i&&e(o)(t(a,n("properties",r))),!0),c:y,c_:(e,n)=>r=>y(n)(t(r,e)),ctu:function(e,n,r,i){return{a:i?{m:(e,t)=>e.filter(e=>-1===t.indexOf(e)).concat(t).slice(-i),z:[]}:{m:(e,t)=>e.filter(e=>-1===t.indexOf(e)).concat(t),z:[]},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):[],r:(e,t)=>t,d:{l:()=>null,i:()=>[]}}},ctv:function(e,n,r,i){function a(e,t){const n=e=>({k:e.k,c:1+e.c}),r={arr:[],add:{k:t,c:1}};return t?(e=>e.arr.concat(e.add))(e.reduce((e,t)=>e.add.k===t.k?{arr:e.arr,add:n(t)}:{arr:e.arr.concat(t),add:e.add},r)):e}return{a:i?{m:(e,t)=>a(e,t).slice(-i),z:[]}:{m:(e,t)=>a(e,t),z:[]},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):null,r:(e,t)=>t.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.k]:t.c}),{}),d:{l:e=>null,i:e=>[]}}},ctw:function(e,n,r,i){return{a:i?{m:(e,t)=>e.concat(t).slice(-i),z:[]}:{m:(e,t)=>e.concat(t),z:[]},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):[],r:(e,t)=>t,d:{l:()=>null,i:()=>[]}}},cw:function(e,n,r=a){return{a:{m:(e,t)=>e+t,z:0},p:(r,i)=>t(i,["name"])===e&&n(i)?1:0,r:(e,t)=>r(t),d:{l:r=>t(r,["name"])===e&&n(r)?["p",1]:null,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:0,m:e=>e&&e.result?["p",e.result]:null}}},e:e=>t=>t===e,e_:(e,n)=>r=>t(r,e)===n,fm:function(e,t){return{p:t.p,r:(n,r)=>e(t.r(n,r)),a:t.a,d:t.d}},ftn:function(e,n,r){return{a:{m:(e,t)=>e.concat(t.slice(0,r-e.length)),z:[]},p:(r,i)=>t(i,["name"])===n?[e.p(r,i)]:[],r:(t,n)=>e.r(t,n.reduce((t,n)=>e.a.m(t,n),e.a.z)),d:_(e,n,r,-1).d}},fw:function(e,n,r,i=a){return{a:{m:(e,t)=>null===e?t:e,z:null},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):null,r:(e,t)=>t,d:{l:r=>t(r,["name"])===e&&n(r)?["p",1]:null,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:0,m:e=>e&&e.result?["p",e.result]:null}}},g:e=>t=>t>e,g_:(e,n)=>r=>t(r,e)>n,gb:function(e,r,i){return{a:{m:(n,i)=>Object.keys(n).concat(Object.keys(i)).filter((e,t,n)=>n.indexOf(e)===t).sort((e,r)=>Math.max(t(n,[r,1]),t(i,[r,1]))-Math.max(t(n,[e,1]),t(i,[e,1]))).slice(0,r).reduce((r,a)=>{const o=e.a.m(t(n,[a,0])||e.a.z,t(i,[a,0])||e.a.z);return r[a]=[o,Math.max(t(n,[a,1]),t(i,[a,1]))],r},{}),z:{}},p:(r,a)=>{const o=t(a,n("properties",i)),c=e.p(r,a);return null==o||null==(u=c)||"object"==typeof u&&0===Object.keys(u).length||u===e.a.z?{}:{[o]:[c,t(a,["time"],p)]};var u},r:(t,n)=>{const r={};return Object.keys(n).forEach(i=>r[i]=e.r(t,n[i][0])),r},d:{l:()=>null,i:()=>({})}}},ge:e=>t=>t>=e,ge_:(e,n)=>r=>t(r,e)>=n,i_:a,ifp:function(e){let t=(t,n)=>w(t,"1p",e);return{a:{m:(e,t)=>t,z:!1},p:t,r:(e,t)=>t,d:{l:(e,n)=>["v2",+p(d(e)||n.getCurrentTime()),+t(n)],i:e=>Array.isArray(e)&&(!!+e[2]||!1)}}},isp:function(e,t,n,r){return{a:{m:(e,t)=>t,z:!1},p:(n,r)=>w(n,e,t),r:(i,a)=>v(i,e,t,n,r),d:{l:(e,t)=>null,i:e=>Array.isArray(e)&&(!!+e[2]||!1)}}},itp:function(e,t,n,r){return{a:{m:(e,t)=>t,z:!1},p:(n,r)=>w(n,e,t),r:(i,a)=>v(i,e,t,n,r),d:{l:(e,t)=>null,i:e=>Array.isArray(e)&&(!!+e[2]||!1)}}},k:t,l:e=>t=>t<e,l_:(e,n)=>r=>t(r,e)<n,le:e=>t=>t<=e,le_:(e,n)=>r=>t(r,e)<=n,lm:function(e,t){let n=(t,n)=>function(e,t,n){const r=e||{},a=t[n]||{};var o=(a["1p"]||{}).const||0;const c=i(a);for(var u in c){const e=i(c[u][1]);for(var s in e)!0===(r[c[u][0]]||{})[e[s][0]]&&(o+=e[s][1])}return l=o,1/(1+Math.pow(Math.E,-l));var l}(t.getSegments(),t.getLookalikeModels(),e);return{a:{m:(e,t)=>t,z:[]},p:(e,t)=>[n(e)],r:(e,n)=>!!n[0]&&t(n[0]),d:{l:(e,t)=>["v2",+p(d(e)||t.getCurrentTime()),+n(t)],i:e=>Array.isArray(e)?[+e[2]]||!1:[]}}},ltn:_,mnw:function(e,n,r,i=a){var o=Number.POSITIVE_INFINITY;return{a:{m:(e,t)=>e<t?e:t,z:o},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):o,r:(e,t)=>i(t),d:{l:i=>t(i,["name"])===e&&n(i)?["n",t(i,r)]:null,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:o}}},mxw:function(e,n,r,i=a){const o=Number.NEGATIVE_INFINITY;return{a:{m:(e,t)=>e>t?e:t,z:o},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):o,r:(e,t)=>i(t),d:{l:i=>t(i,["name"])===e&&n(i)?["v",t(i,r)]:null,i:e=>e?Array.isArray(e)?e.slice(-1)[0]:e:o}}},n0:s(a),n:e=>t=>t!==e,nt:s,n_:(e,n)=>r=>t(r,e)!==n,o:e=>e.reduce(u),ocq:function(e,t){return{p:(n,r)=>[e.p(n,r),t.p(n,r)],r:(n,r)=>e.r(n,r[0])||t.r(n,r[1]),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:{l:(n,r)=>k(e.d.l(n,r),t.d.l(n,r)),i:(n,r)=>n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z],m:n=>P(e,t,n)}}},oe:i,os:(e,r,i)=>a=>i.reduce((i,o)=>i||e(o)(t(a,n("properties",r))),!1),pb:(e,t,n)=>i=>l(t,n)(r(i,e)),pc:(e,r)=>i=>{const a=t(i,n("properties",e));return null!=a&&"object"==typeof a&&a.indexOf(r)>=0},pe:(e,t)=>n=>r(n,e)===t,pg:(e,t)=>n=>r(n,e)>t,pge:(e,t)=>n=>r(n,e)>=t,pl:(e,t)=>n=>r(n,e)<t,ple:(e,t)=>n=>r(n,e)<=t,pn:(e,t)=>n=>r(n,e)!==t,ps:(e,t)=>n=>m(t)(r(n,e)),pw:function(e,n,r,i=a){return{a:{m:(e,t)=>e*t,z:1},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):1,r:(e,t)=>i(t),d:{l:i=>{return t(i,["name"])===e&&n(i)?(a=t(i,r))>=1?["m2p",a]:a>0?["m2p",null,1/a]:0==a?["m2p",0]:a>-1?["m2p",null,1/a,1]:["m2p",a,null,1]:null;var a},i:e=>{return e?Array.isArray(e)?0===(t=e.slice(1))[0]?0:Math.pow(-1,t[2]||0)*(t[0]||1)/(t[1]||1):e:1;var t}}}},s:m,s_:(e,n)=>r=>m(n)(t(r,e)),scq:function(e,t,n=a){return{p:(n,r)=>[e.p(n,r),t.p(n,r)],r:(r,i)=>n(e.r(r,i[0])+t.r(r,i[1])),a:{z:[e.a.z,t.a.z],m:(n,r)=>[e.a.m(n[0],r[0]),t.a.m(n[1],r[1])]},d:{l:(n,r)=>k(e.d.l(n,r),t.d.l(n,r)),i:(n,r)=>n?[e.d.i(n.a||null,r),t.d.i(n.b||null,r)]:[e.a.z,t.a.z],m:n=>P(e,t,n)}}},sq:h,sw:function(e,n,r,i=a){return{a:{m:(e,t)=>e+t,z:0},p:(i,a)=>t(a,["name"])===e&&n(a)?t(a,r):0,r:(e,t)=>i(t),d:{l:i=>{return(r=>t(r,["name"])===e&&n(r))(i)?(a=t(i,r))<0?["p2",null,-a]:["p2",a]:null;var a},i:e=>{return e?Array.isArray(e)?((t=e.slice(1))[0]||0)-(t[1]||0):e:0;var t}}}},t:o,tb:(e,t)=>n=>l(e,t)(d(n)),te:e=>t=>d(t)===e,te_:(e,t)=>n=>f(e,n)===t,tg:e=>t=>d(t)>e,tg_:(e,t)=>n=>f(e,n)>t,tge:e=>t=>d(t)>=e,tge_:(e,t)=>n=>f(e,n)>=t,ti:p,tl:e=>t=>d(t)<e,tl_:(e,t)=>n=>f(e,n)<t,tle:e=>t=>d(t)<e,tle_:(e,t)=>n=>f(e,n)<t,tn:e=>t=>d(t)!==e,tn_:(e,t)=>n=>f(e,n)!==t,tw:function(n,r,i){const a=i||100,o=Math.ceil(r/a),c=e=>Math.floor(e/o),u=(e,t,n)=>[c(e-r),{[c(t)]:n}],s=(e,t)=>{const r=Math.max(e[0],t[0]),i=Object.keys(e[1]).filter(e=>e>=r).concat(Object.keys(t[1]).filter(e=>e>=r)).filter((e,t,n)=>n.indexOf(e)===t).reduce((r,i)=>{const a=n.a.m(e[1][i]||n.a.z,t[1][i]||n.a.z);return a!==n.a.z&&(r[i]=a),r},{});return[r,i]},l=[Number.NEGATIVE_INFINITY,{}],d=e=>{const t=t=>t.map(([t,n,r])=>u(e.t,r,t)).reduce(s,l);return s(t(e.in),t(e.out))},f=t=>{if(void 0!==t.result)return f(t.result);if(void 0!==t.w)return f(d(t));const[r,i]=t;let a=null,o={};for(let t in i){let r=n.d.m({result:i[t]});r&&Array.isArray(r)&&(a=r[0],o[t]=e(r.slice(1)))}return a&&[a,"w",t[0],o]};return{a:{m:(e,t)=>{const n=e.w?d(e):e;return s(n,t)},z:l},p:(e,r)=>u(e.getCurrentTime(),t(r,["time"],p),n.p(e,r)),r:(e,t)=>{const r=(t.w?d(t):t)[1];return n.r(e,Object.keys(r).reduce((e,t)=>n.a.m(e,r[t]),n.a.z))},d:n.d.tw||{l:(e,r)=>{let i=n.d.l(e,r);return i&&[i[0],"w",...u(r.getCurrentTime(),t(e,["time"],p),i.slice(1))]},i:(e,t)=>{let r=Array.isArray(e)?e:[];return[r[2]||null,Object.keys(r[3]||{}).map(e=>({[e]:n.d.i(r[3][e],t)})).reduce((e,t)=>(Object.keys(t).forEach(n=>e[n]=t[n]),e),{})]},m:n.d.m&&f}}},vgw:function(e,n,r,i=a){const o={v:0,k:0};return{a:{m:(e,t)=>{var n=e.k+t.k;return{v:n?e.v+t.k*(t.v-e.v)/n:0,k:n}},z:o},p:(i,a)=>t(a,["name"])===e&&n(a)?{v:t(a,r),k:1}:o,r:(e,t)=>i(t.v),d:{l:i=>{return t(i,["name"])===e&&n(i)?0==(a=t(i,r))?["p3",1]:a<0?["p3",1,null,-a]:["p3",1,a]:null;var a},i:e=>{return e?Array.isArray(e)?{v:(((t=e.slice(1))[1]||0)-(t[2]||0))/(t[0]||1),k:t[0]||0}:void 0:o;var t}}}},vq:b}})()).q(an.cw("Pageview",an.t,an.ge(1))),12999:an.q(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["https://execed.economist.com/","execed.economist.com"])]),an.ge(1))),13286:an.q(an.cw("Pageview",an.t,an.ge(1))),14253:an.q(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.tw(an.cw("Pageview",an.o([an.os(an.e,["channel"],["business","business_and_finance","economics","economicsbrief","finance_and_economics","financeandeconomics"])]),an.ge(3)),24192e5),an.itp("eyeota_pacificdatapartners","23986",!1,"14253")),an.itp("eyeota_kantarmedia","19301",!1,"14253")),an.itp("eyeota_experian","27452",!1,"14253")),an.itp("eyeota_dataxpand","14589",!1,"14253")),an.itp("eyeota_dunbradstreet","20699",!1,"14253")),an.itp("eyeota_dunbradstreet","20703",!1,"14253")),an.itp("eyeota_dunbradstreet","20700",!1,"14253")),an.itp("eyeota_dunbradstreet","20697",!1,"14253")),an.itp("eyeota","6531",!1,"14253"))),14257:an.q(an.ocq(an.cw("Pageview",an.ps(["client","title"],"sport"),an.ge(1)),an.itp("eyeota_netsprint","17699",!1,"14257"))),14279:an.q(an.cw("User",an.ps(["client","referrer"],"facebook"),an.ge(1))),14722:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.e,["channel"],["scienceandtechnology","science_and_technology"])]),an.ge(2)),2592e6)),14723:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.e,["channel"],["economics","finance_and_economics","financeandeconomics","business_and_finance","business","economicsbrief"])]),an.ge(2)),2592e6)),14726:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.e,["channel"],["books_and_arts","booksandarts"])]),an.ge(2)),2592e6)),14728:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.e,["channel"],["blogs","blogs_americas_view","blogs_buttonwood_s_notebook","blogs_democracy_in_america","blogs_newsbook","blogs_open_future","blogs_pomegranate","blogs_schumpeter","blogs_the_economist_explains"])]),an.ge(2)),2592e6)),14736:an.q(an.tw(an.cw("SlotClicked",an.t,an.e(1)),24192e5)),14737:an.q(an.acq(an.tw(an.cw("SlotClicked",an.t,an.ge(2)),24192e5),an.tw(an.cw("SlotClicked",an.t,an.le(4)),24192e5))),14738:an.q(an.tw(an.cw("SlotClicked",an.t,an.ge(5)),24192e5)),14746:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","14056",!1,"14746"),an.itp("eyeota_pacificdatapartners","24002",!1,"14746")),an.itp("eyeota_alc","20294",!1,"14746")),an.itp("eyeota_alc","20292",!1,"14746")),an.itp("eyeota_amberdata","18059",!1,"14746")),an.itp("eyeota_dunbradstreet","20895",!1,"14746")))),14747:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.itp("eyeota_alc","20295",!1,"14747"),an.itp("eyeota_bombora","14055",!1,"14747")),an.itp("eyeota_bombora","13926",!1,"14747")),an.itp("eyeota_meritdirect","23619",!1,"14747")))),14749:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","13902",!1,"14749"),an.itp("eyeota","6536",!1,"14749")),an.itp("eyeota_dunbradstreet","20702",!1,"14749")),an.itp("eyeota","34887",!1,"14749")))),14750:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","13899",!1,"14750"),an.itp("eyeota_bombora","13901",!1,"14750")),an.itp("eyeota_bombora","13900",!1,"14750")),an.itp("eyeota_bombora","13902",!1,"14750")),an.itp("eyeota_bombora","13903",!1,"14750")),an.itp("eyeota_bombora","13904",!1,"14750")),an.itp("eyeota","6531",!1,"14750")),an.itp("eyeota","6532",!1,"14750")),an.itp("eyeota","6533",!1,"14750")),an.itp("eyeota","6534",!1,"14750")),an.itp("eyeota","6535",!1,"14750")),an.itp("eyeota","6536",!1,"14750")),an.itp("eyeota","6537",!1,"14750")),an.itp("eyeota","6538",!1,"14750")),an.itp("eyeota","6540",!1,"14750")),an.itp("eyeota","6541",!1,"14750")),an.itp("eyeota_pacificdatapartners","23986",!1,"14750")),an.itp("eyeota_dunbradstreet","20705",!1,"14750")),an.itp("eyeota_kantarmedia","19301",!1,"14750")),an.itp("eyeota_pacificdatapartners","23986",!1,"14750")),an.itp("eyeota_netsprint","17340",!1,"14750")))),14751:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","21007",!1,"14751"),an.itp("eyeota_meritdirect","23587",!1,"14751")),an.itp("eyeota_bombora","14273",!1,"14751")),an.itp("eyeota","61",!1,"14751")),an.itp("eyeota_alc","20410",!1,"14751")),an.itp("eyeota_pacificdatapartners","24036",!1,"14751")),an.itp("eyeota_dunbradstreet","20699",!1,"14751")),an.itp("eyeota_dunbradstreet","20879",!1,"14751")),an.itp("eyeota_dunbradstreet","20856",!1,"14751")),an.itp("eyeota_dunbradstreet","20857",!1,"14751")),an.itp("eyeota_dunbradstreet","20698",!1,"14751")),an.itp("eyeota","6554",!1,"14751")),an.itp("eyeota","6553",!1,"14751")),an.itp("eyeota_alc","20512",!1,"14751")),an.itp("eyeota_alc","20424",!1,"14751")),an.itp("eyeota_alc","20425",!1,"14751")),an.itp("eyeota_bombora","14274",!1,"14751")),an.itp("eyeota_dunbradstreet","20879",!1,"14751")))),14759:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dlg","18775",!1,"14759"),an.itp("eyeota_experian","21446",!1,"14759")),an.itp("eyeota_experian","21448",!1,"14759")),an.itp("eyeota_experian","21450",!1,"14759")),an.itp("eyeota_dlg","18768",!1,"14759")),an.itp("eyeota_gfk","8585",!1,"14759")),an.itp("eyeota_kantarmedia","19298",!1,"14759")),an.itp("eyeota_pacificdatapartners","24247",!1,"14759")),an.itp("eyeota_pacificdatapartners","24068",!1,"14759")),an.itp("eyeota_pacificdatapartners","24097",!1,"14759")),an.itp("eyeota_gbgtransactis","19823",!1,"14759")),an.itp("eyeota","13016",!1,"14759")),an.itp("eyeota_gbgtransactis","19823",!1,"14759")),an.itp("eyeota","302",!1,"14759")),an.itp("eyeota_bombora","14267",!1,"14759")))),14760:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.itp("eyeota_experian","21450",!1,"14760"),an.itp("eyeota_experian","21695",!1,"14760")),an.itp("eyeota_alc","31313",!1,"14760")),an.itp("eyeota_alc","31312",!1,"14760")))),14790:an.q(an.cw("Pageview",an.pe(["client","url"],"https://events.economist.com/events-conferences/emea/cannabis-summit"),an.ge(1))),14793:an.q(an.tw(an.cw("Pageview",an.t,an.ge(5)),24192e5)),14795:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.itp("eyeota_plungedigital","32503",!1,"14795"),an.itp("eyeota_bombora","13927",!1,"14795")),an.itp("eyeota_sharethis","15943",!1,"14795")),an.itp("eyeota","6534",!1,"14795")))),15e3:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_alc","20499",!1,"15000"),an.itp("eyeota","287",!1,"15000")),an.itp("eyeota_dataxpand","29542",!1,"15000")),an.itp("eyeota_pacificdatapartners","24222",!1,"15000")),an.itp("eyeota_experian","30137",!1,"15000")),an.itp("eyeota_specialists","24958",!1,"15000")),an.itp("eyeota_amberdata","17959",!1,"15000")),an.itp("eyeota_ndr","34209",!1,"15000")),an.itp("eyeota_dataxpand","14501",!1,"15000")),an.itp("eyeota_bombora","14281",!1,"15000")))),15038:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","20770",!1,"15038"),an.itp("eyeota_netsprint","17324",!1,"15038")),an.itp("eyeota_meritdirect","23615",!1,"15038")),an.itp("eyeota_bombora","14268",!1,"15038")),an.itp("eyeota_amberdata","18070",!1,"15038")),an.itp("eyeota_alc","20310",!1,"15038")),an.itp("eyeota_alc","20310",!1,"15038")),an.itp("eyeota_bombora","13930",!1,"15038")))),15093:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_onaudience","14954",!1,"15093"),an.itp("eyeota_experian","27992",!1,"15093")),an.itp("eyeota_pacificdatapartners","24360",!1,"15093")),an.itp("eyeota_plungedigital","32389",!1,"15093")),an.itp("eyeota_specialists","24931",!1,"15093")))),15095:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_netsprint","17752",!1,"15095"),an.itp("eyeota","1468",!1,"15095")),an.itp("eyeota","1471",!1,"15095")),an.itp("eyeota","1470",!1,"15095")),an.itp("eyeota","1469",!1,"15095")),an.itp("eyeota_specialists","24944",!1,"15095")),an.itp("eyeota_plungedigital","24611",!1,"15095")),an.itp("eyeota_netsprint","17804",!1,"15095")),an.itp("eyeota_onaudience","14971",!1,"15095")),an.itp("eyeota_plungedigital","32402",!1,"15095")),an.itp("eyeota_plungedigital","32404",!1,"15095")),an.itp("eyeota_netsprint","17856",!1,"15095")),an.itp("eyeota","1465",!1,"15095")),an.itp("eyeota_bombora","13835",!1,"15095")))),15112:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_meritdirect","23436",!1,"15112"),an.itp("eyeota_meritdirect","23582",!1,"15112")),an.itp("eyeota_bombora","13924",!1,"15112")),an.itp("eyeota","6548",!1,"15112")),an.itp("eyeota_alc","20293",!1,"15112")),an.itp("eyeota_pacificdatapartners","15265",!1,"15112")),an.itp("eyeota_pacificdatapartners","24050",!1,"15112")),an.itp("eyeota_netsprint","17315",!1,"15112")),an.itp("eyeota_meritdirect","19617",!1,"15112")),an.itp("eyeota_meritdirect","8649",!1,"15112")),an.itp("eyeota","35072",!1,"15112")),an.itp("eyeota","6548",!1,"15112")),an.itp("eyeota","6548",!1,"15112")),an.itp("eyeota","34866",!1,"15112")),an.itp("eyeota_netsprint","17315",!1,"15112")),an.itp("eyeota","253",!1,"15112")),an.itp("eyeota_meritdirect","19617",!1,"15112")),an.itp("eyeota_bombora","14055",!1,"15112")),an.itp("eyeota","253",!1,"15112")))),15113:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota","6558",!1,"15113"),an.itp("eyeota_dunbradstreet","20881",!1,"15113")),an.itp("eyeota_dunbradstreet","20933",!1,"15113")),an.itp("eyeota_alc","20414",!1,"15113")),an.itp("eyeota_meritdirect","23853",!1,"15113")))),15114:an.q(an.acq(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","21007",!1,"15114"),an.itp("eyeota_meritdirect","23587",!1,"15114")),an.itp("eyeota_bombora","14273",!1,"15114")),an.itp("eyeota","61",!1,"15114")),an.itp("eyeota_alc","20410",!1,"15114")),an.itp("eyeota_pacificdatapartners","24036",!1,"15114")),an.itp("eyeota_dunbradstreet","20699",!1,"15114")),an.itp("eyeota_dunbradstreet","20879",!1,"15114")),an.itp("eyeota_dunbradstreet","20856",!1,"15114")),an.itp("eyeota_dunbradstreet","20857",!1,"15114")),an.itp("eyeota_dunbradstreet","20698",!1,"15114")),an.itp("eyeota","6554",!1,"15114")),an.itp("eyeota","6553",!1,"15114")),an.itp("eyeota_alc","20512",!1,"15114")),an.itp("eyeota_alc","20424",!1,"15114")),an.itp("eyeota_alc","20425",!1,"15114")),an.itp("eyeota_bombora","14274",!1,"15114")),an.itp("eyeota_meritdirect","8713",!1,"15114")),an.itp("eyeota_dunbradstreet","21011",!1,"15114")),an.itp("eyeota_meritdirect","23978",!1,"15114")),an.itp("eyeota","6540",!1,"15114"))),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_meritdirect","23586",!1,"15114"),an.itp("eyeota_bombora","14009",!1,"15114")),an.itp("eyeota_alc","20387",!1,"15114")),an.itp("eyeota_dunbradstreet","20977",!1,"15114")),an.itp("eyeota_dunbradstreet","20971",!1,"15114")),an.itp("eyeota_specialists","25392",!1,"15114")),an.itp("eyeota_bombora","14007",!1,"15114")),an.itp("eyeota","6616",!1,"15114")),an.itp("eyeota_pacificdatapartners","24066",!1,"15114")))),15180:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.itp("eyeota_dunbradstreet","27975",!1,"15180"),an.itp("eyeota_bombora","13900",!1,"15180")))),15182:an.q(an.acq(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","21007",!1,"15182"),an.itp("eyeota_meritdirect","23587",!1,"15182")),an.itp("eyeota_bombora","14273",!1,"15182")),an.itp("eyeota","61",!1,"15182")),an.itp("eyeota_alc","20410",!1,"15182")),an.itp("eyeota_pacificdatapartners","24036",!1,"15182")),an.itp("eyeota_dunbradstreet","20699",!1,"15182")),an.itp("eyeota_dunbradstreet","20879",!1,"15182")),an.itp("eyeota_dunbradstreet","20856",!1,"15182")),an.itp("eyeota_dunbradstreet","20857",!1,"15182")),an.itp("eyeota_dunbradstreet","20698",!1,"15182")),an.itp("eyeota","6554",!1,"15182")),an.itp("eyeota","6553",!1,"15182")),an.itp("eyeota_alc","20512",!1,"15182")),an.itp("eyeota_alc","20424",!1,"15182")),an.itp("eyeota_alc","20425",!1,"15182")),an.itp("eyeota_bombora","14274",!1,"15182")),an.itp("eyeota_meritdirect","8713",!1,"15182")),an.itp("eyeota_dunbradstreet","21011",!1,"15182")),an.itp("eyeota_meritdirect","23978",!1,"15182")),an.itp("eyeota","6540",!1,"15182"))),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","20917",!1,"15182"),an.itp("eyeota_dunbradstreet","20773",!1,"15182")),an.itp("eyeota_meritdirect","23473",!1,"15182")),an.itp("eyeota_bombora","13832",!1,"15182")),an.itp("eyeota","6634",!1,"15182")),an.itp("eyeota_alc","20306",!1,"15182")),an.itp("eyeota_pacificdatapartners","15282",!1,"15182")),an.itp("eyeota_specialists","25228",!1,"15182")))),15189:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","20904",!1,"15189"),an.itp("eyeota_bombora","13926",!1,"15189")),an.itp("eyeota_pacificdatapartners","24052",!1,"15189")),an.itp("eyeota_alc","20291",!1,"15189")))),15195:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","20757",!1,"15195"),an.itp("eyeota_bombora","13831",!1,"15195")),an.itp("eyeota_sharethis","15737",!1,"15195")))),15196:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.itp("eyeota_dunbradstreet","20901",!1,"15196"),an.itp("eyeota_meritdirect","23948",!1,"15196")),an.itp("eyeota_dunbradstreet","20890",!1,"15196")))),15398:an.q(an.cw("SlotClicked",an.pe(["campaign_id"],2517966421),an.ge(1))),15399:an.q(an.cw("SlotClicked",an.pe(["campaign_id"],2528504827),an.ge(1))),16669:an.q(an.cw("Pageview",an.t,an.ge(1))),16932:an.q(an.cw("SlotClicked",an.pe(["campaign_id"],2518635975),an.ge(1))),16957:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","13867",!1,"16957"),an.itp("eyeota_bombora","14276",!1,"16957")),an.itp("eyeota_onaudience","15092",!1,"16957")),an.itp("eyeota_skimlinks","7516",!1,"16957")),an.itp("eyeota_dataxpand","14736",!1,"16957")))),16965:an.q(an.cw("Pageview",an.ps(["client","url"],"events.economist.com/events-conferences/emea/feeding-the-future"),an.ge(1))),17099:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","13899",!1,"17099"),an.itp("eyeota","6533",!1,"17099")),an.itp("eyeota_dunbradstreet","20701",!1,"17099")),an.itp("eyeota_dunbradstreet","20889",!1,"17099")),an.itp("eyeota_dunbradstreet","20878",!1,"17099")),an.itp("eyeota_meritdirect","23589",!1,"17099")),an.itp("eyeota_meritdirect","23589",!1,"17099")),an.itp("eyeota_meritdirect","23848",!1,"17099")),an.itp("eyeota","6565",!1,"17099")),an.itp("eyeota_alc","20412",!1,"17099")),an.itp("eyeota_specialists","25215",!1,"17099")))),17100:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota","6534",!1,"17100"),an.itp("eyeota_sharethis","27036",!1,"17100")),an.itp("eyeota_sharethis","15942",!1,"17100")),an.itp("eyeota_dunbradstreet","20765",!1,"17100")),an.itp("eyeota_meritdirect","10050",!1,"17100")),an.itp("eyeota_meritdirect","19628",!1,"17100")),an.itp("eyeota_meritdirect","10750",!1,"17100")),an.itp("eyeota_meritdirect","10050",!1,"17100")),an.itp("eyeota_sharethis","27037",!1,"17100")),an.itp("eyeota_meritdirect","13646",!1,"17100")),an.itp("eyeota_meritdirect","10750",!1,"17100")),an.itp("eyeota_meritdirect","23611",!1,"17100")),an.itp("eyeota_meritdirect","10785",!1,"17100")),an.itp("eyeota_meritdirect","19663",!1,"17100")),an.itp("eyeota_bombora","14059",!1,"17100")),an.itp("eyeota_bombora","13927",!1,"17100")),an.itp("eyeota_sharethis","15943",!1,"17100")),an.itp("eyeota_sharethis","27037",!1,"17100")),an.itp("eyeota","6586",!1,"17100")),an.itp("eyeota","6633",!1,"17100")),an.itp("eyeota_sharethis","27043",!1,"17100")),an.itp("eyeota_sharethis","15949",!1,"17100")),an.itp("eyeota","34876",!1,"17100")))),17126:an.q(an.cw("SlotClicked",an.pe(["campaign_id"],2468568148),an.ge(1))),17131:an.q(an.cw("Pageview",an.ps(["client","url"],"theexperienceofwork.economist.com"),an.ge(1))),18119:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_amberdata","18362",!1,"18119"),an.itp("eyeota_sharethis","27769",!1,"18119")),an.itp("eyeota_onaudience","15014",!1,"18119")),an.itp("eyeota_skimlinks","7677",!1,"18119")),an.itp("eyeota","13439",!1,"18119")),an.itp("eyeota","1543",!1,"18119")),an.itp("eyeota_experian","22961",!1,"18119")),an.itp("eyeota_rdaresearch","36288",!1,"18119")),an.itp("eyeota_dataxpand","14570",!1,"18119")),an.itp("eyeota_kantarmedia","19285",!1,"18119")))),19963:an.q(an.cw("Pageview",an.ps(["client","url"],"datacapital.economist.com"),an.ge(1))),20426:an.q(an.cw("SlotClicked",an.pe(["campaign_id"],2582967779),an.ge(1))),21008:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota","35119",!1,"21008"),an.itp("eyeota_meritdirect","23979",!1,"21008")),an.itp("eyeota","6619",!1,"21008")),an.itp("eyeota_meritdirect","23652",!1,"21008")),an.itp("eyeota_specialists","25213",!1,"21008")))),21011:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.itp("eyeota_dunbradstreet","21055",!1,"21011"),an.itp("eyeota","35239",!1,"21011")))),21278:an.q(an.cw("Pageview",an.ps(["client","url"],"woi.economist.com/"),an.ge(1))),22361:an.q(an.ocq(an.lm("d1df0151-d699-4032-a0a2-56ed3ca80a39",an.ge(.6678756)),an.ifp("19963"))),23092:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.itp("eyeota","35520",!1,"23092"),an.itp("eyeota_experian","21564",!1,"23092")),an.itp("eyeota_pacificdatapartners","24270",!1,"23092")))),25025:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["business","economics","finance"])]),an.ge(3)),2592e6)),25185:an.q(an.ocq(an.lm("82632fb7-bf2b-4302-bd2e-be68b81d65a2",an.ge(.6742097)),an.ifp("17131"))),25856:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["yacht","luxury","wealth","privatejet"])]),an.ge(1)),2592e6)),26625:an.q(an.acq(an.tw(an.cw("Pageview",an.t,an.ge(1)),7776e6),an.ocq(an.ocq(an.itp("eyeota_onaudience","15116",!1,"26625"),an.itp("eyeota_experian","30281",!1,"26625")),an.itp("eyeota_pacificdatapartners","15270",!1,"26625")))),26869:an.q(an.cw("Pageview",an.ps(["client","domain"],"theexperienceofwork.economist.com"),an.ge(1))),28017:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/asia"),an.ge(2)),2592e6)),28018:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/books-and-arts"),an.ge(2)),2592e6)),28021:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/briefing"),an.ge(2)),2592e6)),28023:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/britain"),an.ge(2)),2592e6)),28025:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/business"),an.ge(2)),2592e6)),28026:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/china"),an.ge(2)),2592e6)),28030:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/europe"),an.ge(2)),2592e6)),28035:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/finance-and-economics"),an.ge(2)),2592e6)),28052:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/graphic-detail"),an.ge(2)),2592e6)),28053:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/international"),an.ge(2)),2592e6)),28054:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/leaders"),an.ge(2)),2592e6)),28055:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/middle-east-and-africa"),an.ge(2)),2592e6)),28056:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/obituary"),an.ge(2)),2592e6)),28057:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/science-and-technology"),an.ge(2)),2592e6)),28058:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["/special-reports","/special-report"])]),an.ge(2)),2592e6)),28059:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/technology-quarterly"),an.ge(2)),2592e6)),28060:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/the-americas"),an.ge(2)),2592e6)),28061:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/united-states"),an.ge(2)),2592e6)),28071:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["5G","mobile","network","next generation","huawei","samsung","o2","apple","cellular","cellular network","5g technology"])]),an.ge(2)),2592e6)),28073:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["cloud services","drive","saas","creative cloud","samsung","apple","icloud","cloud storage","business cloud","dropbox","online storage","cloud backup","backup","amazon cloud","amazon","saas application","cloud drive","cloud hosting"])]),an.ge(2)),2592e6)),28076:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["data storage","online storage","file storage","backup storage","encrypted","encrypted storage","enterprise storage","cloud backup","data cloud","data","cloud","remote storage","big data","data companies","data archive","secure data","secure storage","amazon storage"])]),an.ge(2)),2592e6)),28077:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["productivity","software","business tools","creative cloud","software suite","microsoft","adobe","tableau","IBM","dell"])]),an.ge(2)),2592e6)),28078:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["digitalization","organization","digital change","change","transformation","services","telecommunication","digitalisation"])]),an.ge(2)),2592e6)),28079:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["cyber security","threats","information security","computer security","cyber intelligence","cyber","intelligence","security expert","cyber business","cyber security business","government security","national cyber secuity","iot","ai security","cyber-security","information-security","cyber-intelligence","cyber-security-business","government-security","national-cyber-security"])]),an.ge(2)),2592e6)),28081:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["investment banking","share price","shares","options","future","funds","index","money","currency","goldman sachs","jp morgan","citi","credit suisse","morgan stanley","standard poor","investment-banking","share-price","goldman-sachs","credit-suisse","hsbc","morgan-stanley"])]),an.ge(2)),2592e6)),28083:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["asset management","assets","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive management","asset-management","index-fund","financial-market","fixed-income","passive-management","active-management"])]),an.ge(2)),2592e6)),28084:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["wealth management","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive management","wealth-management","mutual-funds","index-funds","exchange-traded-funds","passive-management","fixed-income","active-management"])]),an.ge(2)),2592e6)),29752:an.q(an.tw(an.cw("LinkClick",an.ps(["dest_url"],"subscription.economist.com"),an.ge(1)),2592e6)),29753:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["events.economist.com/events-conferences/emea/third-youth-summit","events.economist.com/events-conferences/emea/fifth-agricultural-business-summit","events.economist.com/events-conferences/emea/sustainability-summit-london"])]),an.ge(1)),2592e6)),30007:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["hedge fund","hedging","leverage","trading","traders","securities","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive management","hedge-fund","index-fund"])]),an.ge(2)),2592e6)),30008:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["hedge fund","hedging","leverage","securities","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive managemen","wealth management","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive management","asset management","assets","bonds","credit","funds","equity","mutual funds","index funds","stockmarket","etf","exchange traded funds","portfolio","index funds","capital","stocks","shares","financial market","currency","currencies","fixed income","investment","active management","passive management"])]),an.ge(2)),2592e6)),30009:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["insurance","business insurance","life insurance","multi cover"])]),an.ge(2)),2592e6)),30011:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["advisory","government","petitions","hmrc","monetary policy","policy","cabinet office","public service","labour","budget deficit","cabinet","ministers","international trade","foreign policy","constitutional monarchy","prime minister","local government","local council","policy exchange","government office","elections","cabinet secretary","federal government"])]),an.ge(2)),2592e6)),30013:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["bezos","gates","buffett","arnault","ortega","ellison","zuckerberg","entrepreneur","innovation","international","businessman","entrepreneurship"])]),an.ge(2)),2592e6)),30015:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["change management","workplace","management process","change","process","policy control","change policy","project management","advisory board","business process"])]),an.ge(2)),2592e6)),30017:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["human resources","hr","talent aquisition","global talent"])]),an.ge(2)),2592e6)),30019:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["sustainability","environmental","eco friendly","green business","green society","sustainability policy","green architecture"])]),an.ge(2)),2592e6)),30021:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["electric car","tesla","model 3","etron","audi","bmw","mercedes","car manufacturer","hybrid car","car-manufacturer","hybrid-car","electric-car"])]),an.ge(2)),2592e6)),30031:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["innovation","R&D","research","development","technology","future","innovation","next-generation","disruptive-technology","disruptive-innovation","open-innovation","business-innovation","innovation-management","innovation-lab","radical-innovation","global-innovation-index","technological-innovation"])]),an.ge(2)),2592e6)),30032:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["climate change","carbon","carbon neutral","energy saving","green movement","climate-change","carbon-neutral","carbon-neutral","climate-change","global-warming","climate-change-news","climate-change-facts","effects-of-global-warming","effects-of-climate-change","greta-thunberg","global-warming-facts","ipcc-report","impacts-of-climate-change","climate-change-solutions","climate-action","climate-news","climate-debate","climate"])]),an.ge(2)),2592e6)),31968:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["corona","covid-19","pandemic","virus","epidemic"])]),an.ge(2)),2592e6)),31969:an.q(an.ocq(an.tw(an.cw("Pageview",an.ps(["client","url"],"economist.com/coronavirus"),an.ge(1)),2592e6),an.tw(an.cw("Pageview",an.ps(["client","url"],"/the-economists-coverage-of-the-coronavirus"),an.ge(1)),2592e6))),31970:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"eiu.com/n/novel-coronavirus-outbreak"),an.ge(1)),2592e6)),32616:an.q(an.cw("Pageview",an.ps(["client","url"],"connectedcompanies.economist.com"),an.ge(1))),32990:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["high-net-worth","highest-net-worth","hnwi","uhnw","high-net-worth-individuals","ultra-high-net-worth","high-networth-individuals","ultra-high-net-worth-individuals","yacht","luxury-items","luxury-watch","luxury-goods","private-jet","private-yacht","luxury-villa","luxury-holiday","luxury","luxury goods","luxury-jewellery","high-jewellery"])]),an.ge(2)),2592e6)),32993:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["high-jewelry","luxury-jewelry","jewelry","gold-jewellery","silver-jewellery","wedding-jewellery","antique-jewellery","designer-jewellery","diamond-jewellery","jewellery"])]),an.ge(2)),2592e6)),32994:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["patek","rolex","luxury-watches","audemars","rolex-submariner","rolex-daytona","rolex-datejust","ap-watch","cartier-watch","hublot-watches","rolex-oyster-perpetual","patek-philippe-nautilus","audemars-piguet-royal-oak","montblanc-watches","chopard-watch","rolex-gmt","rolex-price","bvlgari-watch","submariner","patek-philippe-aquanaut","louis-vuitton-watch","pre-owned-watches","audemars-piguet","royal-oak","patek-philippe","louis-vuitton","gmt"])]),an.ge(2)),2592e6)),32999:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["luxury-travel","luxury-accommodation","luxury-hotel","luxury-lodges","hotel-de-paris","country-house-hotels","luxury-holiday-destinations","travel","luxury"])]),an.ge(2)),2592e6)),33e3:an.q(an.tw(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["luxury-goods","luxury-handbags","luxury-wallet","louis-vuitton","ysl","designer-bags","hermes","burberry","luxury-items","luxury-products"])]),an.ge(2)),2592e6)),33735:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.ocq(an.ocq(an.ocq(an.ocq(an.itp("eyeota_bombora","14315",!1,"33735"),an.itp("eyeota_stirista","26068",!1,"33735")),an.itp("eyeota","35507",!1,"33735")),an.itp("eyeota_experian","21546",!1,"33735")),an.itp("eyeota_pacificdatapartners","24259",!1,"33735")))),35792:an.q(an.acq(an.cw("Pageview",an.t,an.ge(1)),an.itp("eyeota_experian","21695",!1,"35792"))),36063:an.q(an.cw("Pageview",an.o([an.os(an.s,["client","url"],["events.economist.com/events-conferences/emea/21st-century-company","events-conferences/emea/21st-century-company"])]),an.ge(1))),38976:an.q(an.ocq(an.lm("9838e90c-c5d6-4c22-9f35-3e19e20fe1f5",an.ge(.6661452)),an.ifp("36063"))),47552:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"economist.com/1843"),an.ge(2)),2592e6)),48930:an.q(an.cw("Pageview",an.ps(["client","domain"],"economist.com/HSBC"),an.ge(1))),52427:an.q(an.tw(an.cw("Pageview",an.ps(["client","url"],"/us-election-2020"),an.ge(1)),2592e6))}||{};var an;let on={getCurrentTime:()=>new Date,getCurrentSession:()=>"",getCurrentView:()=>"",getSegments:()=>({}),getLookalikeModels:()=>({}),setSegmentActivation:()=>{}};yt()((function(e){switch(e.type){case"bootstrap":return cn(e.stateMap,...e.payload);case"updateEnvironment":return un(e.stateMap,...e.payload);case"process":return sn(e.stateMap,...e.payload);case"migrate":return pn(...e.payload)}}));const cn=(e,t,n,r,i)=>{on={getCurrentTime:()=>new Date,getCurrentSession:()=>r.sessionId,getCurrentView:()=>r.viewId,getSegments:()=>r.segments,getLookalikeModels:()=>r.lookalikeModels,setSegmentActivation:(e,t)=>{}};const a=nn(t,(t,[n,r,i])=>{var a;return(null===(a=e[t])||void 0===a?void 0:a.checksum)===n?ue:se({checksum:n,is_segment:r.indexOf("s")>-1,id:i,state:null,result:rn[t].interpret(null,on),activations:{}})}),o=sn(a,n,i);return{stateMap:Object.assign(Object.assign({},e),o.stateMap),errors:o.errors}},un=(e,t,n,r=!0)=>{const i=n.segments?on.getSegments():{};return on=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},on),n.viewId?{getCurrentView:()=>n.viewId}:{}),n.sessionId?{getCurrentSession:()=>n.sessionId}:{}),n.lookalikeModels?{getLookalikeModels:()=>n.lookalikeModels}:{}),n.segments?{getSegments:()=>Object.assign(Object.assign({},i),n.segments),setSegmentActivation:dn(e)}:{}),r?ln(e,t,{}):{stateMap:e,errors:[]}},sn=(e,t,n)=>n.reduce(({stateMap:e,errors:n},r)=>{const i=ln(e,t,r);return{stateMap:i.stateMap,errors:n.concat(i.errors)}},{stateMap:e,errors:[]}),ln=(e,t,n)=>{const r=F,i=(e=>e.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:!0}),{}))((e=>Object.entries(e).filter(([e,t])=>{var n;return!0===(null===(n=t.result)||void 0===n?void 0:n.result)}).map(([e,t])=>parseInt(e,10)))(e)),a=un(e,t,{segments:{"1p":i}},!1),c=a.stateMap,u=a.errors,p=nn(c,(e,i)=>{return ct(s(()=>((e,i)=>{const a=rn[e],o=a.lift(n,on),c=ct(st(i.state),l(r)),u=ct(st(o),l(r),e=>tn(c,e)),s=tn(u,t[e]?ct(st(t[e]),l(r)):r());return Object.assign(Object.assign({},i),{state:ut(u),result:a.interpret(ut(s),on)})})(e,i),t=>`Failed to interpret query ${e}. Got ${t}`),(a=e=>({errors:[e],queryState:i}),c=e=>({errors:[],queryState:e}),function(e){return o(e)?a(e.left):c(e.right)}),se);var a,c}),{queryState:d,errors:f}=Object.entries(p).reduce((e,[t,{errors:n,queryState:r}])=>({errors:e.errors.concat(n),queryState:Object.assign(Object.assign({},e.queryState),{[t]:r})}),{errors:[],queryState:{}});return{stateMap:d,errors:f.concat(u)}},pn=(e,t)=>({stateMap:nn(t,(t,n)=>{var r;const i=rn[t],a=s(()=>i.migrate(n.state),e=>String(e)),o=ct(a,l(e=>null));return o&&(null===(r=null==e?void 0:e[t])||void 0===r?void 0:r[0])===n.checksum?se(Object.assign(Object.assign({},n),{state:o})):ue}),errors:[]}),dn=e=>(t,n,r)=>{var a;return ct(null===(a=e[r])||void 0===a?void 0:a.activations,e=>i(t in e,e),([e,r])=>r[t]=e?rt(St)(r[t],[n]):[n])}}]);',"Worker",void 0,void 0)},o=n(3),c=n(25),u=n.n(c),d=n(7),l=n(11),f=n(14),_=n(2),p=n(17),g=n(6),h=n(13),m=n(0),b=n(5);class v{constructor(e,t){this._internals=e,this.permutive=t,this.CACHED_SEGMENTS_STORAGE_KEY="_psegs",this.queryMetadata={12928:["0c8b70cdb7",["s"],"75969967-1621-4e83-bb8b-cbe593f50a86"],12999:["965de69a9e",["s"],"4fbcfac7-d62f-425c-a532-94fd4818b443"],13286:["0c8b70cdb7",["s"],"9e8ba6d0-07d0-469b-b130-85231341a823"],14253:["88da16800c",["s"],"3e9181ec-d5fb-476d-b26e-9ce54b2eaa5b"],14257:["d85b31e50f",["s"],"f2cf08c0-0a4a-4b1c-b954-373ea3bda15a"],14279:["4a075229f3",["s"],"5bbeddf0-8b60-414f-ac12-95184485fb9c"],14722:["2bd4a90147",["s"],"7b9d18a0-9955-4468-986f-42be58be972e"],14723:["bc911e5329",["s"],"4fd68d56-612a-423a-875e-a56a2efb7b12"],14726:["819f05fa83",["s"],"6c7d30e0-580c-4eb9-94a8-4c3e7e9bbe04"],14728:["43ee302ba6",["s"],"2ad16b81-c48c-4c33-b7c8-7141feddbccc"],14736:["82558a7a9d",["s"],"603e107c-6531-46d8-8288-2f2135f3c72d"],14737:["0b08d48f85",["s"],"65e4d9da-35cf-464d-8ea9-55b9f12d2ab9"],14738:["0eb5d83a9b",["s"],"6fe8e1e8-515a-4e87-aa77-fceedd6109c4"],14746:["99273a0b79",["s"],"8c3fa965-ead3-4264-b09a-19e65e583d34"],14747:["1c165ec6f5",["s"],"86f069cc-27f2-4fdf-826a-73b4dee700ee"],14749:["543010414c",["s"],"078a427c-6483-4fc5-a713-16888b8f1d2b"],14750:["13b1f9a86e",["s"],"83140cbc-5e4e-4cad-9834-88da5871e063"],14751:["09cd78a58e",["s"],"bed8af64-91f4-45e4-a28d-14bde08e7f4c"],14759:["4ac013f623",["s"],"038ff5fb-ca6e-43f9-bb85-4a02667c3a6a"],14760:["9f0ec9d0eb",["s"],"a5de9420-7e76-4213-aa10-ac04ff26e227"],14790:["8383fb48c0",["s"],"4af378df-3642-4197-aaf3-2852b87767dc"],14793:["11f9c73bd1",["s"],"f07dda5c-d319-4aba-a3c1-2b41d95fcf4f"],14795:["e0404845f2",["s"],"c3333e23-79a0-4842-a012-5fc45c3af860"],15e3:["388b0e624e",["s"],"8ed432a1-7765-4285-ba47-c4750f3d80dc"],15038:["3716842ad5",["s"],"aee4dffa-8ce8-446c-9ec9-3c4c1e2089b6"],15093:["45ae1c30fd",["s"],"443e6f49-3dbb-432d-8376-86a520c1fbd1"],15095:["4527fbeefd",["s"],"f0f1a8b5-0be0-4a1f-8a9c-a5ff236a75fb"],15112:["bb6964ce9b",["s"],"2bab2e94-ea74-46f1-a4bb-afd674548ac3"],15113:["e6901335e7",["s"],"b4a93046-57a0-4a60-b55e-8e7eec45d4a0"],15114:["4b2b1df1c6",["s"],"ff160077-b6d5-47a7-8b79-75132da44502"],15180:["0a5c1a3917",["s"],"40d0aa3c-d8e2-48eb-bd82-c88981a0ffc3"],15182:["a915131db9",["s"],"486db105-562b-4f9c-af71-e80d26aac95f"],15189:["97a19561de",["s"],"ee93a5e8-1225-405f-acd1-36ee77cefe8c"],15195:["6b54584bff",["s"],"0a0f3f7f-10ba-4554-ad61-757a7d6c4b4f"],15196:["beaeac55af",["s"],"66780774-4622-4984-9a01-b2a1b24c2597"],15398:["a50278e92b",["s"],"79d4870b-1b00-4339-8b30-a0022237e29c"],15399:["ba4090489f",["s"],"e00f19bf-125b-48e8-a1f9-8a53a173666c"],16669:["0c8b70cdb7",["s"],"4e7a243e-4e00-4796-b8f3-1076334f46d5"],16932:["11ec6a4f9a",["s"],"a67e7118-5223-4526-bc16-917875204851"],16957:["3381b1c79d",["s"],"d9fc765e-0bb4-46d1-a9fe-c0fdbf2ec42c"],16965:["a57ede4220",["s"],"e5666b65-408c-4b99-87a2-fdcc5b1d598d"],17099:["604db55219",["s"],"ee07160d-e396-4e7b-a7fd-a560ea373782"],17100:["ff03de7f12",["s"],"6648b66d-bd51-4a92-822a-4a8be64362a4"],17126:["828ce6e263",["s"],"675a96a6-35ad-4698-b8dc-5131922e5dab"],17131:["5c6885fe27",["s"],"0a917306-e73a-4088-85dd-29594d44c192"],18119:["420b870ade",["s"],"61ad5270-c8c9-4447-bbba-2600e0719cb9"],19963:["c803c98a79",["s"],"a888750e-4d3d-4a8e-852c-9d23c16591b8"],20426:["ba78d8c3cf",["s"],"17318b58-2d05-4fb2-a946-4336b77e3fd1"],21008:["236a663fc3",["s"],"dbf56fb6-d00e-48d0-9a35-624deebce8c6"],21011:["9dc6d30298",["s"],"4336a439-ca9c-4b4f-8621-a8e71bd12e46"],21278:["1c653cbe32",["s"],"fdd6e9de-cb0d-409a-adaa-b86289fe590f"],22361:["ce08bd1be1",["l","s"],"48f61c53-ac42-4895-9767-f8eb17655cb1"],23092:["3cacafa1ab",["s"],"ccb59ddd-8483-42b5-86c2-c059383b7d3d"],25025:["5a9037cc00",["s"],"5be0773e-ab72-4b92-968c-c08ebdbbba2c"],25185:["39793f6f4e",["l","s"],"3f7927bb-6b69-4575-8341-9f661e7cc589"],25856:["4443c28909",["s"],"7b17bde0-d788-4096-8750-3f9ffcd14332"],26625:["b66ec6eae2",["s"],"145860cf-3128-4d46-b689-a0c383196a13"],26869:["cfd1deb46a",["s"],"e3e223a5-52b8-4832-b470-7ac719c21850"],28017:["72896350f4",["s"],"91354bcd-a01a-4b92-aa12-2af55b8423c3"],28018:["83ac79e709",["s"],"ad082d67-94c7-45c0-80bd-9ddbeb3798ce"],28021:["b65bff0129",["s"],"98d81a55-d6be-4e97-bf77-ee474a0093ee"],28023:["4f0e627c69",["s"],"8936d6e7-9c75-43c6-bd76-c083026f174e"],28025:["16939a6960",["s"],"88f6ed76-ee03-4a2d-a5df-6553944be78e"],28026:["532394c12f",["s"],"5eee0ba2-822f-4311-8753-600728cd3565"],28030:["cf023f8e29",["s"],"98f7cf14-b377-4ec3-ab6f-beab1bcdc69f"],28035:["5e25c6e2f0",["s"],"2d7fa358-a5bd-4c26-8921-d00151553420"],28052:["02f3f518bb",["s"],"b9332de0-7262-454d-84f9-ee305b403b79"],28053:["5c64211b38",["s"],"b6be5f7c-bf2e-47fe-80d1-af2cb0c226f4"],28054:["d4115aa1cf",["s"],"8f6b2008-8417-4887-b243-ca011807ba15"],28055:["164e2c95ea",["s"],"ee66ad7c-d05e-4002-93d6-b05b727a9a30"],28056:["42d1198b08",["s"],"b1bfcbf3-4022-4f7f-aeed-600bbdf8100f"],28057:["7142767b39",["s"],"d41f23da-bfb4-4209-a436-65223fb237a6"],28058:["5b96c90bfb",["s"],"da65d26e-73a8-41f2-b798-e1669e8d6e9a"],28059:["e5590276e5",["s"],"f2334c5d-19aa-44ea-9027-8a391f50b4f0"],28060:["ed7a17b063",["s"],"9fee7181-92ed-4d46-b170-20979a2fd3c7"],28061:["f082380b0b",["s"],"8d28dfe7-9f3f-4b32-a130-b24f368fb1d4"],28071:["3c945cf0f6",["s"],"14aab199-fb50-46a8-b313-805e4cdffd64"],28073:["9ec5799058",["s"],"7562d341-04b5-4cfd-b0b8-45e5a93d25c4"],28076:["d6c0b57155",["s"],"e5798f0b-1cab-4086-826b-34df8ca9dfc8"],28077:["f58a986eb4",["s"],"044fdf33-c69c-4a6b-aab6-e21d1927d5da"],28078:["8e24bbfd40",["s"],"4e8f3d11-bce8-4e82-9bf3-bc2105c3ae2a"],28079:["9349ed6e8f",["s"],"def37294-a871-4d0c-9489-90ab0f910eed"],28081:["7325ccdc82",["s"],"5f1b9178-a480-4912-9d19-2529aad9befc"],28083:["31b1d86a14",["s"],"a303b09c-c92b-4b4a-a935-87b394b5c125"],28084:["32b6f309f0",["s"],"60f0fe13-4af1-4f84-890c-e58a64714215"],29752:["4e450012c5",["s"],"6aa52c00-db4a-4d89-9898-8bfc1f4ab7db"],29753:["bda0fdad24",["s"],"bd11281b-6e01-4890-a46b-430282a27fbb"],30007:["4b4343ff15",["s"],"b5d091da-c57d-4401-9e4f-50f9cd563788"],30008:["b29020c450",["s"],"93cc11e9-09b4-473e-81da-e82e01ede895"],30009:["213d45e630",["s"],"e832e242-aa5c-4410-bc35-a446949aaea2"],30011:["aaf885e7e2",["s"],"0354111e-3787-49ce-861d-26d9f91be608"],30013:["9754110039",["s"],"c0e04215-91bb-40d5-b038-fa6b55761345"],30015:["2a4dd8b9ae",["s"],"4507a481-2d81-4cc6-8f32-872064431601"],30017:["739eee2a73",["s"],"c50bcbe9-403f-4061-855f-85e09e9cb578"],30019:["8c7bd73611",["s"],"6159f3a4-1627-49e4-93cf-347b9aa09bf2"],30021:["14412e721b",["s"],"5d3e59cc-8fc6-4b5f-b392-eb40bff0a966"],30031:["7e859179c1",["s"],"88cbc3a4-9937-4d58-8d4e-14cb228d05b9"],30032:["9a441fe2c8",["s"],"18e9e3f1-d0d4-45b9-970d-42fe69c66f85"],31968:["fe55b0f22e",["s"],"1a1be1ac-3d7a-4b97-9ef4-8fd3ee468456"],31969:["0cf2763e2b",["s"],"3be01087-e2cd-47a7-9345-70e04bc32913"],31970:["c5d936ee79",["s"],"ec1a56f0-4c0d-4bc1-8ced-7d406765f65b"],32616:["35e10ee32c",["s"],"3ebfc74f-81eb-4c22-b82f-975a7d223e75"],32990:["bd98020d6a",["s"],"030aba86-a754-43da-9119-7c8c413b8210"],32993:["43522e8be3",["s"],"2e753fdf-41a3-439a-a94c-fa252889dd75"],32994:["6793d85119",["s"],"2d261e7c-8fcb-4c87-a1d8-b41a3a674fd8"],32999:["43d1ae0883",["s"],"197accc2-2d43-421d-94e2-56688c104004"],33e3:["00c92e0305",["s"],"ac2c68c8-dacc-441d-8c07-70788e43e85b"],33735:["05f6abe468",["s"],"2f0ad1bd-2eab-4e60-9467-6044d41a4628"],35792:["3cd7836fd5",["s"],"28dfb2db-5243-4338-910a-b74a4fadbd84"],36063:["0caf9de9f7",["s"],"9bc95a3f-90ea-42bf-ab57-089df2eb7c90"],38976:["04df5f3143",["l","s"],"23ebe8ba-5d07-430b-8e22-484fa5f09a36"],47552:["e181a5b7c3",["s"],"26a1902e-e5b7-4ba3-a621-bd173c4342c3"],48930:["64eb6bac25",["s"],"8e35fab8-bc46-4ed1-9efe-e44ee448da70"],52427:["39e70e34ff",["s"],"90e0ba95-e3bf-4171-a5c2-b01dd7b0482c"]},this.isWorkerReady=!1,this.extStateMap={},this.userSegments=[],this.userSegmentsMap={},this.segmentTransitionEdgeOnly=!0,this.segmentEntryQueryCodes=new Set,this.segmentExitQueryCodes=new Set;const n=this._internals.getExternalData(this.CACHED_SEGMENTS_STORAGE_KEY);this.userSegments=(JSON.parse(n)||[]).filter(e=>Object(h.c)(e,this.queryMetadata)),this.userSegmentsMap=Object(h.e)(this.userSegments);const i=this._internals.state.getPermutiveData("internal_query_states")||{},a=this._internals.state.getPermutiveData("external_query_states")||{},o=Object(r.d)(i,e=>{var t;return Object(h.c)(e,this.queryMetadata)&&(null===(t=i[e])||void 0===t?void 0:t.checksum)===this.queryMetadata[e][0]});this.extStateMap=Object(r.d)(a,e=>Object(h.c)(e,this.queryMetadata)),this._internals.state.setPermutiveData("external_query_states",this.extStateMap),this.stateMap={value:o,promise:Promise.resolve(o)},this.worker=new u.a(new s)}bootstrap(e){return this.migrateIfRequired(e).then(([e,t,n])=>this.postMessage({type:"bootstrap",payload:[this.queryMetadata,this.extStateMap,{segments:Object.assign({"1p":this.userSegmentsMap},t),sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:n},e]}))}updateEnvironment(e){return this.postMessage({type:"updateEnvironment",payload:[this.extStateMap,e]})}process(e){return this.postMessage({type:"process",payload:[this.extStateMap,e]})}updateExternalState(e){const t=Object(r.i)(e,(e,t)=>{const n=this.queryMetadata[e][0];return t[n]?Object(m.b)(Object(f.a)(t[n])):m.m}),n=Object(r.i)(this.extStateMap,(e,t)=>Object(m.b)(Object(f.a)(t))),i=Object(r.i)(Object.assign(Object.assign({},n),t),(e,t)=>n[e]?Object(m.n)(Object(f.b)(Object(p.b)(t,n[e]))):Object(m.n)(Object(f.b)(t)));this._internals.state.setPermutiveData("external_query_states",i),this.extStateMap=i}postMessage(e){return this.stateMap.promise=this.stateMap.promise.then(t=>this.worker.postMessage(Object.assign(Object.assign({},e),{stateMap:t}))).then(({stateMap:e,errors:t})=>this.onStateChange(e,t)).catch(e=>(this._internals.network.error("Error during query execution. Got "+e,this._internals.state.userId),this.stateMap.value))}onStateChange(e,t){return Object(g.a)(t.length>0?this._internals.network.error("QL error(s). Got "+t.join("; "),this._internals.state.userId):{},t=>this.stateMap.value=e,e=>this.isWorkerReady?this.onStateChangeReady(e):e)}onStateChangeReady(e){const t=Object(h.d)(e),n=[...Object(d.c)(l.c)(t,this.userSegments).map(t=>[t,!0,e[t].id]),...Object(d.c)(l.c)(this.userSegments,t).map(t=>[t,!1,e[t].id])];return this.userSegments=t,this.userSegmentsMap=Object(h.e)(t),this._internals.log("Writing new segment and query state cache",e),this._internals.setExternalData(this.CACHED_SEGMENTS_STORAGE_KEY,JSON.stringify(this.userSegments)),this._internals.state.setPermutiveData("internal_query_states",e),n.forEach(([e,t,n])=>{this.trackTransition(t,n,e),this._internals.messages.emit("permutive:query:changed",{queryCode:e,result:{result:t}})}),Object(g.a)(n.length>0,e=>e?this._internals.messages.emit("permutive:segments:updated"):{},t=>e)}migrateIfRequired(e){const t=this._internals.state.getPermutiveData("query_states"),n=()=>this.worker.postMessage({type:"migrate",payload:[this.queryMetadata,Object(r.d)(t,e=>Object(h.c)(e,this.queryMetadata))],stateMap:{}}).then(n=>this.onStateMigrateSuccess(t,e,n.stateMap)).catch(t=>this.onStateMigrateError(e,t)),i=()=>this._internals.api.migrateOutOfSDKEvents(this._internals.state.userId,e.map(e=>e.id).filter(e=>e)).catch(e=>this._internals.network.error("Error migrating out-of-SDK events. Got "+String(e),this._internals.state.userId));return t?(()=>Promise.all([this._internals.thirdParty.segments(),this._internals.models.getModels(),n(),i()]).then(([e,t,n,r])=>Object(b.g)(n,e,t)))():Promise.resolve([e,{},{}])}onStateMigrateSuccess(e,t,n){this._internals.log("Beginning migration. Migrated query state is",n);const i=Object(h.a)(t,100);return(n=>this.worker.postMessage({type:"bootstrap",payload:[this.queryMetadata,{},{segments:{"1p":this.userSegmentsMap},sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:{}},i],stateMap:{}}).then(i=>{const a=i.stateMap;this._internals.log("Recreated state via events cache. Got",a);const s=e=>Object(g.a)(Object(r.i)(e,(e,t)=>t.state?Object(m.n)(t.state):m.m),f.a,Object(o.j)(e=>(this._internals.network.error("Failed to decode state. Got "+e,this._internals.state.userId),Object(_.l)(new Map)))),c=s(a),u=s(n),d=Object(g.a)(Object(o.t)(()=>Object(p.b)(u,c),e=>"Failed to join migrated state and state recreated via the events cache. Got "+e),Object(o.j)(e=>Object(g.a)(this._internals.network.error(e,this._internals.state.userId),()=>u)),e=>Object(f.b)(e)),l=Object.entries(e).filter(([e,t])=>Object(h.c)(e,this.queryMetadata)).map(([e,t])=>[e,Object.assign(Object.assign({},t),{state:null})]),b=Object(r.l)(...l);this.stateMap.value=b,this.stateMap.promise=Promise.resolve(this.stateMap.value),this._internals.log("Sending full picture of legacy state to state/legacy/ ",d),this._internals.log("Purging events cache. Current cache is ",t);const v=Object(r.i)(this.queryMetadata,(e,[t])=>(null==d?void 0:d[e])?Object(m.n)({[t]:d[e]}):m.m);return Promise.all([this._internals.api.state(v,0,!1,!1,!0),this._internals.state.eventsCache.reset()]).then(n=>{const r=this.filterCacheAndFlush(t);this._internals.log("Purged cache. New cache is ",r),this._internals.state.setPermutiveData("query_states",null);const i=d?Object(o.t)(()=>this.updateExternalState(v),e=>String(e)):Object(o.r)(null);return Object(o.m)(i)?Object(g.a)(i.left,t=>this._internals.network.error(`\n                  Failed to store migrated state.\n                  Old state was ${JSON.stringify(e)}.\n                  New state was ${JSON.stringify(d)}.\n                  Error was ${t}\n                `,this._internals.state.userId),e=>this._internals.log("Migration failed. Check network tab"),e=>r):Object(g.a)(this._internals.log("Migration completed successfully"),e=>[])})}))(n).catch(e=>this.onStateMigrateError(t,e))}onStateMigrateError(e,t){return this._internals.log("Migration failed. Check network tab"),this._internals.network.error("Exception during migration process. Got "+t,this._internals.state.userId),this._internals.state.eventsCache.reset().then(t=>Object(g.a)(this._internals.state.setPermutiveData("query_states",null),t=>this.filterCacheAndFlush(e)))}filterCacheAndFlush(e){const t=Object(h.b)(e,"web",window.location.hostname),n=t.length;return t.forEach((e,t)=>this._internals.state.eventsCache.add(e,{persistOnDisk:t===n-1})),t}trackTransition(e,t,n){const r=Object.assign({segment_id:t,segment_number:n},{});e?this.segmentEntryQueryCodes.add(n):this.segmentExitQueryCodes.add(n),this.permutive.track(e?"SegmentEntry":"SegmentExit",r,{isMemoryOnly:this.segmentTransitionEdgeOnly})}reset(){this._internals.removeExternalData(this.CACHED_SEGMENTS_STORAGE_KEY),this._internals.state.setPermutiveData("internal_query_states",{}),this._internals.state.setPermutiveData("external_query_states",{}),this.userSegments=[],this.userSegmentsMap={},this.stateMap={value:{},promise:Promise.resolve({})},this.extStateMap={}}setAsReady(){this.isWorkerReady=!0,this.onStateChangeReady(this.stateMap.value),this._internals.messages.emit("permutive:queries:initialised")}getStateSizeInBytes(){return 2*JSON.stringify(this.stateMap.value).length}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"canRun",(function(){return canRun})),__webpack_require__.d(__webpack_exports__,"getTag",(function(){return getTag})),__webpack_require__.d(__webpack_exports__,"makeConfig",(function(){return makeConfig})),__webpack_require__.d(__webpack_exports__,"hasConsent",(function(){return hasConsent}));var _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(29),_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4),_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15),_core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(30),_core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(18),_PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(31),_http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(22),_Config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(23),_core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(32),fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(0),fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3),fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(28),fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6),fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7),fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(11),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9),fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(10),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(5),_core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(20),_core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(26),_http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(27);const sdkInitTimestamp=window.performance.now(),canRun=e=>{const t="function"==typeof e.Map?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new e.Map([["a",1]])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Maps not supported"),n="function"==typeof e.Set?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new e.Set([1,2])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Sets not supported"),r=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(e=>1===e.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Maps not supported"))(t),i=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(e=>2===e.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Sets not supported"))(n),a=e.Worker&&e.Blob?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("WebWorkers not supported"),s=["QuotaExceededError","QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED"],o=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.t)(()=>{e.localStorage.setItem("_permutive_ls_test","_permutive_ls_test"),e.localStorage.removeItem("_permutive_ls_test")},t=>e.localStorage&&0===e.localStorage.remainingSpace||s.some(e=>-1!==String(t).indexOf(e))?"localStorage quota exceeded":"localStorage not supported");return Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__.a)(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.e)(r,i,o,a),t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.f)(t=>e)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b)(t)))},getTag=e=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.g)("Can't find permutive tag on the page")(e.permutive),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b),makeConfig=e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(Object.assign(Object.assign({},e),{config:Object(_Config__WEBPACK_IMPORTED_MODULE_8__.a)(e.config)})),makeNetwork=e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)([e,new _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__.a(e.config)]),validateConsentThenCache=e=>"object"==typeof e&&Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(window.localStorage.setItem("permutive-consent",JSON.stringify(e)),t=>{var n;return e.opt_in&&(null===(n=e.token)||void 0===n?void 0:n.length)>0}),consentThenInit=e=>t=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(validateConsentThenCache(t),t=>t?init(e)():null),hasConsent=e=>{const[t,n]=e;window.permutive.consent=consentThenInit(e);const r=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.f)(fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__.d)("2a28082a-de31-45fd-a00c-548117e422f7",["fe68d1f7-c9f4-45b3-8905-7cda73d3fd74"]),i=Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.h)(!1))(r?Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>n.req({url:n.getEndpointUrl("/geoip"),method:"GET"},!1).then(e=>"Israel"===Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.h)(e,"geo_info","country")&&validateConsentThenCache({opt_in:!0,token:"whitelisted-geo"})),e=>n.error("Failed to retrieve geo location information required for consent. Got "+e)):Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(!t.config.consentRequired)))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const e=JSON.parse(window.localStorage.getItem("permutive-consent"));return e?Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.n)(validateConsentThenCache(e)):fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.m})())))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const e=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.g)(e=>"consent"===e.functionName)(t.q);return Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.l)(e=>validateConsentThenCache(e.arguments[0]))(e)})()));return Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.g)(e=>e?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(Object(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.g)(t,n)):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("No consent to run on the page"))(i)},init=tagAndNetwork=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>{window.permutive.consent=validateConsentThenCache;const[tag,network]=tagAndNetwork,context=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.j)(tag.context||{},{path:window.location.pathname,url:window.location.href,referrer:document.referrer}),_internals=new _core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__.a(tag.config,network),permutiveMethods=new _PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__.a(_internals,network,context);_internals.state=new _core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__.a(_internals,permutiveMethods,context),_internals.stateSync=new _core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__.a(_internals),_internals.queryManager=new _core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__.a(_internals,permutiveMethods),_internals.thirdParty=new _core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__.a(_internals,permutiveMethods,network),_internals.identities=new _core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.a(_internals,permutiveMethods,network);const isMetricsUser=_internals.state.getPermutiveData("metricsEnabled");_internals.metrics=!0===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):!1===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b:Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Math.random()<=_internals.config.metricsSamplingPercentage/100,e=>[_internals.state.setPermutiveData("metricsEnabled",e),e],([e,t])=>t?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b);const permutiveShell=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.j)(tag,{consent:window.permutive.consent},{q:window.permutive.q},{context:context},{addons:_internals.addons});[].forEach(s=>{try{eval(s)}catch(e){network.error(Object.assign(Object.assign({},e),{message:"Error running custom script "+s}),_internals.state.userId)}}),_internals.addBlocker("permutive:queries:initialised"),_internals.messages.on("permutive:blockers:empty",()=>{const e=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.j)(permutiveShell,{identify:permutiveMethods.identify.bind(permutiveMethods),on:permutiveMethods.on.bind(permutiveMethods),once:permutiveMethods.once.bind(permutiveMethods),track:permutiveMethods.track.bind(permutiveMethods),trigger:permutiveMethods.trigger.bind(permutiveMethods),query:permutiveMethods.query.bind(permutiveMethods),segment:permutiveMethods.segment.bind(permutiveMethods),segments:permutiveMethods.segments.bind(permutiveMethods),reset:permutiveMethods.reset.bind(permutiveMethods),ready:permutiveMethods.ready.bind(permutiveMethods),addon:permutiveMethods.addon.bind(permutiveMethods)});window.permutive=Object.assign(Object.assign({},e),{q:[]}),_internals.setAsReady();const t=["identify","trigger","addon","track"];permutiveShell.q.filter(e=>"consent"!==e.functionName).sort((e,n)=>{const r=t.indexOf(e.functionName),i=t.indexOf(n.functionName);return-1===r?-1===i?0:1:-1===i?-1:r-i}).forEach(t=>{t.functionName in e?e[t.functionName].apply(permutiveMethods,t.arguments):network.error(`Function "permutive.${t.functionName}" does not exist.`,_internals.state.userId)})});const loadAddon=e=>e.load(permutiveShell.q,permutiveMethods,_internals,network),addons=[Promise.resolve().then(__webpack_require__.bind(null,34)),Promise.resolve().then(__webpack_require__.bind(null,35)),Promise.resolve().then(__webpack_require__.bind(null,36)),Promise.resolve().then(__webpack_require__.bind(null,37)),Promise.resolve().then(__webpack_require__.bind(null,38)),Promise.resolve().then(__webpack_require__.bind(null,39)),Promise.resolve().then(__webpack_require__.bind(null,40)),Promise.resolve().then(__webpack_require__.bind(null,41)),Promise.resolve().then(__webpack_require__.bind(null,42))];addons.forEach(e=>e.then(loadAddon));const registerEnricher=e=>e.register(_internals,permutiveShell.context,permutiveShell.config),enrichers=[Promise.resolve().then(__webpack_require__.bind(null,43)),Promise.resolve().then(__webpack_require__.bind(null,44))];enrichers.forEach(e=>e.then(registerEnricher));const registerCloudSegments=e=>e.register(_internals,permutiveShell.context,permutiveShell.config),cloudSegmentsModules=[];cloudSegmentsModules.forEach(e=>e.then(registerCloudSegments));const aliasesMap=_internals.identities.aliases,graphQLIdentify=()=>{const e=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.b)(),t=()=>permutiveShell.q.findIndex(e=>"identify"===e.functionName);let n=t();for(;n>-1;){const e=permutiveShell.q.splice(n,1)[0];_internals.identities.getAliasesFromIdentifyArg(e.arguments[0]).forEach(e=>_internals.identities.setAlias(e.id,e.tag)),n=t()}const r=_internals.state.userId,i=new _http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__.a(r,_internals.identities.aliasMapToPrioritizedList(aliasesMap));return _internals.graphql.register(i).then(t=>(t=>{const n=_internals.identities.aliases,i=t.user_id;i!==r?(_internals.log("Got different user id from API: "+i),_internals.state.reset().then(e=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(_internals.state.setUserId(i),e=>Object.entries(n).forEach(([e,t])=>_internals.identities.setAlias(t,e)),e=>_internals.state.eventsCache.reset())).then(t=>e.resolve({identityChanged:!0,userId:i}))):e.resolve({identityChanged:!1})})({user_id:t.identity.identify.id})).catch(t=>{network.error(`Couldn't set identity for user ${r}. Got ${t}`,r),e.resolve({identityChanged:!1})}),_internals.log("Starting identification... Current aliases are:",aliasesMap),e.promise.then(e=>{_internals.messages.emit("permutive:user:ready"),_internals.log("<done> init identity ",e)}),e.promise},onIdentityChanged=()=>(_internals.log("Identity has changed"),_internals.stateSync.resetSync()),onIdentityRemained=e=>(_internals.log("Identity hasn't changed, got these unseen out-of-SDK events",e),_internals.state.eventsCache.loadFromDisk().then(t=>{_internals.log("Loaded local event cache",t);const n=_internals.state.eventsCache.processUnseenEvents(e);return _internals.queryManager.bootstrap(t).then(()=>_internals.queryManager.process(n))})),resetOrDoNothing=()=>Object(_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.b)("2a28082a-de31-45fd-a00c-548117e422f7",_internals.identities.aliasMapToPrioritizedList(aliasesMap).map(e=>e.id),window.location.hostname,_internals.state.userId)?permutiveMethods.reset():Promise.resolve();return resetOrDoNothing().then(()=>_internals.identities.prepareThirdPartyIdentities()).then(e=>{_internals.thirdParty.segments();const t=graphQLIdentify(),n=_internals.graphql.register(new _http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__.a(_internals.state.userId));return _internals.graphql.run(),Promise.all([t,n]).catch(e=>[{identityChanged:!1},{out_of_sdk_events:[]}]).then(([e,t])=>e.identityChanged?onIdentityChanged():onIdentityRemained(t.out_of_sdk_events))}).then(()=>(permutiveShell.context.user_id=_internals.state.userId,Promise.all([_internals.thirdParty.segments(),_internals.models.getModels()]).then(([e,t])=>(_internals.log("Loaded TPD segments and lookalike models",e,t),_internals.queryManager.updateEnvironment({segments:Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.j)({"1p":_internals.queryManager.userSegmentsMap},e),lookalikeModels:t}))))).then(()=>{_internals.queryManager.setAsReady(),_internals.messages.emit("permutive:api:ready"),_internals.metrics.track({name:"sdk_local_storage_byte_total",value:_internals.state.getStateSizeInBytes(),labels:{}}),_internals.metrics.track({name:"sdk_query_states_byte_total",value:_internals.queryManager.getStateSizeInBytes(),labels:{}})})},e=>"Exception during initialisation. Got "+e),initialisationSequence=Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(window),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(canRun),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(getTag),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeConfig),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeNetwork),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(hasConsent),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(init));initialisationSequence().then(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.f)(e=>console.warn("Permutive was not initialized. "+e),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c))},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r}));const r=(e,t,n)=>{e.push({functionName:"addon",arguments:["dbm",{}]})}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r})),n.d(t,"DDPAddon",(function(){return i}));const r=()=>{};class i{constructor(e){this._internals=e._internals;const t=this._internals.state.getPermutiveData("addon:ddp");(isNaN(t)||(new Date).getTime()>t+864e5)&&this.initiateIdSync()}initiateIdSync(){const e=`https://cm.g.doubleclick.net/pixel?google_nid=permutive_dmp&google_cm&type=ddp&k=${this._internals.config.apiKey}&u=${this._internals.state.userId}`;(new Image).src=e,this._internals.state.setPermutiveData("addon:ddp",(new Date).getTime())}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return o})),n.d(t,"DFPAddon",(function(){return c}));var r=n(4),i=n(7),a=n(11);const s={},o=(e,t,n)=>{e.push({functionName:"addon",arguments:["dfp",{}]}),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push((function(){t.ready(n.makeSafe(()=>{let e=0;googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().length>0&&googletag.pubads().getSlots().forEach((function(t){t.getResponseInformation()&&e++}));const t=0===e?"sdk_targeting_realtime_success_count":"sdk_targeting_realtime_fail_count";n.metrics.track({name:t,value:1,labels:{target:"dfp"}})}),"realtime");const e=function(){const e=n.getExternalData("_pdfps");return e?JSON.parse(e):[]}();googletag.cmd.push((function(){googletag.pubads().setTargeting("permutive",e.map(String))}));const i=function(e){const t={ad_unit_path:e.getAdUnitPath(),slot_element_id:e.getSlotElementId(),targeting_keys:[]},n={},r=e.getTargetingKeys();for(let i=0;i<r.length;i++){const a=r[i],s=[],o=e.getTargeting(a);for(let e=0;e<o.length;e++)s.push(o[e].toString());s.length>0&&(n[a]=1,t.targeting_keys.push({key:a,value:s}))}const i=googletag.pubads().getTargetingKeys();for(let e=0;e<i.length;e++){const r=i[e],a=[];if(void 0===n[r]){const n=googletag.pubads().getTargeting(i[e]);for(let e=0;e<n.length;e++)a.push(n[e].toString());a.length>0&&t.targeting_keys.push({key:r,value:a})}}return t},a=function(e){try{let n=!1;window.addEventListener("blur",(function(){if(n){const n=s[e];n&&t.track("SlotClicked",n)}})),document.getElementById(e).addEventListener("mouseover",(function(){n=!0})),document.getElementById(e).addEventListener("mouseout",(function(){n=!1}))}catch(e){}};googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().forEach((function(e){const n=e.getResponseInformation();if(n){const o=e.getSlotElementId(),c={advertiser_id:Object(r.k)(n.advertiserId),campaign_id:Object(r.k)(n.campaignId),line_item_id:Object(r.k)(n.lineItemId),creative_id:Object(r.k)(n.creativeId),is_empty:!1,service_name:"publisher_ads",slot:i(e)};s[o]=c,t.track("SlotRendered",c,{isAnalyticsOnly:!0}),a(o)}})),googletag.cmd.push((function(){googletag.pubads().addEventListener("slotRenderEnded",(function(e){const n=e,o=n.slot.getSlotElementId(),c={advertiser_id:Object(r.k)(n.advertiserId),campaign_id:Object(r.k)(n.campaignId),line_item_id:Object(r.k)(n.lineItemId),creative_id:Object(r.k)(n.creativeId),is_empty:n.isEmpty,service_name:n.serviceName,slot:i(e.slot)};if(n.size){const[e,t,...r]=n.size;"number"==typeof e&&"number"==typeof t&&(c.width=e,c.height=t)}s[o]=c,t.track("SlotRendered",c,{isAnalyticsOnly:!0}),a(o)})),googletag.pubads().addEventListener("impressionViewable",(function(e){const n=e.slot.getResponseInformation();n&&t.track("SlotViewable",{advertiser_id:Object(r.k)(n.advertiserId),campaign_id:Object(r.k)(n.campaignId),line_item_id:Object(r.k)(n.lineItemId),creative_id:Object(r.k)(n.creativeId),service_name:e.serviceName,slot:i(e.slot)})}))})),window.addEventListener("message",(function(e){try{const n=JSON.parse(e.data);if(n.permutive_type&&"google_ad_click"===n.permutive_type){const e=n.data.ad_unit_path,i=Object(r.k)(n.data.creative_id);let a=void 0;Object.keys(s).forEach(t=>{void 0!==s[t].slot&&s[t].slot.ad_unit_path===e&&s[t].creative_id===i&&(a=s[t])}),a=a||{line_item_id:Object(r.k)(n.data.line_item_id),advertiser_id:Object(r.k)(n.data.advertiser_id),campaign_id:Object(r.k)(n.data.order_id),creative_id:Object(r.k)(i),is_empty:!1},t.track("SlotClicked",a)}}catch(e){}}),!1)}))};class c{constructor(e){this.trackedTargetingLimitMetric=!1,this._internals=e._internals;const t=this._internals.getExternalData("_pdfps");this.liveSegments=t?JSON.parse(t):[],this.eligibleSegments={};const n=this._internals.state.activationManager.getSpecializedActivations("dfp");for(let e=0;e<n.dfp.length;e++){const t=n.dfp[e];this.eligibleSegments[t]=t}for(const e in n.dfp_legacy)if(n.dfp_legacy.hasOwnProperty(e)){const t=n.dfp_legacy[e];this.eligibleSegments[e]=t}const r=this._internals.queryManager.userSegments;this.updateSegments(this.filterSegments(r)),this._internals.messages.emit("permutive:dfp:ready"),this._internals.messages.on("permutive:segments:updated",this._internals.makeSafe(()=>{const e=this._internals.queryManager.userSegments;this.updateIfNecessary(e)})),this._internals.messages.on("permutive:reset",this._internals.makeSafe(()=>{this._internals.removeExternalData("_pdfps"),this._internals.deleteCookie("_pdfps"),this.liveSegments=[]}))}updateIfNecessary(e){const t=this.filterSegments(e);this._internals.arraysEqual(t,this.liveSegments)||this.updateSegments(t)}updateSegments(e){const t=Object(i.f)(a.d)("2a28082a-de31-45fd-a00c-548117e422f7",["5d79bce7-5d2b-427e-a6c4-b89b6c7bf048","99db7a95-b06a-4ea9-857c-f73ba0a25c19","f5b3be27-f789-4ef1-8867-37c67da5b361","3aba5292-ba75-422b-8715-bd21146f7836","bd1cec50-00d1-4ce9-9572-785857419a1e"])?this.processActivations(this._internals.thirdParty.getActivationMetadata()):[];let n=e.concat(t);encodeURIComponent(JSON.stringify(n)).length>1500&&(n=e,this.trackedTargetingLimitMetric||(this._internals.metrics.track({name:"sdk_targeting_size_limit_exceeded_count",value:1,labels:{target:"dfp"}}),this.trackedTargetingLimitMetric=!0)),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push(()=>googletag.pubads().setTargeting("permutive",n.map(String).concat(["rts"])));const r=JSON.stringify(n.map(String));this._internals.setExternalData("_pdfps",r),"boolean"==typeof{workspaces:[{activations:[],networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0,activationConfigs:[]}.sync_segments_cookie&&{workspaces:[{activations:[],networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"Default",network_code:"5605"}],track_slot_clicked:!0,track_slot_rendered:!0,track_slot_viewable:!0,activationConfigs:[]}.sync_segments_cookie&&this._internals.api.segmentSync("_pdfps",r),this.liveSegments=e}filterSegments(e){return e.filter(e=>e in this.eligibleSegments).map(e=>this.eligibleSegments[e])}processActivations(e){const t=[];for(const n in e)if(e.hasOwnProperty(n)&&n in this.eligibleSegments)for(let r=0;r<e[n].length;r++)t.push(e[n][r]);return t}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return i})),n.d(t,"FacebookPixelV2Addon",(function(){return a}));var r=n(4);const i=(e,t,n)=>{performance.mark("facebookPixelAddonInitStart"),Object(r.a)(()=>{(()=>{performance.mark("facebookPixelAddonInitEnd"),performance.measure("facebookPixelAddonLoadingtime","facebookPixelAddonInitStart","facebookPixelAddonInitEnd");const e=performance.getEntriesByName("facebookPixelAddonLoadingtime")[0].duration;n.metrics.track({name:"sdk_addon_init_duration_seconds",value:e,labels:{addon:"facebook_pixel_v2"}})})(),t.addon("facebook_pixel_v2",{})},()=>"undefined"!=typeof fbq)};class a{constructor(e){this.permutive=e.permutive,this._internals=e._internals;const t=this._internals.state.getPermutiveData("addon:facebook_pixel_v2")||!1,n=this._internals.queryManager.userSegmentsMap,r=this._internals.state.activationManager.getActivations("facebook_pixel_v2"),i=!t;for(let e=0;e<r.length;e++){const t=r[e],a=t.segmentCode;this.permutive.trigger(t.segmentCode,"",e=>{this.firePixel(e.result?"PermutiveSegmentEntry":"PermutiveSegmentExit",t)}),i&&a in n&&this.firePixel("PermutiveSegmentEntry",t)}i&&this._internals.state.setPermutiveData("addon:facebook_pixel_v2",!0),this._internals.messages.on("permutive:reset",()=>{this._internals.state.setPermutiveData("addon:facebook_pixel_v2",!1)})}firePixel(e,t){fbq("trackCustom",e,{segment_id:t.segmentCode}),t.trackImpression()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r})),n.d(t,"OverlaysAddon",(function(){return i}));const r=(e,t,n)=>{e.unshift({functionName:"addon",arguments:["overlays",{}]})};class i{constructor(e){const t=this;this.permutive=e.permutive,this._internals=e._internals,this.activations=this._internals.state.activationManager.getActivations("overlays"),this.loadedImageCounts={};for(let e=0;e<this.activations.length;e++){const n=this.activations[e],r=n.config,i=this.buildOverlayCss(r,e);document.head.insertAdjacentHTML("beforeend",i);const a=this.buildOverlayBody(r,e);document.body.insertAdjacentHTML("beforeend",a);const s="permutive-overlay-"+e,o=document.getElementById(s),c=o.getElementsByClassName("close")[0],u=o.getElementsByClassName("content")[0],d=()=>{o.style.visibility="hidden",o.style.opacity="0"},l=e=>{u.contains(e.target)||(d(),o.removeEventListener("click",l))};c.addEventListener("click",d),o.addEventListener("click",l),[].slice.call(o.getElementsByTagName("a")).slice(1).forEach(e=>{e.addEventListener("click",(function(){n.trackConversion({useBeacon:!0})}))});const f=o.getElementsByTagName("form")[0];f&&f.addEventListener("submit",(function(e){e.preventDefault(),n.trackConversion({success:function(){f.submit()}})}));const _=function(e,n){t.showOverlay(e),n.trackImpression()};n.activateEveryTime()?this.permutive.segment(n.segmentCode,this._internals.makeSafe(e=>{e?_(s,n):this.permutive.trigger(n.segmentCode,"result",(function(e){e.result&&_(s,n)}))})):n.activateOnEntry()?this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(e){e.result&&_(s,n)}))):n.activateOnExit()&&this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(e){e.result||_(s,n)})))}}buildOverlayCss(e,t){return'<style type="text/css">.${overlay_class}{position:fixed;top:0;bottom:0;left:0;right:0;width:100%;height:100%;background:rgba(0,0,0,0.${opacity_percentage});transition:opacity ${opacity_transition_ms}ms;visibility:hidden;opacity:0;z-index:1000000;}.${modal_class}{position:fixed;padding:10px;background:#fff;border-radius:5px;z-index:1000001}.${modal_class} .content{overflow:auto;z-index:1000002;}.${modal_class} .close{position:absolute;top:20px;right:30px;transition:all 200ms;font-size:30px;font-weight:bold;text-decoration:none;color:#333;z-index:1000003}.${modal_class} .close:hover{color:orange;}</style>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${opacity_percentage}",e.opacity_percentage.toString()).replace("${opacity_transition_ms}",e.opacity_transition_ms.toString())}buildOverlayBody(e,t){let n="";return!function(e){return void 0!==e.html}(e)?function(e){return void 0!==e.image_url&&void 0!==e.image_link}(e)&&(n='<a href="'+e.image_link+'"><img src="'+e.image_url+'"/></a>'):n=e.html,'<div id="${overlay_class}" class="${overlay_class}"><div id="${modal_class}" class="${modal_class}"><a class="close" href="javascript:;">&times;</a><div class="content">${content}</div></div></div>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${content}",n).replace(/<img /g,"<img onload='window.permutive.addons.overlays.loadedImage(\"permutive-overlay-"+t+"\")' ")}showOverlay(e){const t=document.getElementById(""+e),n=()=>{const e=t.getElementsByTagName("div")[0],n=e.getBoundingClientRect().height,r=e.getBoundingClientRect().width;e.style.left=window.innerWidth/2-r/2+"px",e.style.top=window.innerHeight/2-n/2+"px",t.style.visibility="visible",t.style.opacity="1"},r=t.getElementsByTagName("img");if(r.length>0){let t=0;const i=()=>{t<10&&(!(e in this.loadedImageCounts)||this.loadedImageCounts[e]<r.length)?(t+=1,setTimeout(i,500)):n()};i()}else n()}loadedImage(e){e in this.loadedImageCounts?this.loadedImageCounts[e]=this.loadedImageCounts[e]+1:this.loadedImageCounts[e]=1}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r}));const r=(e,t,n)=>{{const e=e=>{const r={loginRequired:function(e){t.track("PianoLoginRequired",{template_id:e.templateId,offer_id:e.offerId,term_id:e.termId,container_selector:e.containerSelector,experience:{id:e.experienceId,execution_id:e.experienceExecutionId,action_id:e.experienceActionId},start_screen:e.startScreen},{useBeacon:!0})},showTemplate:function(e){const n=e.activeMeters?JSON.parse(e.activeMeters):[];t.track("PianoShowTemplate",{template_id:e.templateId,offer_id:e.offerId,container_selector:e.containerSelector,experience:{id:e.experienceId,execution_id:e.experienceExecutionId,action_id:e.experienceActionId},meters:n.map(e=>({name:e.meterName,max_views:e.maxViews,views:e.views,views_left:e.viewsLeft,total_views:e.totalViews}))})},showOffer:function(e){t.track("PianoShowOffer",{template_id:e.templateId,offer_id:e.offerId,container_selector:e.containerSelector,experience:{id:e.experienceId,execution_id:e.experienceExecutionId,action_id:e.experienceActionId}})},startCheckout:function(e){t.track("PianoCheckoutStart",{template_id:e.templateId,offer_id:e.offerId,term_id:e.termId,container_selector:e.containerSelector,experience:{id:e.experienceId},iframe_id:e.iframeId})},checkoutComplete:function(e){let n=void 0;"string"==typeof e.startedAt&&(n=new Date(e.startedAt).toISOString());let r=void 0;"number"==typeof e.expires&&(r=new Date(1e3*e.expires).toISOString()),t.track("PianoCheckoutComplete",{user_id:e.uid,term_id:e.termId,term_conversion_id:e.termConversionId,resource_id:e.rid,charge_amount:e.chargeAmount,charge_currency:e.chargeCurrency,started_at:n,expires_at:r},{useBeacon:!0})},checkoutClose:function(e){t.track("PianoCheckoutClose",{state:e.state})},meterActive:function(e){t.track("PianoMeterActive",{name:e.meterName,max_views:e.maxViews,views:e.views,views_left:e.viewsLeft,total_views:e.totalViews})},meterExpired:function(e){t.track("PianoMeterExpired",{name:e.meterName,max_views:e.maxViews,views:e.views,views_left:e.viewsLeft,total_views:e.totalViews})}}[e]||function(){};return n.makeSafe(r)},r=function(){window.tp=window.tp||[];["loginRequired","showTemplate","showOffer","startCheckout","checkoutComplete","checkoutClose","meterActive","meterExpired"].forEach((function(t){window.tp.push(["addHandler",t,e(t)])}))};n.makeSafe((function(){window.__permutive=window.__permutive||{},window.__permutive.pianoEvents=window.__permutive.pianoEvents||[],window.__permutive.pianoEvents.forEach((function(t){e(t.name)(t.e)})),r()}))()}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"load",(function(){return load})),__webpack_require__.d(__webpack_exports__,"ScriptRunnerAddon",(function(){return ScriptRunnerAddon}));const load=(e,t,n)=>{e.unshift({functionName:"addon",arguments:["scriptrunner",{}]})};class ScriptRunnerAddon{constructor(options){this.permutive=options.permutive,this._internals=options._internals,this.network=options.network,this.activations=this._internals.state.activationManager.getActivations("scriptrunner");for(let i=0;i<this.activations.length;i++){const activation=this.activations[i],run=activation=>{const script=activation.config.script.replace(/impression\(\)/g,"activation.trackImpression();").replace(/conversion\(\)/g,"activation.trackConversion();");try{eval(script)}catch(e){e.message="Error running custom script: "+e.message,this.network.error(e,this._internals.state.userId)}};activation.activateEveryTime()?this.permutive.segment(activation.segmentCode,e=>{e?run(activation):this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result&&run(activation)}))}):activation.activateOnEntry()?this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result&&run(activation)})):activation.activateOnExit()&&this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result||run(activation)}))}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r})),n.d(t,"TwitterAddon",(function(){return i}));const r=(e,t,n)=>{e.push({functionName:"addon",arguments:["twitter_pixel",{}]})};class i{constructor(e){const t=this;this._internals=e._internals,this.firedSegments=this._internals.state.getPermutiveData("addon:twitter_pixel")||{},this.activations=this._internals.state.activationManager.getActivations("twitter_pixel");const n=0===Object.keys(this.firedSegments).length;this.eligibleSegments={};for(let e=0;e<this.activations.length;e++){const t=this.activations[e],n=t.segmentCode;this.eligibleSegments[n]=t}n&&this.firePixelsIfNecessary(this._internals.queryManager.userSegments),this._internals.messages.on("permutive:segments:updated",()=>{t.firePixelsIfNecessary(this._internals.queryManager.userSegments)}),this._internals.messages.on("permutive:reset",()=>{t.firedSegments={},this._internals.state.setPermutiveData("addon:twitter_pixel",{})})}firePixelsIfNecessary(e){for(let t=0;t<e.length;t++){const n=e[t];n in this.eligibleSegments&&!(n in this.firedSegments)&&(this.firePixel(this.eligibleSegments[n]),this.firedSegments[n]=1)}this._internals.state.setPermutiveData("addon:twitter_pixel",this.firedSegments)}firePixel(e){(new Image).src=`https://analytics.twitter.com/i/adsct?txn_id=${e.config.audience_tag_id}&p_id=Twitter`,e.trackImpression()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return o})),n.d(t,"WebAddon",(function(){return c}));var r=n(4),i=n(0);const a=["mousemove","click","scroll"],s=["email","tel","submit","reset","button","file","password","radio","checkbox"],o=(e,t,n)=>{0};class c{constructor(e){this.dirtyState=!1,this.initialised=!1,this.totalCompletion=0,this.totalEngagedTime=0,this.engagementEdgeOnly=!0,this.segmentTransitionEdgeOnly=!0,this.trackPageviewEngagement="boolean"!=typeof{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_pageview_engagement||{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_pageview_engagement,this.trackPageviewComplete="boolean"!=typeof{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_pageview_complete||{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_pageview_complete,this.trackFormSubmission="boolean"!=typeof{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_form_submission||{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_form_submission,this.trackLinkClick="boolean"!=typeof{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_link_click||{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.track_link_click,this.pageviewCompleteTimeoutDuration=6e5,this.hasPageviewCompleteFired=!1,this.permutive=e.permutive,this._internals=e._internals,this.context=e.context,this.eventInterval=e.eventInterval||5,this.page=e.page||{},this.sendPageviewEvent(),(e.dirtyEvents||a).map(e=>{window.addEventListener(e,()=>{this.dirtyState=!0,this.trackPageviewComplete&&this.resetTimeout()})}),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners,!1),this.trackPageviewEngagement&&(this.timerHandle=this.registerEngagementInterval(this.eventInterval)),this.trackPageviewComplete&&(this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration),Object(r.m)(()=>this.hasPageviewCompleteFired?null:this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion),navigator.userAgent)),this.initialised=!0}sendPageviewEvent(){const e=Object.assign(Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},{}),{}),this.enrichmentProperties(this.context.isArticle)),this.page?this.page:{}),t={success:()=>{this.initialised||this._internals.metrics.trackTimeSinceInit("sdk_first_event_tracked_task_duration_seconds",{})}};this.permutive.track("Pageview",e,t).then(e=>{this._internals.messages.emit("permutive:event:pageview",e)})}sendLinkClickEvent(e,t){if(window.location.href&&e.href){const n=0===e.href.indexOf("data:")?"NOT_URL":e.href;this.permutive.track("LinkClick",{dest_url:n},{useBeacon:t})}}sendFormSubmissionEvent(e){const t=e.currentTarget,n={form:Object.assign(Object.assign(Object.assign({method:t.method||"GET",properties:this.serializeForm(t)},"string"==typeof t.id?{id:t.id}:{}),t.name&&"string"==typeof t.name?{name:t.name}:{}),t.action&&"string"==typeof t.action?{action:t.action}:{})};this.permutive.track("FormSubmission",n)}sendEngagementEvent(e){const{engaged_time:t,total_engaged_time:n,completion:r,total_completion:i}=this.updateState(e),a=Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",engaged_time:t,total_engaged_time:n},this.page),{completion:r,total_completion:i});this.permutive.track("PageviewEngagement",a,{isMemoryOnly:this.engagementEdgeOnly})}sendPageviewCompleteEvent(e,t,n=!0){const r=Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},this.enrichmentProperties(this.context.isArticle)),this.page),{aggregations:Object.assign({PageviewEngagement:Object.assign({engaged_time:e},{completion:t})},this.segmentTransitionEdgeOnly?{SegmentEntry:Array.from(this._internals.queryManager.segmentEntryQueryCodes),SegmentExit:Array.from(this._internals.queryManager.segmentExitQueryCodes)}:{})});this.permutive.track("PageviewComplete",r,{useBeacon:n}),this.hasPageviewCompleteFired=!0}reset(e){this._internals.state.viewId=Object(r.o)(),this.page=e.page||null,this.trackPageviewComplete&&(this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),this.hasPageviewCompleteFired=!1),this.totalCompletion=0,this.totalEngagedTime=0,this.sendPageviewEvent(),this.trackPageviewEngagement&&(clearInterval(this.timerHandle),this.timerHandle=this.registerEngagementInterval(this.eventInterval))}serializeForm(e){return[].slice.call(e.getElementsByTagName("input"),0).filter(e=>!(!e.type||!e.id||e.disabled||e.checked||"fieldset"===e.nodeName.toLowerCase()||-1!==s.indexOf(e.type.toLowerCase()))).map(e=>({name:e.name||e.id,value:e.value})).filter(e=>e.value.length<120)}enrichmentProperties(e){return Object.assign(Object.assign(Object.assign({},e&&{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.add_alchemy_taxonomy?{taxonomy_labels:"$alchemy_taxonomy_labels"}:{}),e&&{workspaces:[{activations:[],engagement_edge_only:!0,segment_transition_edge_only:!0}],auto_init:!1,engagement_edge_only:!0,segment_transition_edge_only:!0,activationConfigs:[]}.add_alchemy_entities?{entity_names:"$alchemy_entity_names"}:{}),{classifications_watson:{taxonomy_labels:"$taxonomy_labels"}})}registerEngagementInterval(e){return setInterval(()=>{this.dirtyState&&this.sendEngagementEvent(e)},1e3*e)}attachListeners(){const e=e=>"a"===e.tagName.toLowerCase(),t=n=>e(n)?Object(i.n)(n):n.parentElement?e(n.parentElement)?Object(i.n)(n.parentElement):t(n.parentElement):i.m;this.trackFormSubmission&&[].slice.call(document.getElementsByTagName("form"),0).forEach(e=>{e.addEventListener("submit",this._internals.makeSafe(this.sendFormSubmissionEvent.bind(this)))}),this.trackLinkClick&&document.body.addEventListener("click",e=>{if(e.target instanceof Element){const n=t(e.target);return Object(i.a)(()=>{},t=>this.sendLinkClickEvent(t,((e,t)=>!("_blank"===t.target||e.metaKey||e.ctrlKey||e.shiftKey||2===e.which||3===e.which))(e,t)))(n)}})}updateState(e){const t=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=t-this.totalCompletion;return this.totalEngagedTime+=e,this.totalCompletion=t,this.dirtyState=!1,{engaged_time:e,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}}getCurrentCompletion(){const e=document.documentElement.scrollHeight,t=window.pageYOffset+window.innerHeight;return t<=0?0:t>=e?1:t/e}setPageviewCompleteTimeout(e){return window.setTimeout(()=>this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),e)}resetTimeout(){clearTimeout(this.pageviewCompleteTimeoutHandle),this.pageviewCompleteTimeoutHandle=this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GraphQLGeoIP",(function(){return s})),n.d(t,"register",(function(){return o}));var r=n(4),i=n(16);class a extends i.b{constructor(e){super(),this.replacementMap={$ip_geo_info:e.geo,$ip_isp_info:e.isp,$ip_address:e.ip,$ip_address_hash:e.ip_hash}}}class s{constructor(e){this.resource="geoip",this.query=()=>`geoip { ${[this.config.includeGeo?"geo { continent country city province postal_code }":"",this.config.includeISP?"isp { isp organization autonomous_system_number autonomous_system_organization }":"",this.config.includeIP?"ip":"",this.config.includeIPHash?"ip_hash":""].join(" ")} }`,this.config=e}}const o=(e,t)=>{const n=e=>{e.isp&&(t.isp=e.isp.isp,t.organization=e.isp.organization,t.autonomous_system_number=e.isp.autonomous_system_number,t.autonomous_system_organization=e.isp.autonomous_system_organization),e.geo&&(t.continent=e.geo.continent,t.country=e.geo.country,t.city=e.geo.city,t.province=e.geo.province,t.postal_code=e.geo.postal_code)},i=e.state.getPermutiveData("enricher:geoip");if(i&&i.session_id===e.sessionManager.getSessionId())n(i.data),e.enrichers.register(new a(i.data));else{const t={includeGeo:Object(r.h)({classifications_watson:{categories_enabled:!0,std_segments_enabled:!1,event_enrichment_enabled:!0},geoip:{}},"geoip","include_geo")||!0,includeISP:Object(r.h)({classifications_watson:{categories_enabled:!0,std_segments_enabled:!1,event_enrichment_enabled:!0},geoip:{}},"geoip","include_isp")||!0,includeIPHash:Object(r.h)({classifications_watson:{categories_enabled:!0,std_segments_enabled:!1,event_enrichment_enabled:!0},geoip:{}},"geoip","include_ip_hash")||!0,includeIP:Object(r.h)({classifications_watson:{categories_enabled:!0,std_segments_enabled:!1,event_enrichment_enabled:!0},geoip:{}},"geoip","include_ip")||!1};e.graphql.register(new s(t)).then(t=>{n(t),e.state.setPermutiveData("enricher:geoip",{session_id:e.sessionManager.getSessionId(),data:t}),e.enrichers.register(new a(t))}).catch(t=>e.network.error("Error while registering the geoip enricher: got "+t))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"enumerateAllValidHierarchies",(function(){return c})),n.d(t,"GraphQLWatson",(function(){return u})),n.d(t,"register",(function(){return d}));var r=n(4),i=n(16),a=n(7),s=n(11);class o extends i.b{constructor(e){super(),this.replacementMap={$alchemy_concepts:Object(r.h)(e,"concepts")||"$alchemy_concepts",$alchemy_entities:Object(r.h)(e,"entities")||"$alchemy_entities",$alchemy_keywords:Object(r.h)(e,"keywords")||"$alchemy_keywords",$alchemy_taxonomy:Object(r.h)(e,"taxonomies")||"$alchemy_taxonomy",$alchemy_document_emotion:Object(r.h)(e,"emotion","document","emotion")||"$alchemy_document_emotion",$alchemy_document_sentiment:Object(r.h)(e,"sentiment","document")||"$alchemy_document_sentiment",$alchemy_taxonomy_labels:e.taxonomies.map(e=>e.label)||"$alchemy_taxonomy_labels",$alchemy_entity_names:e.entities.map(e=>e.text)||"$alchemy_entities_names",$taxonomy_labels:c(e.taxonomies)||"$taxonomy_labels"}}}function c(e){const t=Object(a.h)(e.filter(Boolean).map(e=>(e=>{const t=e.split("/").filter(e=>e);return t.map((e,n)=>"/"+t.slice(0,n+1).join("/"))})(e.label)));return Object(a.q)(s.d)(t)}class u{constructor(){this.resource="classification",this.query=()=>`\n      classification(url: "${window.location.href}") {\n        url\n        updated\n        entities {\n          text\n          relevance\n        }\n        keywords {\n          text\n          relevance\n        }\n        concepts {\n          text\n          relevance\n        }\n        taxonomies {\n          label\n          score\n        }\n        emotion {\n          document {\n            emotion {\n              anger\n              disgust\n              fear\n              joy\n              sadness\n            }\n          }\n        }\n        sentiment {\n          document {\n            label\n            score\n          }\n        }\n      }\n    `}}const d=(e,t)=>{e.graphql.register(new u).then(n=>{var r;r=n,t.watson=r,e.enrichers.register(new o(n))}).catch(t=>e.network.error("Error while registering the watson enricher: got "+t))}},function(e,t,n){"use strict";n.r(t),n.d(t,"AppNexusIdentityProvider",(function(){return s})),n.d(t,"make",(function(){return o}));var r=n(0),i=n(6),a=n(4);class s{constructor(e,t){this._internals=e,this.network=t,this.tag="appnexus",this.ttlInSeconds=86400,this.usedForThirdPartyData=!0,this.url="https://ib.adnxs.com/getuidj",this.invalidAliases=["0","-1"]}getId(){return Object(a.g)(navigator.userAgent)?Promise.resolve({type:"skipped"}):this.network.ajax({url:this.url,xhrFields:{withCredentials:!0},timeout:3e3}).then(e=>({type:"attempted",result:Object(i.a)(Object(r.d)(e=>e.uid&&this.isValidAlias(e.uid))(e),Object(r.l)(e=>e.uid))}),e=>Object(i.a)(this.network.error(`Failed to retrieve third-party identity for ${this.tag}. Got ${e}`,this._internals.state.userId),e=>({type:"attempted",result:r.m})))}isValidAlias(e){return-1===this.invalidAliases.indexOf(e)}}const o=(e,t)=>Promise.resolve(Object(r.n)(new s(e,t)))},function(e,t,n){"use strict";n.r(t),n.d(t,"PermutiveModels",(function(){return s}));var r=n(4),i=n(20),a=n(0);class s{constructor(e){this._internals=e,this.MODELS_LAST_UPDATED_KEY="models_last_updated",this.MODELS_DATA_KEY="models_data",this.MODELS_SYNC_TIMEOUT_IN_SECONDS=86400,this.idToProviderMap=Object(r.n)(i.b);const t=this._internals.state.getPermutiveData(this.MODELS_LAST_UPDATED_KEY),n=e.metrics.startTimer("sdk_load_lookalike_models_task_duration_seconds",{});isNaN(t)||(new Date).getTime()>t+1e3*this.MODELS_SYNC_TIMEOUT_IN_SECONDS?this.models=this.fetchModels().then(e=>(this._internals.state.setPermutiveData(this.MODELS_DATA_KEY,e),this._internals.state.setPermutiveData(this.MODELS_LAST_UPDATED_KEY,(new Date).getTime()),e)).catch(e=>(this._internals.network.error("Failed decoding binary models.\nError: "+e),{})):this.models=new Promise(t=>{e.metrics.stopTimer("sdk_load_lookalike_models_task_duration_seconds",n),t(this._internals.state.getPermutiveData(this.MODELS_DATA_KEY))})}getModels(){return this.models}extractModelsFromJsonArray(e){const t={};for(let n=0;n<e.length;n++){const r=e[n],i=r.weights,a={"1p":{}};void 0!==r.id&&void 0!==i&&(Object.keys(i).forEach(e=>{const t=e.split("-");if(2===t.length){const n=this.idToProviderMap[t[0]],r=t[1];a[n]||(a[n]={}),a[n][r]=i[e]}else a["1p"][e]=i[e]}),t[r.id]=a)}return t}decodeModels(e){const t=[];let n=0;for(;n<e.byteLength;){const[r,i]=this.decodeModel(new DataView(e,n));t.push(r),n+=i}return t}decodeModel(e){const t=(e,t)=>{const n=(e,t)=>{const n=e.toString(16);return("0".repeat(t)+n).slice(Math.min(-t,-n.length))};return`${n(e.getUint32(t),8)}-${n(e.getUint16(t+4),4)}-${n(e.getUint16(t+6),4)}-${n(e.getUint16(t+8),4)}-${n(e.getUint32(t+10),8)}${n(e.getUint16(t+14),4)}`},n=e=>{const n=t(e,1),r=((e,t)=>{switch(String.fromCharCode(e.getInt8(t))){case"1":return"1p";case"3":return"3p"}})(e,17),i=e.getInt8(18),a=e.getFloat32(19),s=e.getFloat32(23),[o,c]=((e,t,n,r,i)=>{const a=(e,t,n)=>n===e?t:n,s=(e,t,n,r)=>t+(n-t)*r/(Math.pow(2,e)-1),o={};let c=0;do{c=e.getUint16(t);const u=e.getUint16(t+2);t+=4,o[a(0,"const",c)]=s(n,r,i,u)}while(0!==c);return[o,t]})(e,27,i,a,s);return[{version:1,id:n,data_preference:r,weights:o},c]};return(e=>{const r=[1],i=e.getInt8(0);if(1===i)return n(e);{const n=Object(a.o)(()=>t(e,1)),s=Object(a.a)(()=>"Couldn't decode model id",e=>"Model id was "+e)(n);throw new Error(`Decoding only supported for version(s): ${r}; Supplied version was ${i}; ${s}`)}})(e)}fetchModels(){const e=(e,t,n)=>this._internals.api.models(e).then(t,n),t=()=>e("json",e=>this.extractModelsFromJsonArray(e.models),e=>(this._internals.network.error("Failed fetching json models.\nError: "+e),{}));return(()=>e("binary",e=>this.extractModelsFromJsonArray(this.decodeModels(e)),e=>(this._internals.log("Failed fetching binary models, reverting to JSON.\nError: "+e),this._internals.metrics.track({name:"sdk_binary_models_missing_count",value:1,labels:{}}),t())))()}}}]);